{"ast":null,"code":"'use strict';\n\nvar _createForOfIteratorHelper = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _classCallCheck = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar is = require('./is.js');\n\nvar token = require('./token.js');\n\nvar bl = require('./bl.js');\n\nvar common = require('./common.js');\n\nvar jump = require('./jump.js');\n\nvar byteUtils = require('./byte-utils.js');\n\nvar _0uint = require('./0uint.js');\n\nvar _1negint = require('./1negint.js');\n\nvar _2bytes = require('./2bytes.js');\n\nvar _3string = require('./3string.js');\n\nvar _4array = require('./4array.js');\n\nvar _5map = require('./5map.js');\n\nvar _6tag = require('./6tag.js');\n\nvar _7float = require('./7float.js');\n\nvar defaultEncodeOptions = {\n  float64: false,\n  mapSorter: mapSorter,\n  quickEncodeToken: jump.quickEncodeToken\n};\nvar cborEncoders = [];\ncborEncoders[token.Type.uint.major] = _0uint.encodeUint;\ncborEncoders[token.Type.negint.major] = _1negint.encodeNegint;\ncborEncoders[token.Type.bytes.major] = _2bytes.encodeBytes;\ncborEncoders[token.Type.string.major] = _3string.encodeString;\ncborEncoders[token.Type.array.major] = _4array.encodeArray;\ncborEncoders[token.Type.map.major] = _5map.encodeMap;\ncborEncoders[token.Type.tag.major] = _6tag.encodeTag;\ncborEncoders[token.Type.float.major] = _7float.encodeFloat;\nvar buf = new bl.Bl();\n\nvar Ref = /*#__PURE__*/function () {\n  function Ref(obj, parent) {\n    _classCallCheck(this, Ref);\n\n    this.obj = obj;\n    this.parent = parent;\n  }\n\n  _createClass(Ref, [{\n    key: \"includes\",\n    value: function includes(obj) {\n      var p = this;\n\n      do {\n        if (p.obj === obj) {\n          return true;\n        }\n      } while (p = p.parent);\n\n      return false;\n    }\n  }], [{\n    key: \"createCheck\",\n    value: function createCheck(stack, obj) {\n      if (stack && stack.includes(obj)) {\n        throw new Error(\"\".concat(common.encodeErrPrefix, \" object contains circular references\"));\n      }\n\n      return new Ref(obj, stack);\n    }\n  }]);\n\n  return Ref;\n}();\n\nvar simpleTokens = {\n  null: new token.Token(token.Type.null, null),\n  undefined: new token.Token(token.Type.undefined, undefined),\n  true: new token.Token(token.Type.true, true),\n  false: new token.Token(token.Type.false, false),\n  emptyArray: new token.Token(token.Type.array, 0),\n  emptyMap: new token.Token(token.Type.map, 0)\n};\nvar typeEncoders = {\n  number: function number(obj, _typ, _options, _refStack) {\n    if (!Number.isInteger(obj) || !Number.isSafeInteger(obj)) {\n      return new token.Token(token.Type.float, obj);\n    } else if (obj >= 0) {\n      return new token.Token(token.Type.uint, obj);\n    } else {\n      return new token.Token(token.Type.negint, obj);\n    }\n  },\n  bigint: function bigint(obj, _typ, _options, _refStack) {\n    if (obj >= BigInt(0)) {\n      return new token.Token(token.Type.uint, obj);\n    } else {\n      return new token.Token(token.Type.negint, obj);\n    }\n  },\n  Uint8Array: function Uint8Array(obj, _typ, _options, _refStack) {\n    return new token.Token(token.Type.bytes, obj);\n  },\n  string: function string(obj, _typ, _options, _refStack) {\n    return new token.Token(token.Type.string, obj);\n  },\n  boolean: function boolean(obj, _typ, _options, _refStack) {\n    return obj ? simpleTokens.true : simpleTokens.false;\n  },\n  null: function _null(_obj, _typ, _options, _refStack) {\n    return simpleTokens.null;\n  },\n  undefined: function undefined(_obj, _typ, _options, _refStack) {\n    return simpleTokens.undefined;\n  },\n  ArrayBuffer: function ArrayBuffer(obj, _typ, _options, _refStack) {\n    return new token.Token(token.Type.bytes, new Uint8Array(obj));\n  },\n  DataView: function DataView(obj, _typ, _options, _refStack) {\n    return new token.Token(token.Type.bytes, new Uint8Array(obj.buffer, obj.byteOffset, obj.byteLength));\n  },\n  Array: function Array(obj, _typ, options, refStack) {\n    if (!obj.length) {\n      if (options.addBreakTokens === true) {\n        return [simpleTokens.emptyArray, new token.Token(token.Type.break)];\n      }\n\n      return simpleTokens.emptyArray;\n    }\n\n    refStack = Ref.createCheck(refStack, obj);\n    var entries = [];\n    var i = 0;\n\n    var _iterator = _createForOfIteratorHelper(obj),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var e = _step.value;\n        entries[i++] = objectToTokens(e, options, refStack);\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    if (options.addBreakTokens) {\n      return [new token.Token(token.Type.array, obj.length), entries, new token.Token(token.Type.break)];\n    }\n\n    return [new token.Token(token.Type.array, obj.length), entries];\n  },\n  Object: function (_Object) {\n    function Object(_x, _x2, _x3, _x4) {\n      return _Object.apply(this, arguments);\n    }\n\n    Object.toString = function () {\n      return _Object.toString();\n    };\n\n    return Object;\n  }(function (obj, typ, options, refStack) {\n    var isMap = typ !== 'Object';\n    var keys = isMap ? obj.keys() : Object.keys(obj);\n    var length = isMap ? obj.size : keys.length;\n\n    if (!length) {\n      if (options.addBreakTokens === true) {\n        return [simpleTokens.emptyMap, new token.Token(token.Type.break)];\n      }\n\n      return simpleTokens.emptyMap;\n    }\n\n    refStack = Ref.createCheck(refStack, obj);\n    var entries = [];\n    var i = 0;\n\n    var _iterator2 = _createForOfIteratorHelper(keys),\n        _step2;\n\n    try {\n      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n        var key = _step2.value;\n        entries[i++] = [objectToTokens(key, options, refStack), objectToTokens(isMap ? obj.get(key) : obj[key], options, refStack)];\n      }\n    } catch (err) {\n      _iterator2.e(err);\n    } finally {\n      _iterator2.f();\n    }\n\n    sortMapEntries(entries, options);\n\n    if (options.addBreakTokens) {\n      return [new token.Token(token.Type.map, length), entries, new token.Token(token.Type.break)];\n    }\n\n    return [new token.Token(token.Type.map, length), entries];\n  })\n};\ntypeEncoders.Map = typeEncoders.Object;\ntypeEncoders.Buffer = typeEncoders.Uint8Array;\n\nvar _iterator3 = _createForOfIteratorHelper('Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64'.split(' ')),\n    _step3;\n\ntry {\n  for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n    var typ = _step3.value;\n    typeEncoders[\"\".concat(typ, \"Array\")] = typeEncoders.DataView;\n  }\n} catch (err) {\n  _iterator3.e(err);\n} finally {\n  _iterator3.f();\n}\n\nfunction objectToTokens(obj) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var refStack = arguments.length > 2 ? arguments[2] : undefined;\n  var typ = is.is(obj);\n  var customTypeEncoder = options && options.typeEncoders && options.typeEncoders[typ] || typeEncoders[typ];\n\n  if (typeof customTypeEncoder === 'function') {\n    var tokens = customTypeEncoder(obj, typ, options, refStack);\n\n    if (tokens != null) {\n      return tokens;\n    }\n  }\n\n  var typeEncoder = typeEncoders[typ];\n\n  if (!typeEncoder) {\n    throw new Error(\"\".concat(common.encodeErrPrefix, \" unsupported type: \").concat(typ));\n  }\n\n  return typeEncoder(obj, typ, options, refStack);\n}\n\nfunction sortMapEntries(entries, options) {\n  if (options.mapSorter) {\n    entries.sort(options.mapSorter);\n  }\n}\n\nfunction mapSorter(e1, e2) {\n  var keyToken1 = Array.isArray(e1[0]) ? e1[0][0] : e1[0];\n  var keyToken2 = Array.isArray(e2[0]) ? e2[0][0] : e2[0];\n\n  if (keyToken1.type !== keyToken2.type) {\n    return keyToken1.type.compare(keyToken2.type);\n  }\n\n  var major = keyToken1.type.major;\n  var tcmp = cborEncoders[major].compareTokens(keyToken1, keyToken2);\n\n  if (tcmp === 0) {\n    console.warn('WARNING: complex key types used, CBOR key sorting guarantees are gone');\n  }\n\n  return tcmp;\n}\n\nfunction tokensToEncoded(buf, tokens, encoders, options) {\n  if (Array.isArray(tokens)) {\n    var _iterator4 = _createForOfIteratorHelper(tokens),\n        _step4;\n\n    try {\n      for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n        var _token = _step4.value;\n        tokensToEncoded(buf, _token, encoders, options);\n      }\n    } catch (err) {\n      _iterator4.e(err);\n    } finally {\n      _iterator4.f();\n    }\n  } else {\n    encoders[tokens.type.major](buf, tokens, options);\n  }\n}\n\nfunction encodeCustom(data, encoders, options) {\n  var tokens = objectToTokens(data, options);\n\n  if (!Array.isArray(tokens) && options.quickEncodeToken) {\n    var quickBytes = options.quickEncodeToken(tokens);\n\n    if (quickBytes) {\n      return quickBytes;\n    }\n\n    var encoder = encoders[tokens.type.major];\n\n    if (encoder.encodedSize) {\n      var size = encoder.encodedSize(tokens, options);\n\n      var _buf = new bl.Bl(size);\n\n      encoder(_buf, tokens, options);\n\n      if (_buf.chunks.length !== 1) {\n        throw new Error(\"Unexpected error: pre-calculated length for \".concat(tokens, \" was wrong\"));\n      }\n\n      return byteUtils.asU8A(_buf.chunks[0]);\n    }\n  }\n\n  tokensToEncoded(buf, tokens, encoders, options);\n  return buf.toBytes(true);\n}\n\nfunction encode(data, options) {\n  options = Object.assign({}, defaultEncodeOptions, options);\n  return encodeCustom(data, cborEncoders, options);\n}\n\nexports.Ref = Ref;\nexports.encode = encode;\nexports.encodeCustom = encodeCustom;\nexports.objectToTokens = objectToTokens;","map":{"version":3,"sources":["/Users/sam/Desktop/kiwik/node_modules/cborg/cjs/lib/encode.js"],"names":["Object","defineProperty","exports","value","is","require","token","bl","common","jump","byteUtils","_0uint","_1negint","_2bytes","_3string","_4array","_5map","_6tag","_7float","defaultEncodeOptions","float64","mapSorter","quickEncodeToken","cborEncoders","Type","uint","major","encodeUint","negint","encodeNegint","bytes","encodeBytes","string","encodeString","array","encodeArray","map","encodeMap","tag","encodeTag","float","encodeFloat","buf","Bl","Ref","obj","parent","p","stack","includes","Error","encodeErrPrefix","simpleTokens","null","Token","undefined","true","false","emptyArray","emptyMap","typeEncoders","number","_typ","_options","_refStack","Number","isInteger","isSafeInteger","bigint","BigInt","Uint8Array","boolean","_obj","ArrayBuffer","DataView","buffer","byteOffset","byteLength","Array","options","refStack","length","addBreakTokens","break","createCheck","entries","i","e","objectToTokens","typ","isMap","keys","size","key","get","sortMapEntries","Map","Buffer","split","customTypeEncoder","tokens","typeEncoder","sort","e1","e2","keyToken1","isArray","keyToken2","type","compare","tcmp","compareTokens","console","warn","tokensToEncoded","encoders","encodeCustom","data","quickBytes","encoder","encodedSize","chunks","asU8A","toBytes","encode","assign"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar is = require('./is.js');\nvar token = require('./token.js');\nvar bl = require('./bl.js');\nvar common = require('./common.js');\nvar jump = require('./jump.js');\nvar byteUtils = require('./byte-utils.js');\nvar _0uint = require('./0uint.js');\nvar _1negint = require('./1negint.js');\nvar _2bytes = require('./2bytes.js');\nvar _3string = require('./3string.js');\nvar _4array = require('./4array.js');\nvar _5map = require('./5map.js');\nvar _6tag = require('./6tag.js');\nvar _7float = require('./7float.js');\n\nconst defaultEncodeOptions = {\n  float64: false,\n  mapSorter,\n  quickEncodeToken: jump.quickEncodeToken\n};\nconst cborEncoders = [];\ncborEncoders[token.Type.uint.major] = _0uint.encodeUint;\ncborEncoders[token.Type.negint.major] = _1negint.encodeNegint;\ncborEncoders[token.Type.bytes.major] = _2bytes.encodeBytes;\ncborEncoders[token.Type.string.major] = _3string.encodeString;\ncborEncoders[token.Type.array.major] = _4array.encodeArray;\ncborEncoders[token.Type.map.major] = _5map.encodeMap;\ncborEncoders[token.Type.tag.major] = _6tag.encodeTag;\ncborEncoders[token.Type.float.major] = _7float.encodeFloat;\nconst buf = new bl.Bl();\nclass Ref {\n  constructor(obj, parent) {\n    this.obj = obj;\n    this.parent = parent;\n  }\n  includes(obj) {\n    let p = this;\n    do {\n      if (p.obj === obj) {\n        return true;\n      }\n    } while (p = p.parent);\n    return false;\n  }\n  static createCheck(stack, obj) {\n    if (stack && stack.includes(obj)) {\n      throw new Error(`${ common.encodeErrPrefix } object contains circular references`);\n    }\n    return new Ref(obj, stack);\n  }\n}\nconst simpleTokens = {\n  null: new token.Token(token.Type.null, null),\n  undefined: new token.Token(token.Type.undefined, undefined),\n  true: new token.Token(token.Type.true, true),\n  false: new token.Token(token.Type.false, false),\n  emptyArray: new token.Token(token.Type.array, 0),\n  emptyMap: new token.Token(token.Type.map, 0)\n};\nconst typeEncoders = {\n  number(obj, _typ, _options, _refStack) {\n    if (!Number.isInteger(obj) || !Number.isSafeInteger(obj)) {\n      return new token.Token(token.Type.float, obj);\n    } else if (obj >= 0) {\n      return new token.Token(token.Type.uint, obj);\n    } else {\n      return new token.Token(token.Type.negint, obj);\n    }\n  },\n  bigint(obj, _typ, _options, _refStack) {\n    if (obj >= BigInt(0)) {\n      return new token.Token(token.Type.uint, obj);\n    } else {\n      return new token.Token(token.Type.negint, obj);\n    }\n  },\n  Uint8Array(obj, _typ, _options, _refStack) {\n    return new token.Token(token.Type.bytes, obj);\n  },\n  string(obj, _typ, _options, _refStack) {\n    return new token.Token(token.Type.string, obj);\n  },\n  boolean(obj, _typ, _options, _refStack) {\n    return obj ? simpleTokens.true : simpleTokens.false;\n  },\n  null(_obj, _typ, _options, _refStack) {\n    return simpleTokens.null;\n  },\n  undefined(_obj, _typ, _options, _refStack) {\n    return simpleTokens.undefined;\n  },\n  ArrayBuffer(obj, _typ, _options, _refStack) {\n    return new token.Token(token.Type.bytes, new Uint8Array(obj));\n  },\n  DataView(obj, _typ, _options, _refStack) {\n    return new token.Token(token.Type.bytes, new Uint8Array(obj.buffer, obj.byteOffset, obj.byteLength));\n  },\n  Array(obj, _typ, options, refStack) {\n    if (!obj.length) {\n      if (options.addBreakTokens === true) {\n        return [\n          simpleTokens.emptyArray,\n          new token.Token(token.Type.break)\n        ];\n      }\n      return simpleTokens.emptyArray;\n    }\n    refStack = Ref.createCheck(refStack, obj);\n    const entries = [];\n    let i = 0;\n    for (const e of obj) {\n      entries[i++] = objectToTokens(e, options, refStack);\n    }\n    if (options.addBreakTokens) {\n      return [\n        new token.Token(token.Type.array, obj.length),\n        entries,\n        new token.Token(token.Type.break)\n      ];\n    }\n    return [\n      new token.Token(token.Type.array, obj.length),\n      entries\n    ];\n  },\n  Object(obj, typ, options, refStack) {\n    const isMap = typ !== 'Object';\n    const keys = isMap ? obj.keys() : Object.keys(obj);\n    const length = isMap ? obj.size : keys.length;\n    if (!length) {\n      if (options.addBreakTokens === true) {\n        return [\n          simpleTokens.emptyMap,\n          new token.Token(token.Type.break)\n        ];\n      }\n      return simpleTokens.emptyMap;\n    }\n    refStack = Ref.createCheck(refStack, obj);\n    const entries = [];\n    let i = 0;\n    for (const key of keys) {\n      entries[i++] = [\n        objectToTokens(key, options, refStack),\n        objectToTokens(isMap ? obj.get(key) : obj[key], options, refStack)\n      ];\n    }\n    sortMapEntries(entries, options);\n    if (options.addBreakTokens) {\n      return [\n        new token.Token(token.Type.map, length),\n        entries,\n        new token.Token(token.Type.break)\n      ];\n    }\n    return [\n      new token.Token(token.Type.map, length),\n      entries\n    ];\n  }\n};\ntypeEncoders.Map = typeEncoders.Object;\ntypeEncoders.Buffer = typeEncoders.Uint8Array;\nfor (const typ of 'Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64'.split(' ')) {\n  typeEncoders[`${ typ }Array`] = typeEncoders.DataView;\n}\nfunction objectToTokens(obj, options = {}, refStack) {\n  const typ = is.is(obj);\n  const customTypeEncoder = options && options.typeEncoders && options.typeEncoders[typ] || typeEncoders[typ];\n  if (typeof customTypeEncoder === 'function') {\n    const tokens = customTypeEncoder(obj, typ, options, refStack);\n    if (tokens != null) {\n      return tokens;\n    }\n  }\n  const typeEncoder = typeEncoders[typ];\n  if (!typeEncoder) {\n    throw new Error(`${ common.encodeErrPrefix } unsupported type: ${ typ }`);\n  }\n  return typeEncoder(obj, typ, options, refStack);\n}\nfunction sortMapEntries(entries, options) {\n  if (options.mapSorter) {\n    entries.sort(options.mapSorter);\n  }\n}\nfunction mapSorter(e1, e2) {\n  const keyToken1 = Array.isArray(e1[0]) ? e1[0][0] : e1[0];\n  const keyToken2 = Array.isArray(e2[0]) ? e2[0][0] : e2[0];\n  if (keyToken1.type !== keyToken2.type) {\n    return keyToken1.type.compare(keyToken2.type);\n  }\n  const major = keyToken1.type.major;\n  const tcmp = cborEncoders[major].compareTokens(keyToken1, keyToken2);\n  if (tcmp === 0) {\n    console.warn('WARNING: complex key types used, CBOR key sorting guarantees are gone');\n  }\n  return tcmp;\n}\nfunction tokensToEncoded(buf, tokens, encoders, options) {\n  if (Array.isArray(tokens)) {\n    for (const token of tokens) {\n      tokensToEncoded(buf, token, encoders, options);\n    }\n  } else {\n    encoders[tokens.type.major](buf, tokens, options);\n  }\n}\nfunction encodeCustom(data, encoders, options) {\n  const tokens = objectToTokens(data, options);\n  if (!Array.isArray(tokens) && options.quickEncodeToken) {\n    const quickBytes = options.quickEncodeToken(tokens);\n    if (quickBytes) {\n      return quickBytes;\n    }\n    const encoder = encoders[tokens.type.major];\n    if (encoder.encodedSize) {\n      const size = encoder.encodedSize(tokens, options);\n      const buf = new bl.Bl(size);\n      encoder(buf, tokens, options);\n      if (buf.chunks.length !== 1) {\n        throw new Error(`Unexpected error: pre-calculated length for ${ tokens } was wrong`);\n      }\n      return byteUtils.asU8A(buf.chunks[0]);\n    }\n  }\n  tokensToEncoded(buf, tokens, encoders, options);\n  return buf.toBytes(true);\n}\nfunction encode(data, options) {\n  options = Object.assign({}, defaultEncodeOptions, options);\n  return encodeCustom(data, cborEncoders, options);\n}\n\nexports.Ref = Ref;\nexports.encode = encode;\nexports.encodeCustom = encodeCustom;\nexports.objectToTokens = objectToTokens;\n"]},"metadata":{},"sourceType":"script"}