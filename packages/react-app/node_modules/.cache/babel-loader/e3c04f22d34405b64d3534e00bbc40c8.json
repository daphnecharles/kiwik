{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport React from 'react';\n\nfunction tokenToURL(token) {\n  if (token.type !== 'string') {\n    return;\n  }\n\n  var value = token.string.slice(1).slice(0, -1).trim();\n\n  try {\n    var location_1 = window.location;\n    return new URL(value, location_1.protocol + '//' + location_1.host);\n  } catch (err) {\n    return;\n  }\n}\n\nfunction isImageURL(url) {\n  return /(bmp|gif|jpeg|jpg|png|svg)$/.test(url.pathname);\n}\n\nvar ImagePreview = function (_super) {\n  __extends(ImagePreview, _super);\n\n  function ImagePreview() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this._node = null;\n    _this.state = {\n      width: null,\n      height: null,\n      src: null,\n      mime: null\n    };\n    return _this;\n  }\n\n  ImagePreview.shouldRender = function (token) {\n    var url = tokenToURL(token);\n    return url ? isImageURL(url) : false;\n  };\n\n  ImagePreview.prototype.componentDidMount = function () {\n    this._updateMetadata();\n  };\n\n  ImagePreview.prototype.componentDidUpdate = function () {\n    this._updateMetadata();\n  };\n\n  ImagePreview.prototype.render = function () {\n    var _this = this;\n\n    var _a;\n\n    var dims = null;\n\n    if (this.state.width !== null && this.state.height !== null) {\n      var dimensions = this.state.width + 'x' + this.state.height;\n\n      if (this.state.mime !== null) {\n        dimensions += ' ' + this.state.mime;\n      }\n\n      dims = React.createElement(\"div\", null, dimensions);\n    }\n\n    return React.createElement(\"div\", null, React.createElement(\"img\", {\n      onLoad: function onLoad() {\n        return _this._updateMetadata();\n      },\n      ref: function ref(node) {\n        _this._node = node;\n      },\n      src: (_a = tokenToURL(this.props.token)) === null || _a === void 0 ? void 0 : _a.href\n    }), dims);\n  };\n\n  ImagePreview.prototype._updateMetadata = function () {\n    var _this = this;\n\n    if (!this._node) {\n      return;\n    }\n\n    var width = this._node.naturalWidth;\n    var height = this._node.naturalHeight;\n    var src = this._node.src;\n\n    if (src !== this.state.src) {\n      this.setState({\n        src: src\n      });\n      fetch(src, {\n        method: 'HEAD'\n      }).then(function (response) {\n        _this.setState({\n          mime: response.headers.get('Content-Type')\n        });\n      });\n    }\n\n    if (width !== this.state.width || height !== this.state.height) {\n      this.setState({\n        height: height,\n        width: width\n      });\n    }\n  };\n\n  return ImagePreview;\n}(React.Component);\n\nexport { ImagePreview };","map":{"version":3,"sources":["../../src/components/ImagePreview.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport React from 'react';\nfunction tokenToURL(token) {\n    if (token.type !== 'string') {\n        return;\n    }\n    var value = token.string.slice(1).slice(0, -1).trim();\n    try {\n        var location_1 = window.location;\n        return new URL(value, location_1.protocol + '//' + location_1.host);\n    }\n    catch (err) {\n        return;\n    }\n}\nfunction isImageURL(url) {\n    return /(bmp|gif|jpeg|jpg|png|svg)$/.test(url.pathname);\n}\nvar ImagePreview = (function (_super) {\n    __extends(ImagePreview, _super);\n    function ImagePreview() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this._node = null;\n        _this.state = {\n            width: null,\n            height: null,\n            src: null,\n            mime: null,\n        };\n        return _this;\n    }\n    ImagePreview.shouldRender = function (token) {\n        var url = tokenToURL(token);\n        return url ? isImageURL(url) : false;\n    };\n    ImagePreview.prototype.componentDidMount = function () {\n        this._updateMetadata();\n    };\n    ImagePreview.prototype.componentDidUpdate = function () {\n        this._updateMetadata();\n    };\n    ImagePreview.prototype.render = function () {\n        var _this = this;\n        var _a;\n        var dims = null;\n        if (this.state.width !== null && this.state.height !== null) {\n            var dimensions = this.state.width + 'x' + this.state.height;\n            if (this.state.mime !== null) {\n                dimensions += ' ' + this.state.mime;\n            }\n            dims = React.createElement(\"div\", null, dimensions);\n        }\n        return (React.createElement(\"div\", null,\n            React.createElement(\"img\", { onLoad: function () { return _this._updateMetadata(); }, ref: function (node) {\n                    _this._node = node;\n                }, src: (_a = tokenToURL(this.props.token)) === null || _a === void 0 ? void 0 : _a.href }),\n            dims));\n    };\n    ImagePreview.prototype._updateMetadata = function () {\n        var _this = this;\n        if (!this._node) {\n            return;\n        }\n        var width = this._node.naturalWidth;\n        var height = this._node.naturalHeight;\n        var src = this._node.src;\n        if (src !== this.state.src) {\n            this.setState({ src: src });\n            fetch(src, { method: 'HEAD' }).then(function (response) {\n                _this.setState({\n                    mime: response.headers.get('Content-Type'),\n                });\n            });\n        }\n        if (width !== this.state.width || height !== this.state.height) {\n            this.setState({ height: height, width: width });\n        }\n    };\n    return ImagePreview;\n}(React.Component));\nexport { ImagePreview };\n//# sourceMappingURL=ImagePreview.js.map"]},"metadata":{},"sourceType":"module"}