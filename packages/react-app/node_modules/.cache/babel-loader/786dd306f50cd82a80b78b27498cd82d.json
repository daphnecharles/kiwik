{"ast":null,"code":"var _regeneratorRuntime = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nmodule.exports = getBlocksForRange;\n\nfunction getBlocksForRange(_x) {\n  return _getBlocksForRange.apply(this, arguments);\n}\n\nfunction _getBlocksForRange() {\n  _getBlocksForRange = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n    var provider, fromBlock, toBlock, fromBlockNumber, toBlockNumber, blockCountToQuery, missingBlockNumbers, blockBodies;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            provider = _ref.provider, fromBlock = _ref.fromBlock, toBlock = _ref.toBlock;\n            if (!fromBlock) fromBlock = toBlock;\n            fromBlockNumber = hexToInt(fromBlock);\n            toBlockNumber = hexToInt(toBlock);\n            blockCountToQuery = toBlockNumber - fromBlockNumber + 1; // load all blocks from old to new (inclusive)\n\n            missingBlockNumbers = Array(blockCountToQuery).fill().map(function (_, index) {\n              return fromBlockNumber + index;\n            }).map(intToHex);\n            _context.next = 8;\n            return Promise.all(missingBlockNumbers.map(function (blockNum) {\n              return query(provider, 'eth_getBlockByNumber', [blockNum, false]);\n            }));\n\n          case 8:\n            blockBodies = _context.sent;\n            return _context.abrupt(\"return\", blockBodies);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _getBlocksForRange.apply(this, arguments);\n}\n\nfunction hexToInt(hexString) {\n  if (hexString === undefined || hexString === null) return hexString;\n  return Number.parseInt(hexString, 16);\n}\n\nfunction incrementHexInt(hexString) {\n  if (hexString === undefined || hexString === null) return hexString;\n  var value = hexToInt(hexString);\n  return intToHex(value + 1);\n}\n\nfunction intToHex(int) {\n  if (int === undefined || int === null) return int;\n  var hexString = int.toString(16);\n  return '0x' + hexString;\n}\n\nfunction query(provider, method, params) {\n  return new Promise(function (resolve, reject) {\n    provider.sendAsync({\n      id: 1,\n      jsonrpc: '2.0',\n      method: method,\n      params: params\n    }, function (err, res) {\n      if (err) return reject(err);\n      resolve(res.result);\n    });\n  });\n}","map":{"version":3,"sources":["/Users/sam/Desktop/kiwik/node_modules/eth-json-rpc-filters/getBlocksForRange.js"],"names":["module","exports","getBlocksForRange","provider","fromBlock","toBlock","fromBlockNumber","hexToInt","toBlockNumber","blockCountToQuery","missingBlockNumbers","Array","fill","map","_","index","intToHex","Promise","all","blockNum","query","blockBodies","hexString","undefined","Number","parseInt","incrementHexInt","value","int","toString","method","params","resolve","reject","sendAsync","id","jsonrpc","err","res","result"],"mappings":";;;;AAAAA,MAAM,CAACC,OAAP,GAAiBC,iBAAjB;;SAEeA,iB;;;;;gFAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAmCC,YAAAA,QAAnC,QAAmCA,QAAnC,EAA6CC,SAA7C,QAA6CA,SAA7C,EAAwDC,OAAxD,QAAwDA,OAAxD;AACE,gBAAI,CAACD,SAAL,EAAgBA,SAAS,GAAGC,OAAZ;AAEVC,YAAAA,eAHR,GAG0BC,QAAQ,CAACH,SAAD,CAHlC;AAIQI,YAAAA,aAJR,GAIwBD,QAAQ,CAACF,OAAD,CAJhC;AAKQI,YAAAA,iBALR,GAK4BD,aAAa,GAAGF,eAAhB,GAAkC,CAL9D,EAME;;AACMI,YAAAA,mBAPR,GAO8BC,KAAK,CAACF,iBAAD,CAAL,CAAyBG,IAAzB,GACCC,GADD,CACK,UAACC,CAAD,EAAGC,KAAH;AAAA,qBAAaT,eAAe,GAAGS,KAA/B;AAAA,aADL,EAECF,GAFD,CAEKG,QAFL,CAP9B;AAAA;AAAA,mBAU4BC,OAAO,CAACC,GAAR,CACxBR,mBAAmB,CAACG,GAApB,CAAwB,UAAAM,QAAQ;AAAA,qBAAIC,KAAK,CAACjB,QAAD,EAAW,sBAAX,EAAmC,CAACgB,QAAD,EAAW,KAAX,CAAnC,CAAT;AAAA,aAAhC,CADwB,CAV5B;;AAAA;AAUQE,YAAAA,WAVR;AAAA,6CAaSA,WAbT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAgBA,SAASd,QAAT,CAAkBe,SAAlB,EAA6B;AAC3B,MAAIA,SAAS,KAAKC,SAAd,IAA2BD,SAAS,KAAK,IAA7C,EAAmD,OAAOA,SAAP;AACnD,SAAOE,MAAM,CAACC,QAAP,CAAgBH,SAAhB,EAA2B,EAA3B,CAAP;AACD;;AAED,SAASI,eAAT,CAAyBJ,SAAzB,EAAmC;AACjC,MAAIA,SAAS,KAAKC,SAAd,IAA2BD,SAAS,KAAK,IAA7C,EAAmD,OAAOA,SAAP;AACnD,MAAMK,KAAK,GAAGpB,QAAQ,CAACe,SAAD,CAAtB;AACA,SAAON,QAAQ,CAACW,KAAK,GAAG,CAAT,CAAf;AACD;;AAED,SAASX,QAAT,CAAkBY,GAAlB,EAAuB;AACrB,MAAIA,GAAG,KAAKL,SAAR,IAAqBK,GAAG,KAAK,IAAjC,EAAuC,OAAOA,GAAP;AACvC,MAAMN,SAAS,GAAGM,GAAG,CAACC,QAAJ,CAAa,EAAb,CAAlB;AACA,SAAO,OAAOP,SAAd;AACD;;AAED,SAASF,KAAT,CAAejB,QAAf,EAAyB2B,MAAzB,EAAiCC,MAAjC,EAAyC;AACvC,SAAO,IAAId,OAAJ,CAAY,UAACe,OAAD,EAAUC,MAAV,EAAqB;AACtC9B,IAAAA,QAAQ,CAAC+B,SAAT,CAAmB;AAAEC,MAAAA,EAAE,EAAE,CAAN;AAASC,MAAAA,OAAO,EAAE,KAAlB;AAAyBN,MAAAA,MAAM,EAANA,MAAzB;AAAiCC,MAAAA,MAAM,EAANA;AAAjC,KAAnB,EAA8D,UAACM,GAAD,EAAMC,GAAN,EAAc;AAC1E,UAAID,GAAJ,EAAS,OAAOJ,MAAM,CAACI,GAAD,CAAb;AACTL,MAAAA,OAAO,CAACM,GAAG,CAACC,MAAL,CAAP;AACD,KAHD;AAID,GALM,CAAP;AAMD","sourcesContent":["module.exports = getBlocksForRange\n\nasync function getBlocksForRange({ provider, fromBlock, toBlock }) {\n  if (!fromBlock) fromBlock = toBlock\n\n  const fromBlockNumber = hexToInt(fromBlock)\n  const toBlockNumber = hexToInt(toBlock)\n  const blockCountToQuery = toBlockNumber - fromBlockNumber + 1\n  // load all blocks from old to new (inclusive)\n  const missingBlockNumbers = Array(blockCountToQuery).fill()\n                              .map((_,index) => fromBlockNumber + index)\n                              .map(intToHex)\n  const blockBodies = await Promise.all(\n    missingBlockNumbers.map(blockNum => query(provider, 'eth_getBlockByNumber', [blockNum, false]))\n  )\n  return blockBodies\n}\n\nfunction hexToInt(hexString) {\n  if (hexString === undefined || hexString === null) return hexString\n  return Number.parseInt(hexString, 16)\n}\n\nfunction incrementHexInt(hexString){\n  if (hexString === undefined || hexString === null) return hexString\n  const value = hexToInt(hexString)\n  return intToHex(value + 1)\n}\n\nfunction intToHex(int) {\n  if (int === undefined || int === null) return int\n  const hexString = int.toString(16)\n  return '0x' + hexString\n}\n\nfunction query(provider, method, params) {\n  return new Promise((resolve, reject) => {\n    provider.sendAsync({ id: 1, jsonrpc: '2.0', method, params }, (err, res) => {\n      if (err) return reject(err)\n      resolve(res.result)\n    })\n  })\n}\n"]},"metadata":{},"sourceType":"script"}