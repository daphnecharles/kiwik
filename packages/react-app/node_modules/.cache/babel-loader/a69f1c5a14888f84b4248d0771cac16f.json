{"ast":null,"code":"/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\n\nimport * as utils from '../utils';\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams = function getLocalStreams() {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n\n      return this._localStreams;\n    };\n  }\n\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    var _addTrack = window.RTCPeerConnection.prototype.addTrack;\n\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      var _this = this;\n\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      } // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n\n\n      stream.getAudioTracks().forEach(function (track) {\n        return _addTrack.call(_this, track, stream);\n      });\n      stream.getVideoTracks().forEach(function (track) {\n        return _addTrack.call(_this, track, stream);\n      });\n    };\n\n    window.RTCPeerConnection.prototype.addTrack = function addTrack(track) {\n      var _this2 = this;\n\n      for (var _len = arguments.length, streams = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        streams[_key - 1] = arguments[_key];\n      }\n\n      if (streams) {\n        streams.forEach(function (stream) {\n          if (!_this2._localStreams) {\n            _this2._localStreams = [stream];\n          } else if (!_this2._localStreams.includes(stream)) {\n            _this2._localStreams.push(stream);\n          }\n        });\n      }\n\n      return _addTrack.apply(this, arguments);\n    };\n  }\n\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream = function removeStream(stream) {\n      var _this3 = this;\n\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n\n      var index = this._localStreams.indexOf(stream);\n\n      if (index === -1) {\n        return;\n      }\n\n      this._localStreams.splice(index, 1);\n\n      var tracks = stream.getTracks();\n      this.getSenders().forEach(function (sender) {\n        if (tracks.includes(sender.track)) {\n          _this3.removeTrack(sender);\n        }\n      });\n    };\n  }\n}\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams = function getRemoteStreams() {\n      return this._remoteStreams ? this._remoteStreams : [];\n    };\n  }\n\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get: function get() {\n        return this._onaddstream;\n      },\n      set: function set(f) {\n        var _this4 = this;\n\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = function (e) {\n          e.streams.forEach(function (stream) {\n            if (!_this4._remoteStreams) {\n              _this4._remoteStreams = [];\n            }\n\n            if (_this4._remoteStreams.includes(stream)) {\n              return;\n            }\n\n            _this4._remoteStreams.push(stream);\n\n            var event = new Event('addstream');\n            event.stream = stream;\n\n            _this4.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    var origSetRemoteDescription = window.RTCPeerConnection.prototype.setRemoteDescription;\n\n    window.RTCPeerConnection.prototype.setRemoteDescription = function setRemoteDescription() {\n      var pc = this;\n\n      if (!this._onaddstreampoly) {\n        this.addEventListener('track', this._onaddstreampoly = function (e) {\n          e.streams.forEach(function (stream) {\n            if (!pc._remoteStreams) {\n              pc._remoteStreams = [];\n            }\n\n            if (pc._remoteStreams.indexOf(stream) >= 0) {\n              return;\n            }\n\n            pc._remoteStreams.push(stream);\n\n            var event = new Event('addstream');\n            event.stream = stream;\n            pc.dispatchEvent(event);\n          });\n        });\n      }\n\n      return origSetRemoteDescription.apply(pc, arguments);\n    };\n  }\n}\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n\n  var prototype = window.RTCPeerConnection.prototype;\n  var origCreateOffer = prototype.createOffer;\n  var origCreateAnswer = prototype.createAnswer;\n  var setLocalDescription = prototype.setLocalDescription;\n  var setRemoteDescription = prototype.setRemoteDescription;\n  var addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer = function createOffer(successCallback, failureCallback) {\n    var options = arguments.length >= 2 ? arguments[2] : arguments[0];\n    var promise = origCreateOffer.apply(this, [options]);\n\n    if (!failureCallback) {\n      return promise;\n    }\n\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n\n  prototype.createAnswer = function createAnswer(successCallback, failureCallback) {\n    var options = arguments.length >= 2 ? arguments[2] : arguments[0];\n    var promise = origCreateAnswer.apply(this, [options]);\n\n    if (!failureCallback) {\n      return promise;\n    }\n\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n\n  var withCallback = function withCallback(description, successCallback, failureCallback) {\n    var promise = setLocalDescription.apply(this, [description]);\n\n    if (!failureCallback) {\n      return promise;\n    }\n\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function withCallback(description, successCallback, failureCallback) {\n    var promise = setRemoteDescription.apply(this, [description]);\n\n    if (!failureCallback) {\n      return promise;\n    }\n\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function withCallback(candidate, successCallback, failureCallback) {\n    var promise = addIceCandidate.apply(this, [candidate]);\n\n    if (!failureCallback) {\n      return promise;\n    }\n\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n\n  prototype.addIceCandidate = withCallback;\n}\nexport function shimGetUserMedia(window) {\n  var navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    var mediaDevices = navigator.mediaDevices;\n\n    var _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n\n    navigator.mediaDevices.getUserMedia = function (constraints) {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints).then(cb, errcb);\n    }.bind(navigator);\n  }\n}\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({}, constraints, {\n      video: utils.compactObject(constraints.video)\n    });\n  }\n\n  return constraints;\n}\nexport function shimRTCIceServerUrls(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  } // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n\n\n  var OrigPeerConnection = window.RTCPeerConnection;\n\n  window.RTCPeerConnection = function RTCPeerConnection(pcConfig, pcConstraints) {\n    if (pcConfig && pcConfig.iceServers) {\n      var newIceServers = [];\n\n      for (var i = 0; i < pcConfig.iceServers.length; i++) {\n        var server = pcConfig.iceServers[i];\n\n        if (!server.hasOwnProperty('urls') && server.hasOwnProperty('url')) {\n          utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n          server = JSON.parse(JSON.stringify(server));\n          server.urls = server.url;\n          delete server.url;\n          newIceServers.push(server);\n        } else {\n          newIceServers.push(pcConfig.iceServers[i]);\n        }\n      }\n\n      pcConfig.iceServers = newIceServers;\n    }\n\n    return new OrigPeerConnection(pcConfig, pcConstraints);\n  };\n\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype; // wrap static methods. Currently just generateCertificate.\n\n  if ('generateCertificate' in OrigPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get: function get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent && 'receiver' in window.RTCTrackEvent.prototype && !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get: function get() {\n        return {\n          receiver: this.receiver\n        };\n      }\n    });\n  }\n}\nexport function shimCreateOfferLegacy(window) {\n  var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n\n  window.RTCPeerConnection.prototype.createOffer = function createOffer(offerOptions) {\n    if (offerOptions) {\n      if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n        // support bit values\n        offerOptions.offerToReceiveAudio = !!offerOptions.offerToReceiveAudio;\n      }\n\n      var audioTransceiver = this.getTransceivers().find(function (transceiver) {\n        return transceiver.receiver.track.kind === 'audio';\n      });\n\n      if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n        if (audioTransceiver.direction === 'sendrecv') {\n          if (audioTransceiver.setDirection) {\n            audioTransceiver.setDirection('sendonly');\n          } else {\n            audioTransceiver.direction = 'sendonly';\n          }\n        } else if (audioTransceiver.direction === 'recvonly') {\n          if (audioTransceiver.setDirection) {\n            audioTransceiver.setDirection('inactive');\n          } else {\n            audioTransceiver.direction = 'inactive';\n          }\n        }\n      } else if (offerOptions.offerToReceiveAudio === true && !audioTransceiver) {\n        this.addTransceiver('audio');\n      }\n\n      if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n        // support bit values\n        offerOptions.offerToReceiveVideo = !!offerOptions.offerToReceiveVideo;\n      }\n\n      var videoTransceiver = this.getTransceivers().find(function (transceiver) {\n        return transceiver.receiver.track.kind === 'video';\n      });\n\n      if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n        if (videoTransceiver.direction === 'sendrecv') {\n          if (videoTransceiver.setDirection) {\n            videoTransceiver.setDirection('sendonly');\n          } else {\n            videoTransceiver.direction = 'sendonly';\n          }\n        } else if (videoTransceiver.direction === 'recvonly') {\n          if (videoTransceiver.setDirection) {\n            videoTransceiver.setDirection('inactive');\n          } else {\n            videoTransceiver.direction = 'inactive';\n          }\n        }\n      } else if (offerOptions.offerToReceiveVideo === true && !videoTransceiver) {\n        this.addTransceiver('video');\n      }\n    }\n\n    return origCreateOffer.apply(this, arguments);\n  };\n}\nexport function shimAudioContext(window) {\n  if (typeof window !== 'object' || window.AudioContext) {\n    return;\n  }\n\n  window.AudioContext = window.webkitAudioContext;\n}","map":{"version":3,"sources":["/Users/sam/Desktop/kiwik/node_modules/webrtc-adapter/src/js/safari/safari_shim.js"],"names":["utils","shimLocalStreamsAPI","window","RTCPeerConnection","prototype","getLocalStreams","_localStreams","_addTrack","addTrack","addStream","stream","includes","push","getAudioTracks","forEach","track","call","getVideoTracks","streams","apply","arguments","removeStream","index","indexOf","splice","tracks","getTracks","getSenders","sender","removeTrack","shimRemoteStreamsAPI","getRemoteStreams","_remoteStreams","Object","defineProperty","get","_onaddstream","set","f","removeEventListener","_onaddstreampoly","addEventListener","e","event","Event","dispatchEvent","origSetRemoteDescription","setRemoteDescription","pc","shimCallbacksAPI","origCreateOffer","createOffer","origCreateAnswer","createAnswer","setLocalDescription","addIceCandidate","successCallback","failureCallback","options","length","promise","then","Promise","resolve","withCallback","description","candidate","shimGetUserMedia","navigator","mediaDevices","getUserMedia","_getUserMedia","bind","constraints","shimConstraints","cb","errcb","video","undefined","assign","compactObject","shimRTCIceServerUrls","OrigPeerConnection","pcConfig","pcConstraints","iceServers","newIceServers","i","server","hasOwnProperty","deprecated","JSON","parse","stringify","urls","url","generateCertificate","shimTrackEventTransceiver","RTCTrackEvent","receiver","shimCreateOfferLegacy","offerOptions","offerToReceiveAudio","audioTransceiver","getTransceivers","find","transceiver","kind","direction","setDirection","addTransceiver","offerToReceiveVideo","videoTransceiver","shimAudioContext","AudioContext","webkitAudioContext"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track, ...streams) {\n        if (streams) {\n          streams.forEach((stream) => {\n            if (!this._localStreams) {\n              this._localStreams = [stream];\n            } else if (!this._localStreams.includes(stream)) {\n              this._localStreams.push(stream);\n            }\n          });\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n      .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in OrigPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio');\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n\nexport function shimAudioContext(window) {\n  if (typeof window !== 'object' || window.AudioContext) {\n    return;\n  }\n  window.AudioContext = window.webkitAudioContext;\n}\n"]},"metadata":{},"sourceType":"module"}