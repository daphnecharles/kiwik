{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _classCallCheck = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _possibleConstructorReturn = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/possibleConstructorReturn\");\n\nvar _assertThisInitialized = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/assertThisInitialized\");\n\nvar _inherits = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"/Users/sam/Desktop/kiwik/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar penpal_1 = __importDefault(require(\"penpal\"));\n\nvar eventemitter3_1 = __importDefault(require(\"eventemitter3\"));\n\nvar is_buffer_1 = __importDefault(require(\"is-buffer\"));\n\nvar version_1 = __importDefault(require(\"./version\"));\n\nvar AuthereumProvider_1 = __importDefault(require(\"./AuthereumProvider\"));\n\nvar StarkWareProvider_1 = __importDefault(require(\"./StarkWareProvider\"));\n\nvar ZkSyncProvider_1 = __importDefault(require(\"./ZkSyncProvider\"));\n\nvar config_1 = require(\"./config\");\n\nvar utils_1 = require(\"./utils\"); // Serialize object for postMessage to iframe.\n// Converts references to values.\n\n\nvar serializeMessageObj = function serializeMessageObj(obj) {\n  var tx = {};\n\n  for (var k in obj) {\n    var v = obj[k];\n\n    if (typeof v === 'object' && v.toString === 'function') {\n      v = v.toString('hex');\n    }\n\n    tx[k] = v;\n  }\n\n  return tx;\n};\n\nvar defaultIframeStyle = {\n  width: 0,\n  height: 0,\n  top: 0,\n  left: 0,\n  zIndex: 1\n};\n\nvar noop = function noop() {// noop\n}; // This is a placeholder notify object stub until notifier script url is\n// injected into page after iframe is loaded.\n\n\nvar defaultNotifier = {\n  notify: function notify(type, message) {\n    console.debug(type, message);\n    return {\n      dismiss: noop\n    };\n  }\n};\n\nvar constructIframe = function constructIframe(input) {\n  var id = input.id,\n      url = input.url,\n      isPreload = input.isPreload,\n      disableGoogleAnalytics = input.disableGoogleAnalytics;\n  var parentUrl = window.location.href;\n\n  try {\n    parentUrl = parent.document.URL;\n  } catch (err) {// noop\n  }\n\n  var srcUrl = utils_1.updateQueryParams({\n    url: parentUrl,\n    isPreload: isPreload,\n    disableGoogleAnalytics: disableGoogleAnalytics\n  }, url);\n  var iframe = document.createElement('iframe');\n  iframe.id = id;\n  iframe.name = id.replace(/--.*/, '');\n  iframe.title = id;\n  iframe.src = srcUrl;\n\n  if (['Safari', 'Firefox'].includes(utils_1.browserInfo().browser)) {\n    iframe.setAttribute('sandbox', 'allow-storage-access-by-user-activation allow-scripts allow-same-origin');\n  }\n\n  iframe.style.position = 'fixed';\n  iframe.style.bottom = '0';\n  iframe.style.right = '0';\n  iframe.style.width = '0';\n  iframe.style.height = '0';\n  iframe.style.border = '0';\n  iframe.style.background = 'transparent';\n  iframe.style.zIndex = \"\".concat(defaultIframeStyle.zIndex);\n  iframe.setAttribute('frameborder', '0');\n  iframe.setAttribute('scrolling', 'no');\n  return iframe;\n};\n\nvar onDomReady = function onDomReady() {\n  return new Promise(function (resolve) {\n    if (typeof window !== 'undefined') {\n      if (document.readyState !== 'loading') {\n        resolve();\n      } else {\n        document.addEventListener('DOMContentLoaded', function () {\n          return resolve();\n        });\n      }\n    }\n  });\n};\n\nvar Authereum = /*#__PURE__*/function (_eventemitter3_1$defa) {\n  _inherits(Authereum, _eventemitter3_1$defa);\n\n  var _super = _createSuper(Authereum);\n\n  function Authereum(config) {\n    var _this;\n\n    _classCallCheck(this, Authereum);\n\n    _this = _super.call(this);\n    _this._debug = !!utils_1.getQueryParamValue('debug');\n    _this._notifier = defaultNotifier;\n    _this._cacheReady = false;\n    _this._iframeReady = false;\n    _this._configReady = false;\n    _this._iframeConnecting = null;\n    _this._readyEmitted = false;\n    _this._widgetEnabled = false;\n    _this._iframeStyle = defaultIframeStyle;\n    _this._notificationIframeStyle = defaultIframeStyle;\n    _this._blockedPopupRedirect = true;\n    _this._forceRedirect = false;\n    _this._heartbeatStarted = false;\n    _this._backoffTimeout = 1;\n    _this._userConfig = null;\n    _this._asymmetricEncryptionKey = null;\n    _this._authereumQueryParams = {};\n    _this._injectedElements = [];\n    _this._notificationsMap = {};\n    _this._destroyed = false;\n    _this._starkProvider = null;\n    _this._zkSyncProvider = null;\n    _this._isPreload = false;\n    _this._disableGoogleAnalytics = false;\n    _this._eventListeners = []; // NOTE: keep this sync\n\n    _this._init = function (config) {\n      _this._initConfig(config);\n\n      _this._iframeStyle = {\n        width: 0,\n        height: 0,\n        top: 0,\n        left: 0,\n        zIndex: 0\n      };\n      _this._provider = new AuthereumProvider_1.default(_assertThisInitialized(_this));\n\n      _this._connectToChildIframe().catch(function () {\n        _this._startHeartbeat(true);\n      }).catch(function (err) {\n        console.warn('ping error:', err.message);\n      });\n\n      _this._setupCache().catch(noop);\n\n      _this._cacheAuthereumQueryParams();\n\n      _this._setupSigningKey().catch(noop);\n\n      _this._setupResizeListener();\n\n      _this._setupFocusListener();\n\n      _this._setupActionKeyListener();\n\n      _this._emitReadyEvent();\n    }; // NOTE: keep this sync\n\n\n    _this._initConfig = function (config) {\n      if (typeof config === 'string') {\n        var network = config;\n        _this._networkName = (network || '').trim().toLowerCase();\n\n        if (['mainnet', 'ropsten', 'rinkeby', 'kovan', 'goerli'].includes(_this._networkName)) {\n          _this._xsUri = config_1.defaultConfig.xsUri(_this._networkName);\n        } else if (config === 'localhost') {\n          _this._xsUri = 'http://localhost:3002';\n          _this._networkName = 'kovan';\n        } else {\n          throw new Error('Unsupported network');\n        }\n      } else {\n        config = config || {};\n        _this._networkName = config.networkName || 'mainnet';\n        _this._xsUri = config.xsUri || config_1.defaultConfig.xsUri(_this._networkName);\n        _this._apiKey = config.apiKey;\n      }\n\n      if (config.redirectUri) {\n        _this._redirectUri = config.redirectUri;\n      } else {\n        _this._redirectUri = window.location.href;\n      }\n\n      _this._redirectUri = _this._redirectUri || window.location.href;\n    }; // NOTE: keep this sync\n\n\n    _this._setConfig = function (config) {\n      if (typeof _this._userConfig === 'string') {\n        var network = _this._userConfig;\n        _this._networkName = (network || '').trim().toLowerCase();\n        _this._userConfig = {\n          networkName: _this._networkName,\n          xsUri: config_1.defaultConfig.xsUri(_this._networkName)\n        };\n      }\n\n      var _ref = _this._userConfig || {},\n          apiKey = _ref.apiKey,\n          apiUri = _ref.apiUri,\n          rpcUri = _ref.rpcUri,\n          webUri = _ref.webUri,\n          notifierUri = _ref.notifierUri,\n          networkName = _ref.networkName,\n          networkId = _ref.networkId,\n          disableNotifications = _ref.disableNotifications,\n          blockedPopupRedirect = _ref.blockedPopupRedirect,\n          forceRedirect = _ref.forceRedirect;\n\n      if (apiKey) {\n        _this._apiKey = apiKey;\n      } // userConfig overrides regular config\n\n\n      if (apiUri) {\n        _this._apiUri = apiUri;\n      } else if (config.apiUri) {\n        _this._apiUri = config.apiUri;\n      } // userConfig overrides regular config\n\n\n      if (rpcUri) {\n        _this._rpcUri = rpcUri;\n      } else if (config.rpcUri) {\n        _this._rpcUri = config.rpcUri;\n      } // userConfig overrides regular config\n\n\n      if (webUri) {\n        _this._webUri = webUri;\n      } else if (config.webUri) {\n        _this._webUri = config.webUri;\n      } // userConfig overrides regular config\n\n\n      if (notifierUri) {\n        _this._notifierUri = notifierUri;\n      } else if (config.notifierUri) {\n        _this._notifierUri = config.notifierUri;\n      } // userConfig overrides regular config\n\n\n      if (networkName) {\n        _this._networkName = networkName;\n      } else if (config.networkName) {\n        _this._networkName = config.networkName;\n      } // userConfig overrides regular config\n\n\n      if (networkId) {\n        _this._networkId = networkId;\n      } else if (config.networkId) {\n        _this._networkId = config.networkId;\n      } // userConfig overrides regular config\n\n\n      if (typeof disableNotifications === 'boolean') {\n        _this._disableNotifications = disableNotifications;\n      } else if (typeof config.disableNotifications === 'boolean') {\n        _this._disableNotifications = config.disableNotifications;\n      } // userConfig overrides regular config\n\n\n      if (typeof blockedPopupRedirect === 'boolean') {\n        _this._blockedPopupRedirect = blockedPopupRedirect;\n      } else if (typeof config.blockedPopupRedirect === 'boolean') {\n        _this._blockedPopupRedirect = config.blockedPopupRedirect;\n      } // userConfig overrides regular config\n\n\n      if (typeof forceRedirect === 'boolean') {\n        _this._forceRedirect = forceRedirect;\n      } else if (typeof config.forceRedirect === 'boolean') {\n        _this._forceRedirect = config.forceRedirect;\n      }\n    };\n\n    _this._setupCache = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return Promise.all([this._cacheLoginKeyAddress(), this._cacheIsAuthenticated(), this._cacheAccountAddress()]);\n\n              case 2:\n                this._cacheReady = true;\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n    };\n\n    _this._handleWindowFocus = function () {\n      if (_this._destroyed) {\n        return;\n      }\n\n      if (!_this._bodyContainsIframe()) {\n        return;\n      }\n\n      return _this._postMessageToChild({\n        method: 'onWindowFocus'\n      });\n    };\n\n    _this._resetCache = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", this._setupCache());\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n    };\n\n    _this._injectScript = function (sourceUrl) {\n      var id = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var _this2 = this;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this._tilDomReady();\n\n              case 2:\n                return _context3.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  if (!sourceUrl) {\n                    throw new Error('sourceUrl is required');\n                  }\n\n                  if (document.getElementById(id)) {\n                    resolve();\n                    return;\n                  }\n\n                  var script = document.createElement('script');\n                  script.id = id;\n                  script.type = 'text/javascript';\n                  script.async = true;\n\n                  script.onload = function () {\n                    resolve();\n                  };\n\n                  script.onerror = function (err) {\n                    reject(err);\n                  };\n\n                  script.src = sourceUrl;\n\n                  _this2._injectedElements.push(script);\n\n                  document.getElementsByTagName('head')[0].appendChild(script);\n                }));\n\n              case 3:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n    };\n\n    _this._setupResizeListener = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                this.addEventListener('resize', this._handleResizeThrottled, false);\n                this.addEventListener('resize', this._handleResizeDebounced, false);\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n    };\n\n    _this._handleActionKeyPress = function (event) {\n      if (_this._destroyed) {\n        return;\n      }\n\n      if (!_this._bodyContainsIframe()) {\n        return;\n      }\n\n      var keyName = '';\n\n      if (event.key === 'Escape' || event.key === 'Esc' || event.keyCode === 27) {\n        keyName = 'escape';\n      } else if (event.key === 'Enter' || event.keyCode === 13) {\n        keyName = 'enter';\n      } else if (event.key === 'ArrowLeft' || event.keyCode === 37) {\n        keyName = 'left';\n      } else if (event.key === 'ArrowUp' || event.keyCode === 38) {\n        keyName = 'up';\n      } else if (event.key === 'ArrowRight' || event.keyCode === 39) {\n        keyName = 'right';\n      } else if (event.key === 'ArrowDown' || event.keyCode === 40) {\n        keyName = 'down';\n      }\n\n      if (keyName) {\n        return _this._postMessageToChild({\n          method: 'actionKeyPress',\n          params: keyName\n        });\n      }\n    };\n\n    _this._handleResize = function (event) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var size;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (!this._destroyed) {\n                  _context5.next = 2;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\");\n\n              case 2:\n                if (this._bodyContainsIframe()) {\n                  _context5.next = 4;\n                  break;\n                }\n\n                return _context5.abrupt(\"return\");\n\n              case 4:\n                _context5.next = 6;\n                return this._getWindowSize();\n\n              case 6:\n                size = _context5.sent;\n                return _context5.abrupt(\"return\", this._postMessageToChild({\n                  method: 'onResize',\n                  params: size\n                }));\n\n              case 8:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n    };\n\n    _this._handleResizeThrottled = utils_1.throttle(function (event) {\n      return _this._handleResize(event);\n    }, 10);\n    _this._handleResizeDebounced = utils_1.debounce(function (event) {\n      return _this._handleResize(event);\n    }, 10);\n\n    _this._cacheLoginKeyAddress = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n        var loginKey;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return this._postMessageToChild({\n                  method: 'getOrCreateLoginKey'\n                });\n\n              case 2:\n                loginKey = _context6.sent;\n                this._cachedLoginKeyAddress = loginKey.publicAddress;\n\n              case 4:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n    };\n\n    _this._cacheAccountAddress = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n        var accountAddress;\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return this._postMessageToChild({\n                  method: 'getAccountAddress'\n                });\n\n              case 2:\n                accountAddress = _context7.sent;\n                this._cachedAccountAddress = accountAddress;\n\n              case 4:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n    };\n\n    _this._cacheIsAuthenticated = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee8() {\n        var isAuthenticated;\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.next = 2;\n                return this._postMessageToChild({\n                  method: 'isAuthenticated'\n                });\n\n              case 2:\n                isAuthenticated = _context8.sent;\n                this._cachedIsAuthenticated = isAuthenticated;\n\n              case 4:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n    }; // NOTE: to prevent pop-ups from being blocked, there must be no awaits from\n    // click to window.open, meaning value lookups must be cached before the\n    // login method is called.\n\n\n    _this.login = utils_1.throttle(function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee9() {\n        var _this3 = this;\n\n        var isIframeReady, isConfigReady, account;\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                isIframeReady = this._iframeReady && this._cacheReady;\n                isConfigReady = this._configReady; // these are false when dapp calls login immediately on page load\n                // so we're forced to wait here.\n\n                if (isIframeReady && isConfigReady) {\n                  _context9.next = 7;\n                  break;\n                }\n\n                _context9.next = 5;\n                return this._tilConfigReady();\n\n              case 5:\n                _context9.next = 7;\n                return this._tilReady();\n\n              case 7:\n                if (this._cachedIsAuthenticated) {\n                  _context9.next = 13;\n                  break;\n                }\n\n                _context9.next = 10;\n                return this._signLoginKeyRequest(this._cachedLoginKeyAddress);\n\n              case 10:\n                return _context9.abrupt(\"return\", this.getAuthenticatedAccount());\n\n              case 13:\n                // only show one already logged in notification at a time\n                if (!this._notificationsMap['loggedIn']) {\n                  this._postMessageToChild({\n                    method: 'notification',\n                    params: {\n                      type: 'success',\n                      message: 'You are logged into Authereum',\n                      timeout: 5e3\n                    }\n                  }).catch(noop);\n\n                  this._notificationsMap['loggedIn'] = true;\n                  setTimeout(function () {\n                    _this3._notificationsMap['loggedIn'] = null;\n                  }, 5e3);\n                }\n\n              case 14:\n                _context9.next = 16;\n                return this.getAuthenticatedAccount();\n\n              case 16:\n                account = _context9.sent;\n                return _context9.abrupt(\"return\", account);\n\n              case 18:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n    }, 250);\n\n    _this.authenticate = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee10() {\n        return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                console.warn('Deprecation notice: `authereum.authenticate()` is deprecated. Use `authereum.login()` instead.');\n                return _context10.abrupt(\"return\", this.login());\n\n              case 2:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n    };\n\n    _this.isAuthenticated = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee11() {\n        return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                return _context11.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'isAuthenticated'\n                })));\n\n              case 1:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n    };\n\n    _this.logout = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee12() {\n        var res;\n        return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                _context12.next = 2;\n                return this._postMessageToChild({\n                  method: 'logout'\n                });\n\n              case 2:\n                res = _context12.sent;\n                _context12.next = 5;\n                return this._resetCache();\n\n              case 5:\n                this.emit('logout', {});\n                return _context12.abrupt(\"return\", res);\n\n              case 7:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n    };\n\n    _this.getAuthenticatedAccount = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee13() {\n        return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                return _context13.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'getAuthenticatedAccount'\n                })));\n\n              case 1:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n    };\n\n    _this.getDappKey = function () {\n      return _this._handleError(_this._postMessageToChild({\n        method: 'getLoginKey'\n      }));\n    };\n\n    _this.getLoginKey = function () {\n      console.warn('Deprecation notice: `authereum.getLoginKey()` is deprecated. Use `authereum.getDappKey()` instead.');\n      return _this.getDappKey();\n    };\n\n    _this.signMessage = utils_1.throttle(function (message) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee14() {\n        return _regeneratorRuntime.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                return _context14.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'signMessage',\n                  params: [message, options]\n                })));\n\n              case 1:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n    }, 250);\n    _this.signPersonalMessage = utils_1.throttle(function (message) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee15() {\n        return _regeneratorRuntime.wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                return _context15.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'signMessage',\n                  params: [message, {\n                    personal: true\n                  }]\n                })));\n\n              case 1:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n    }, 250);\n    _this.signWithDappKey = utils_1.throttle(function (message) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee16() {\n        return _regeneratorRuntime.wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                console.warn('Deprecation notice: `authereum.signWithDappKey()` is deprecated. Use `authereum.signMess()` instead.');\n                return _context16.abrupt(\"return\", this.signMessage(message));\n\n              case 2:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this);\n      }));\n    }, 250);\n    _this.signWithLoginKey = utils_1.throttle(function (message) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee17() {\n        return _regeneratorRuntime.wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                console.warn('Deprecation notice: `authereum.signWithLoginKey()` is deprecated. Use `authereum.signWithDappKey()` instead.');\n                return _context17.abrupt(\"return\", this.signWithDappKey(message));\n\n              case 2:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n    }, 250);\n    _this.signTypedMessage = utils_1.throttle(function (message) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee18() {\n        return _regeneratorRuntime.wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                console.warn('Deprecation notice: `authereum.signTypedMessage()` is deprecated. Use `authereum.signMessage()` instead.');\n                return _context18.abrupt(\"return\", this.signMessage(message, options));\n\n              case 2:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18, this);\n      }));\n    }, 250);\n    _this.signTypedMessageWithDappKey = utils_1.throttle(function (message) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee19() {\n        return _regeneratorRuntime.wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                console.warn('Deprecation notice: `authereum.signTypedMessageWithDappKey()` is deprecated. Use `authereum.signMessage()` instead.');\n                return _context19.abrupt(\"return\", this.signTypedMessage(message));\n\n              case 2:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19, this);\n      }));\n    }, 250);\n    _this.signMessageWithAdminKey = utils_1.throttle(function (message) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee20() {\n        return _regeneratorRuntime.wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                console.warn('Deprecation notice: `authereum.signMessageWithAdminKey()` is deprecated. Use `authereum.signMessageWithSigningKey()` instead.');\n                return _context20.abrupt(\"return\", null);\n\n              case 2:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20);\n      }));\n    }, 250);\n    _this.signMessageWithSigningKey = utils_1.throttle(function (message) {\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee21() {\n        return _regeneratorRuntime.wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                return _context21.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'signMessageWithSigningKey',\n                  params: [message, options]\n                })));\n\n              case 1:\n              case \"end\":\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this);\n      }));\n    }, 250);\n\n    _this.getSigningKeyAddress = function (message) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee22() {\n        return _regeneratorRuntime.wrap(function _callee22$(_context22) {\n          while (1) {\n            switch (_context22.prev = _context22.next) {\n              case 0:\n                return _context22.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'getSigningKeyAddress'\n                })));\n\n              case 1:\n              case \"end\":\n                return _context22.stop();\n            }\n          }\n        }, _callee22, this);\n      }));\n    };\n\n    _this.getLoginKeyAuthSignature = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee23() {\n        return _regeneratorRuntime.wrap(function _callee23$(_context23) {\n          while (1) {\n            switch (_context23.prev = _context23.next) {\n              case 0:\n                return _context23.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'getLoginKeyAuthSignature'\n                })));\n\n              case 1:\n              case \"end\":\n                return _context23.stop();\n            }\n          }\n        }, _callee23, this);\n      }));\n    };\n\n    _this.getLoginKeyRestrictionsData = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee24() {\n        return _regeneratorRuntime.wrap(function _callee24$(_context24) {\n          while (1) {\n            switch (_context24.prev = _context24.next) {\n              case 0:\n                return _context24.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'getLoginKeyRestrictionsData'\n                })));\n\n              case 1:\n              case \"end\":\n                return _context24.stop();\n            }\n          }\n        }, _callee24, this);\n      }));\n    };\n\n    _this.getSigningKeyAuthSignature = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee25() {\n        return _regeneratorRuntime.wrap(function _callee25$(_context25) {\n          while (1) {\n            switch (_context25.prev = _context25.next) {\n              case 0:\n                return _context25.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'getSigningKeyAuthSignature'\n                })));\n\n              case 1:\n              case \"end\":\n                return _context25.stop();\n            }\n          }\n        }, _callee25, this);\n      }));\n    };\n\n    _this.getAccountAddress = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee26() {\n        return _regeneratorRuntime.wrap(function _callee26$(_context26) {\n          while (1) {\n            switch (_context26.prev = _context26.next) {\n              case 0:\n                _context26.next = 2;\n                return this._tilReady();\n\n              case 2:\n                return _context26.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'getAccountAddress'\n                })));\n\n              case 3:\n              case \"end\":\n                return _context26.stop();\n            }\n          }\n        }, _callee26, this);\n      }));\n    };\n\n    _this.getBalance = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee27() {\n        return _regeneratorRuntime.wrap(function _callee27$(_context27) {\n          while (1) {\n            switch (_context27.prev = _context27.next) {\n              case 0:\n                return _context27.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'getBalance'\n                })));\n\n              case 1:\n              case \"end\":\n                return _context27.stop();\n            }\n          }\n        }, _callee27, this);\n      }));\n    };\n\n    _this.getRpcUri = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee28() {\n        return _regeneratorRuntime.wrap(function _callee28$(_context28) {\n          while (1) {\n            switch (_context28.prev = _context28.next) {\n              case 0:\n                _context28.next = 2;\n                return this._tilConfigReady();\n\n              case 2:\n                return _context28.abrupt(\"return\", this._rpcUri);\n\n              case 3:\n              case \"end\":\n                return _context28.stop();\n            }\n          }\n        }, _callee28, this);\n      }));\n    };\n\n    _this.getNetworkId = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee29() {\n        return _regeneratorRuntime.wrap(function _callee29$(_context29) {\n          while (1) {\n            switch (_context29.prev = _context29.next) {\n              case 0:\n                return _context29.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'getNetworkId'\n                })));\n\n              case 1:\n              case \"end\":\n                return _context29.stop();\n            }\n          }\n        }, _callee29, this);\n      }));\n    };\n\n    _this.getNetworkName = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee30() {\n        return _regeneratorRuntime.wrap(function _callee30$(_context30) {\n          while (1) {\n            switch (_context30.prev = _context30.next) {\n              case 0:\n                return _context30.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'getNetworkName'\n                })));\n\n              case 1:\n              case \"end\":\n                return _context30.stop();\n            }\n          }\n        }, _callee30, this);\n      }));\n    };\n\n    _this.getCachedNetworkName = function () {\n      return _this._networkName;\n    };\n\n    _this.getProvider = function () {\n      return _this._provider;\n    };\n\n    _this.getStarkProvider = function () {\n      if (!_this._starkProvider) {\n        _this._starkProvider = new StarkWareProvider_1.default(_assertThisInitialized(_this));\n      }\n\n      return _this._starkProvider;\n    };\n\n    _this.getZkSyncProvider = function () {\n      if (!_this._zkSyncProvider) {\n        _this._zkSyncProvider = new ZkSyncProvider_1.default(_assertThisInitialized(_this));\n      }\n\n      return _this._zkSyncProvider;\n    };\n\n    _this._handleError = function (promise) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee31() {\n        var _this4 = this;\n\n        return _regeneratorRuntime.wrap(function _callee31$(_context31) {\n          while (1) {\n            switch (_context31.prev = _context31.next) {\n              case 0:\n                return _context31.abrupt(\"return\", promise.catch(function (err) {\n                  // NOTE: emit errors but don't throw notification here.\n                  _this4.emit('error', err); // NOTE: rethrow error to let dapps handle error\n\n\n                  // NOTE: rethrow error to let dapps handle error\n                  throw err;\n                }));\n\n              case 1:\n              case \"end\":\n                return _context31.stop();\n            }\n          }\n        }, _callee31);\n      }));\n    };\n\n    _this.signTransaction = utils_1.throttle(function (tx) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee32() {\n        return _regeneratorRuntime.wrap(function _callee32$(_context32) {\n          while (1) {\n            switch (_context32.prev = _context32.next) {\n              case 0:\n                _context32.next = 2;\n                return this._tilReady();\n\n              case 2:\n                return _context32.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'signTransaction',\n                  params: serializeMessageObj(tx)\n                })));\n\n              case 3:\n              case \"end\":\n                return _context32.stop();\n            }\n          }\n        }, _callee32, this);\n      }));\n    }, 250);\n    _this.signTransactionWithLoginKey = utils_1.throttle(function (tx) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee33() {\n        return _regeneratorRuntime.wrap(function _callee33$(_context33) {\n          while (1) {\n            switch (_context33.prev = _context33.next) {\n              case 0:\n                console.warn('Deprecation notice: `authereum.signTransactionWithLoginKey()` is deprecated. Use `authereum.signTransaction()` instead.');\n                return _context33.abrupt(\"return\", this.signTransaction(tx));\n\n              case 2:\n              case \"end\":\n                return _context33.stop();\n            }\n          }\n        }, _callee33, this);\n      }));\n    }, 250);\n    _this.sendTransaction = utils_1.throttle(function (userTransaction) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee34() {\n        return _regeneratorRuntime.wrap(function _callee34$(_context34) {\n          while (1) {\n            switch (_context34.prev = _context34.next) {\n              case 0:\n                _context34.next = 2;\n                return this._tilReady();\n\n              case 2:\n                return _context34.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'sendTransaction',\n                  params: serializeMessageObj(userTransaction)\n                })));\n\n              case 3:\n              case \"end\":\n                return _context34.stop();\n            }\n          }\n        }, _callee34, this);\n      }));\n    }, 250);\n    _this.sendTransactionBatch = utils_1.throttle(function (userTransactions) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee35() {\n        return _regeneratorRuntime.wrap(function _callee35$(_context35) {\n          while (1) {\n            switch (_context35.prev = _context35.next) {\n              case 0:\n                _context35.next = 2;\n                return this._tilReady();\n\n              case 2:\n                return _context35.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'sendTransactionBatch',\n                  params: userTransactions.map(serializeMessageObj)\n                })));\n\n              case 3:\n              case \"end\":\n                return _context35.stop();\n            }\n          }\n        }, _callee35, this);\n      }));\n    }, 250);\n\n    _this.estimateGas = function (userTransaction) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee36() {\n        return _regeneratorRuntime.wrap(function _callee36$(_context36) {\n          while (1) {\n            switch (_context36.prev = _context36.next) {\n              case 0:\n                _context36.next = 2;\n                return this._tilReady();\n\n              case 2:\n                return _context36.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'estimateGasBatch',\n                  params: serializeMessageObj(userTransaction)\n                })));\n\n              case 3:\n              case \"end\":\n                return _context36.stop();\n            }\n          }\n        }, _callee36, this);\n      }));\n    };\n\n    _this.estimateGasBatch = function (userTransactions) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee37() {\n        return _regeneratorRuntime.wrap(function _callee37$(_context37) {\n          while (1) {\n            switch (_context37.prev = _context37.next) {\n              case 0:\n                _context37.next = 2;\n                return this._tilReady();\n\n              case 2:\n                return _context37.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'estimateGasBatch',\n                  params: userTransactions.map(serializeMessageObj)\n                })));\n\n              case 3:\n              case \"end\":\n                return _context37.stop();\n            }\n          }\n        }, _callee37, this);\n      }));\n    };\n\n    _this.isReady = function () {\n      return _this._iframeReady && _this._cacheReady;\n    };\n\n    _this.updateConfig = function (config) {\n      _this._userConfig = config;\n\n      _this._setConfig(config);\n    };\n\n    _this.getConfig = function () {\n      return {\n        apiUri: _this._apiUri,\n        rpcUri: _this._rpcUri,\n        webUri: _this._webUri,\n        xsUri: _this._xsUri,\n        networkName: _this._networkName,\n        networkId: _this._networkId,\n        disableNotifications: _this._disableNotifications\n      };\n    };\n\n    _this.showWidget = function () {\n      var enabled = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee38() {\n        return _regeneratorRuntime.wrap(function _callee38$(_context38) {\n          while (1) {\n            switch (_context38.prev = _context38.next) {\n              case 0:\n                if (enabled) {\n                  _context38.next = 3;\n                  break;\n                }\n\n                this._widgetEnabled = false;\n                return _context38.abrupt(\"return\", this._postMessageToChild({\n                  method: 'hideWidget'\n                }));\n\n              case 3:\n                this._widgetEnabled = true;\n                return _context38.abrupt(\"return\", this._postMessageToChild({\n                  method: 'showWidget'\n                }));\n\n              case 5:\n              case \"end\":\n                return _context38.stop();\n            }\n          }\n        }, _callee38, this);\n      }));\n    };\n\n    _this.hideWidget = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee39() {\n        return _regeneratorRuntime.wrap(function _callee39$(_context39) {\n          while (1) {\n            switch (_context39.prev = _context39.next) {\n              case 0:\n                this._widgetEnabled = false;\n                return _context39.abrupt(\"return\", this._postMessageToChild({\n                  method: 'hideWidget'\n                }));\n\n              case 2:\n              case \"end\":\n                return _context39.stop();\n            }\n          }\n        }, _callee39, this);\n      }));\n    };\n\n    _this.widgetEnabled = function () {\n      return _this._widgetEnabled;\n    };\n\n    _this.addFunds = function (opts) {\n      return _this._postMessageToChild({\n        method: 'addFunds',\n        params: opts\n      });\n    };\n\n    _this._openUrl = function () {\n      var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var url = opts.url,\n          newWindow = opts.newWindow;\n\n      if (newWindow) {\n        window.open(url, '_blank');\n      } else {\n        window.location.href = url;\n      }\n    };\n\n    _this._tilIframeReady = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee40() {\n        return _regeneratorRuntime.wrap(function _callee40$(_context40) {\n          while (1) {\n            switch (_context40.prev = _context40.next) {\n              case 0:\n                if (this._iframeReady) {\n                  _context40.next = 4;\n                  break;\n                }\n\n                _context40.next = 3;\n                return utils_1.wait(100);\n\n              case 3:\n                return _context40.abrupt(\"return\", this._tilIframeReady());\n\n              case 4:\n                _context40.next = 6;\n                return utils_1.wait(100);\n\n              case 6:\n                return _context40.abrupt(\"return\", true);\n\n              case 7:\n              case \"end\":\n                return _context40.stop();\n            }\n          }\n        }, _callee40, this);\n      }));\n    };\n\n    _this._tilConfigReady = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee41() {\n        return _regeneratorRuntime.wrap(function _callee41$(_context41) {\n          while (1) {\n            switch (_context41.prev = _context41.next) {\n              case 0:\n                if (this._configReady) {\n                  _context41.next = 4;\n                  break;\n                }\n\n                _context41.next = 3;\n                return utils_1.wait(100);\n\n              case 3:\n                return _context41.abrupt(\"return\", this._tilConfigReady());\n\n              case 4:\n                _context41.next = 6;\n                return utils_1.wait(100);\n\n              case 6:\n                return _context41.abrupt(\"return\", true);\n\n              case 7:\n              case \"end\":\n                return _context41.stop();\n            }\n          }\n        }, _callee41, this);\n      }));\n    };\n\n    _this._tilReady = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee42() {\n        return _regeneratorRuntime.wrap(function _callee42$(_context42) {\n          while (1) {\n            switch (_context42.prev = _context42.next) {\n              case 0:\n                if (this.isReady()) {\n                  _context42.next = 4;\n                  break;\n                }\n\n                _context42.next = 3;\n                return utils_1.wait(100);\n\n              case 3:\n                return _context42.abrupt(\"return\", this._tilReady());\n\n              case 4:\n                _context42.next = 6;\n                return utils_1.wait(100);\n\n              case 6:\n                return _context42.abrupt(\"return\", true);\n\n              case 7:\n              case \"end\":\n                return _context42.stop();\n            }\n          }\n        }, _callee42, this);\n      }));\n    };\n\n    _this._emitReadyEvent = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee43() {\n        return _regeneratorRuntime.wrap(function _callee43$(_context43) {\n          while (1) {\n            switch (_context43.prev = _context43.next) {\n              case 0:\n                _context43.next = 2;\n                return this._tilReady();\n\n              case 2:\n                if (!this._readyEmitted) {\n                  _context43.next = 4;\n                  break;\n                }\n\n                return _context43.abrupt(\"return\");\n\n              case 4:\n                this._readyEmitted = true;\n                this.emit('ready', {});\n\n              case 6:\n              case \"end\":\n                return _context43.stop();\n            }\n          }\n        }, _callee43, this);\n      }));\n    };\n\n    _this._connectToChildIframe = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee44() {\n        var _this5 = this;\n\n        var iframe;\n        return _regeneratorRuntime.wrap(function _callee44$(_context44) {\n          while (1) {\n            switch (_context44.prev = _context44.next) {\n              case 0:\n                if (!this._iframeConnecting) {\n                  _context44.next = 2;\n                  break;\n                }\n\n                return _context44.abrupt(\"return\", this._iframeConnecting);\n\n              case 2:\n                this._iframeReady = false;\n                this._iframeConnecting = true;\n                _context44.next = 6;\n                return this._getOrCreateMainIframe();\n\n              case 6:\n                iframe = _context44.sent;\n                this._iframeConnection = penpal_1.default.connectToChild({\n                  iframe: iframe,\n                  timeout: 60e3,\n                  methods: {\n                    // NOTE: the postMessage penpal method should be the only method that\n                    // exists.\n                    postMessage: function postMessage(data) {\n                      return _this5._handlePostMessage(data);\n                    }\n                  }\n                });\n                this._iframeConnecting = new Promise(function (resolve, reject) {\n                  var timedout = false;\n                  var timer = setTimeout(function () {\n                    if (!_this5._iframeReady) {\n                      timedout = true;\n                      _this5._iframeConnecting = null;\n                      reject(new Error('timedout'));\n                    }\n                  }, 6e3); // needs to be long enough for x-site to be fully loaded\n\n                  _this5._iframeConnection.promise.then(function (child) {\n                    clearTimeout(timer);\n\n                    if (timedout) {\n                      return;\n                    }\n\n                    _this5._iframeReady = true;\n                    _this5._childIframeConnection = child;\n\n                    _this5._startHeartbeat();\n\n                    _this5._iframeConnecting = null;\n                    resolve();\n                  }).catch(function (err) {\n                    clearTimeout(timer);\n\n                    if (timedout) {\n                      return;\n                    }\n\n                    reject(err);\n                  });\n                });\n                return _context44.abrupt(\"return\", this._iframeConnecting);\n\n              case 10:\n              case \"end\":\n                return _context44.stop();\n            }\n          }\n        }, _callee44, this);\n      }));\n    };\n\n    _this._startHeartbeat = function () {\n      var reconnect = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n\n      if (!_this._heartbeatStarted) {\n        _this._heartbeat(reconnect);\n\n        _this._heartbeatStarted = true;\n      }\n    };\n\n    _this._heartbeat = function () {\n      var reconnect = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee45() {\n        return _regeneratorRuntime.wrap(function _callee45$(_context45) {\n          while (1) {\n            switch (_context45.prev = _context45.next) {\n              case 0:\n                if (!this._destroyed) {\n                  _context45.next = 2;\n                  break;\n                }\n\n                return _context45.abrupt(\"return\");\n\n              case 2:\n                _context45.next = 4;\n                return utils_1.wait(2e3);\n\n              case 4:\n                _context45.prev = 4;\n\n                if (!reconnect) {\n                  _context45.next = 10;\n                  break;\n                }\n\n                _context45.next = 8;\n                return this._connectToChildIframe();\n\n              case 8:\n                this._backoffTimeout = 1;\n                return _context45.abrupt(\"return\", this._heartbeat());\n\n              case 10:\n                _context45.next = 12;\n                return this._ping();\n\n              case 12:\n                _context45.next = 21;\n                break;\n\n              case 14:\n                _context45.prev = 14;\n                _context45.t0 = _context45[\"catch\"](4);\n\n                if (!/destroy|timedout/gi.test(_context45.t0.message)) {\n                  _context45.next = 21;\n                  break;\n                }\n\n                _context45.next = 19;\n                return utils_1.wait(this._backoffTimeout * 1e3);\n\n              case 19:\n                // exponential backoff\n                this._backoffTimeout = this._backoffTimeout << 1;\n                return _context45.abrupt(\"return\", this._heartbeat(true));\n\n              case 21:\n                return _context45.abrupt(\"return\", this._heartbeat());\n\n              case 22:\n              case \"end\":\n                return _context45.stop();\n            }\n          }\n        }, _callee45, this, [[4, 14]]);\n      }));\n    };\n\n    _this._ping = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee46() {\n        var _this6 = this;\n\n        return _regeneratorRuntime.wrap(function _callee46$(_context46) {\n          while (1) {\n            switch (_context46.prev = _context46.next) {\n              case 0:\n                if (!this._destroyed) {\n                  _context46.next = 3;\n                  break;\n                }\n\n                console.warn('Authereum instance destroyed. Message not posted to child.');\n                return _context46.abrupt(\"return\");\n\n              case 3:\n                return _context46.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  var timedout = false;\n                  var timer = setTimeout(function () {\n                    timedout = true;\n                  }, 5e3);\n\n                  _this6._postMessageToChild({\n                    method: 'ping'\n                  }).then(function (pong) {\n                    clearTimeout(timer);\n\n                    if (timedout) {\n                      reject(new Error('timedout'));\n                      return;\n                    }\n\n                    if (pong !== 'pong') {\n                      reject(new Error('Invalid response'));\n                      return;\n                    }\n\n                    resolve(pong);\n                  }).catch(function (err) {\n                    reject(err);\n                  });\n                }));\n\n              case 4:\n              case \"end\":\n                return _context46.stop();\n            }\n          }\n        }, _callee46, this);\n      }));\n    };\n\n    _this._constructIframe = function (input) {\n      var iframe = constructIframe(Object.assign(Object.assign({}, input), {\n        isPreload: _this._isPreload,\n        disableGoogleAnalytics: _this._disableGoogleAnalytics\n      }));\n\n      if (_this._debug) {\n        iframe.style.outline = '1px solid red';\n      }\n\n      _this._injectedElements.push(iframe);\n\n      return iframe;\n    };\n\n    _this._getConfigFromChild = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee47() {\n        return _regeneratorRuntime.wrap(function _callee47$(_context47) {\n          while (1) {\n            switch (_context47.prev = _context47.next) {\n              case 0:\n                return _context47.abrupt(\"return\", this._postMessageToChild({\n                  method: 'getConfig'\n                }));\n\n              case 1:\n              case \"end\":\n                return _context47.stop();\n            }\n          }\n        }, _callee47, this);\n      }));\n    };\n\n    _this._postVersionToChild = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee48() {\n        return _regeneratorRuntime.wrap(function _callee48$(_context48) {\n          while (1) {\n            switch (_context48.prev = _context48.next) {\n              case 0:\n                return _context48.abrupt(\"return\", this._postMessageToChild({\n                  method: 'version',\n                  params: this.version()\n                }));\n\n              case 1:\n              case \"end\":\n                return _context48.stop();\n            }\n          }\n        }, _callee48, this);\n      }));\n    };\n\n    _this._postConfigToChild = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee49() {\n        return _regeneratorRuntime.wrap(function _callee49$(_context49) {\n          while (1) {\n            switch (_context49.prev = _context49.next) {\n              case 0:\n                return _context49.abrupt(\"return\", this._postMessageToChild({\n                  method: 'config',\n                  params: {\n                    apiKey: this._apiKey,\n                    disableNotifications: this._disableNotifications\n                  }\n                }));\n\n              case 1:\n              case \"end\":\n                return _context49.stop();\n            }\n          }\n        }, _callee49, this);\n      }));\n    };\n\n    _this._loadAsymmetricEncryptionKeyFromChild = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee50() {\n        return _regeneratorRuntime.wrap(function _callee50$(_context50) {\n          while (1) {\n            switch (_context50.prev = _context50.next) {\n              case 0:\n                _context50.next = 2;\n                return this._postMessageToChild({\n                  method: 'getAsymmetricEncryptionKey'\n                });\n\n              case 2:\n                this._asymmetricEncryptionKey = _context50.sent;\n\n              case 3:\n              case \"end\":\n                return _context50.stop();\n            }\n          }\n        }, _callee50, this);\n      }));\n    };\n\n    _this._postMessageToChild = function (payload) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee51() {\n        return _regeneratorRuntime.wrap(function _callee51$(_context51) {\n          while (1) {\n            switch (_context51.prev = _context51.next) {\n              case 0:\n                _context51.next = 2;\n                return this._tilIframeReady();\n\n              case 2:\n                if (!this._destroyed) {\n                  _context51.next = 4;\n                  break;\n                }\n\n                throw new Error('Authereum instance destroyed.');\n\n              case 4:\n                if (this._bodyContainsIframe()) {\n                  _context51.next = 10;\n                  break;\n                }\n\n                this._destroyed = true;\n\n                this._teardownEventListeners(); // ignore destroy call to already destroyed iframe\n\n\n                if (!(payload.method === 'destroy')) {\n                  _context51.next = 9;\n                  break;\n                }\n\n                return _context51.abrupt(\"return\");\n\n              case 9:\n                throw new Error('Authereum instance or iframe destroyed.');\n\n              case 10:\n                return _context51.abrupt(\"return\", this._handleError(this._childIframeConnection.postMessage(payload)));\n\n              case 11:\n              case \"end\":\n                return _context51.stop();\n            }\n          }\n        }, _callee51, this);\n      }));\n    };\n\n    _this._handleChildLogoutEvent = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee52() {\n        return _regeneratorRuntime.wrap(function _callee52$(_context52) {\n          while (1) {\n            switch (_context52.prev = _context52.next) {\n              case 0:\n                _context52.next = 2;\n                return this._resetCache();\n\n              case 2:\n                this.emit('logout', {});\n\n              case 3:\n              case \"end\":\n                return _context52.stop();\n            }\n          }\n        }, _callee52, this);\n      }));\n    };\n\n    _this._handleChildDappKeyExpired = function (loginKeyAddress) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee53() {\n        return _regeneratorRuntime.wrap(function _callee53$(_context53) {\n          while (1) {\n            switch (_context53.prev = _context53.next) {\n              case 0:\n                if (!(loginKeyAddress === this._cachedLoginKeyAddress)) {\n                  _context53.next = 5;\n                  break;\n                }\n\n                _context53.next = 3;\n                return this._resetCache();\n\n              case 3:\n                this.emit('dappKeyExpired', loginKeyAddress);\n                this.emit('logout');\n\n              case 5:\n              case \"end\":\n                return _context53.stop();\n            }\n          }\n        }, _callee53, this);\n      }));\n    };\n\n    _this._handlePostMessage = function (data) {\n      try {\n        var method = data.method,\n            params = data.params;\n\n        switch (method) {\n          case 'onError':\n            var err = params;\n\n            _this.emit('error', err);\n\n            _this._notifier.notify({\n              type: 'error',\n              message: err.message\n            });\n\n            return;\n\n          case 'onLogout':\n            return _this._handleChildLogoutEvent();\n\n          case 'onDappKeyExpired':\n            return _this._handleChildDappKeyExpired(params);\n\n          case 'login':\n            return _this.login();\n\n          case 'setWidgetPosition':\n            // const position = params\n            // const { x, y } = position\n            // this.iframeStyle.left = x\n            // this.iframeStyle.top = y\n            // this._refreshWidget()\n            return;\n\n          case 'setWidgetSize':\n            {\n              var size = params;\n              var width = size.width,\n                  height = size.height;\n              _this._iframeStyle.width = width;\n              _this._iframeStyle.height = height;\n              return _this._refreshWidget();\n            }\n\n          case 'setWidgetStyle':\n            {\n              var style = params;\n\n              for (var key in style) {\n                _this._iframeStyle[key] = style[key];\n              }\n\n              return _this._refreshWidget();\n            }\n\n          case 'setNotificationWidgetSize':\n            {\n              var _size = params;\n              var _width = _size.width,\n                  _height = _size.height;\n              _this._notificationIframeStyle.width = _width;\n              _this._notificationIframeStyle.height = _height;\n              return _this._refreshNotificationWidget();\n            }\n\n          case 'setNotificationWidgetStyle':\n            {\n              var _style = params;\n\n              for (var _key in _style) {\n                _this._notificationIframeStyle[_key] = _style[_key];\n              }\n\n              return _this._refreshNotificationWidget();\n            }\n\n          case 'getWindowSize':\n            return _this._getWindowSize();\n\n          case 'hideWidget':\n            return _this.hideWidget();\n\n          case 'log':\n            return _this._handlePostMessageLog(params);\n\n          case 'openUrl':\n            return _this._openUrl(params);\n\n          default:\n            break;\n        }\n      } catch (err) {// noop\n      }\n    };\n\n    _this._handlePostMessageLog = function (data) {\n      if (_this._isPreload) {\n        return;\n      }\n\n      var type = data.type,\n          message = data.message;\n\n      if (!type) {\n        type = 'log';\n      }\n\n      console[type](message);\n    };\n\n    _this._getWindowSize = function () {\n      return {\n        width: _this._getWindowWidth(),\n        height: _this._getWindowHeight()\n      };\n    };\n\n    _this._getWindowWidth = function () {\n      return window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\n    };\n\n    _this._getWindowHeight = function () {\n      return window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\n    }; // public _setIframePositionTop = (y: number) => {\n    // if (!this._iframe) return\n    // this._iframe.style.top = `${y}px`\n    // }\n\n\n    _this._setIframePositionLeft = function (x) {\n      if (!_this._iframe) return;\n      _this._iframe.style.left = \"\".concat(x, \"px\");\n    };\n\n    _this._setIframeWidth = function (width) {\n      if (!_this._iframe) return;\n      _this._iframe.style.width = \"\".concat(width, \"px\");\n    };\n\n    _this._setIframeHeight = function (height) {\n      if (!_this._iframe) return;\n      _this._iframe.style.height = \"\".concat(height, \"px\");\n    };\n\n    _this._refreshWidget = function () {\n      var _this$_iframeStyle = _this._iframeStyle,\n          top = _this$_iframeStyle.top,\n          left = _this$_iframeStyle.left,\n          width = _this$_iframeStyle.width,\n          height = _this$_iframeStyle.height,\n          zIndex = _this$_iframeStyle.zIndex;\n      if (_this._isPreload) return;\n      if (!_this._iframe) return; // this._setIframePositionTop(top)\n      // this._setIframePositionLeft(left)\n\n      _this._setIframeWidth(width);\n\n      _this._setIframeHeight(height);\n\n      _this._iframe.style.zIndex = \"\".concat(zIndex || 0);\n    };\n\n    _this._refreshNotificationWidget = function () {\n      var _this$_notificationIf = _this._notificationIframeStyle,\n          top = _this$_notificationIf.top,\n          left = _this$_notificationIf.left,\n          width = _this$_notificationIf.width,\n          height = _this$_notificationIf.height,\n          zIndex = _this$_notificationIf.zIndex;\n      if (_this._isPreload) return;\n      _this._notificationIframe.style.width = \"\".concat(width, \"px\");\n      _this._notificationIframe.style.height = \"\".concat(height, \"px\");\n      _this._notificationIframe.style.zIndex = \"\".concat(zIndex || 0);\n    };\n\n    _this._loginKeyExists = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee54() {\n        return _regeneratorRuntime.wrap(function _callee54$(_context54) {\n          while (1) {\n            switch (_context54.prev = _context54.next) {\n              case 0:\n                _context54.next = 2;\n                return this.getLoginKey();\n\n              case 2:\n                return _context54.abrupt(\"return\", !!_context54.sent);\n\n              case 3:\n              case \"end\":\n                return _context54.stop();\n            }\n          }\n        }, _callee54, this);\n      }));\n    };\n\n    _this._accountAddressExists = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee55() {\n        return _regeneratorRuntime.wrap(function _callee55$(_context55) {\n          while (1) {\n            switch (_context55.prev = _context55.next) {\n              case 0:\n                _context55.next = 2;\n                return this.getAccountAddress();\n\n              case 2:\n                return _context55.abrupt(\"return\", !!_context55.sent);\n\n              case 3:\n              case \"end\":\n                return _context55.stop();\n            }\n          }\n        }, _callee55, this);\n      }));\n    };\n\n    _this._getAccountAdminKeyNonce = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee56() {\n        return _regeneratorRuntime.wrap(function _callee56$(_context56) {\n          while (1) {\n            switch (_context56.prev = _context56.next) {\n              case 0:\n                return _context56.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'getAccountAuthKeyNonce'\n                })));\n\n              case 1:\n              case \"end\":\n                return _context56.stop();\n            }\n          }\n        }, _callee56, this);\n      }));\n    };\n\n    _this._getAccountAuthKeyNonce = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee57() {\n        return _regeneratorRuntime.wrap(function _callee57$(_context57) {\n          while (1) {\n            switch (_context57.prev = _context57.next) {\n              case 0:\n                console.warn('Deprecation notice: `authereum._getAccountAuthKeyNonce()` is deprecated. Use `authereum._getAccountAdminKeyNonce()` instead.');\n                return _context57.abrupt(\"return\", this._getAccountAdminKeyNonce());\n\n              case 2:\n              case \"end\":\n                return _context57.stop();\n            }\n          }\n        }, _callee57, this);\n      }));\n    };\n\n    _this._executeLoginKeyMetaTx = function (tx) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee58() {\n        return _regeneratorRuntime.wrap(function _callee58$(_context58) {\n          while (1) {\n            switch (_context58.prev = _context58.next) {\n              case 0:\n                return _context58.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'executeLoginKeyMetaTx',\n                  params: serializeMessageObj(tx)\n                })));\n\n              case 1:\n              case \"end\":\n                return _context58.stop();\n            }\n          }\n        }, _callee58, this);\n      }));\n    };\n\n    _this._loadLoginKey = function (loginKey) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee59() {\n        return _regeneratorRuntime.wrap(function _callee59$(_context59) {\n          while (1) {\n            switch (_context59.prev = _context59.next) {\n              case 0:\n                _context59.next = 2;\n                return this._tilReady();\n\n              case 2:\n                return _context59.abrupt(\"return\", this._handleError(this._postMessageToChild({\n                  method: 'loadLoginKey',\n                  params: loginKey\n                })));\n\n              case 3:\n              case \"end\":\n                return _context59.stop();\n            }\n          }\n        }, _callee59, this);\n      }));\n    };\n\n    _this._getAuthenticateUri = function (loginKeyAddress) {\n      var encryptionKey = _this._asymmetricEncryptionKey;\n      var date = new Date();\n      date.setDate(date.getDate() + 30); // expire in 30 days\n\n      var expiresAt = date.getTime() / 1e3 | 0; // NOTE: slk = sign login key\n\n      return _this._webUri + '/?slk=' + encodeURIComponent(JSON.stringify({\n        loginKey: {\n          publicAddress: loginKeyAddress,\n          expiresAt: expiresAt\n        },\n        encryptionKey: encryptionKey\n      })) + '&redirect_uri=' + _this._redirectUri;\n    };\n\n    _this._getSignWithAdminKeyUri = function (message) {\n      if (is_buffer_1.default(message)) {\n        message = \"0x\".concat(message.toString('hex'));\n      } // NOTE: sm = sign message\n\n\n      return _this._webUri + '/?sm=' + encodeURIComponent(JSON.stringify({\n        message: message\n      })) + '&redirect_uri=' + _this._redirectUri;\n    };\n\n    _this._openPopupOrRedirect = function (url) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee62() {\n        var _this7 = this;\n\n        var child, isBlocked, err, shouldShowPopupOrRedirect, errMessage;\n        return _regeneratorRuntime.wrap(function _callee62$(_context62) {\n          while (1) {\n            switch (_context62.prev = _context62.next) {\n              case 0:\n                this.emit('openPopup', {});\n\n                if (!this._forceRedirect) {\n                  _context62.next = 4;\n                  break;\n                }\n\n                window.location.href = url;\n                return _context62.abrupt(\"return\");\n\n              case 4:\n                child = this._getAuthereumPopupWindow(url);\n                isBlocked = this._isAuthereumPopupBlocked(child);\n\n                if (!(isBlocked && !this._blockedPopupRedirect)) {\n                  _context62.next = 12;\n                  break;\n                }\n\n                err = new Error('Disable popup blocker and try again');\n\n                this._notifier.notify({\n                  type: 'error',\n                  message: err.message,\n                  timeout: 5000\n                });\n\n                throw err;\n\n              case 12:\n                if (!isBlocked) {\n                  _context62.next = 26;\n                  break;\n                }\n\n                this.emit('popupBlocked');\n                _context62.next = 16;\n                return this._showConfirmPopupOrRedirectModal();\n\n              case 16:\n                shouldShowPopupOrRedirect = _context62.sent;\n\n                if (shouldShowPopupOrRedirect) {\n                  _context62.next = 21;\n                  break;\n                }\n\n                errMessage = 'Popup or redirect rejected';\n                this.emit('error', errMessage);\n                throw new Error(errMessage);\n\n              case 21:\n                // Try to bring up a user-initiated popup. If this fails\n                // fallback to a redirect\n                child = this._getAuthereumPopupWindow(url);\n                isBlocked = this._isAuthereumPopupBlocked(child);\n\n                if (!isBlocked) {\n                  _context62.next = 26;\n                  break;\n                }\n\n                window.location.href = url;\n                return _context62.abrupt(\"return\");\n\n              case 26:\n                child.focus();\n                return _context62.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  var interval = setInterval(function () {\n                    return __awaiter(_this7, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee60() {\n                      var _err;\n\n                      return _regeneratorRuntime.wrap(function _callee60$(_context60) {\n                        while (1) {\n                          switch (_context60.prev = _context60.next) {\n                            case 0:\n                              if (child.closed) {\n                                cleanUp();\n                                _err = new Error('Window closed');\n                                this.emit('error', _err);\n                                this.emit('closePopup', {});\n                                reject(_err);\n                              }\n\n                            case 1:\n                            case \"end\":\n                              return _context60.stop();\n                          }\n                        }\n                      }, _callee60, this);\n                    }));\n                  }, 250);\n                  var timeout = setTimeout(function () {\n                    cleanUp();\n                    child.close();\n                    doneWithError(new Error('Timedout'));\n                  }, 10 * 60 * 1000);\n\n                  var cleanUp = function cleanUp() {\n                    clearInterval(interval);\n                    clearTimeout(timeout);\n\n                    _this7.emit('closePopup', {});\n                  };\n\n                  var doneWithError = function doneWithError(err) {\n                    cleanUp();\n\n                    _this7.emit('error', err);\n\n                    reject(err);\n                  };\n\n                  var done = function done() {\n                    var result = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n                    cleanUp();\n                    resolve(result);\n                  };\n\n                  var handleParentMessageEvent = function handleParentMessageEvent(event) {\n                    return __awaiter(_this7, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee61() {\n                      return _regeneratorRuntime.wrap(function _callee61$(_context61) {\n                        while (1) {\n                          switch (_context61.prev = _context61.next) {\n                            case 0:\n                              if (!event.origin.includes(this._webUri)) {\n                                _context61.next = 13;\n                                break;\n                              }\n\n                              // this event tells parent to close child popup\n                              if (event.data.close) {\n                                child.close();\n                                done();\n                              }\n\n                              if (!event.data.login) {\n                                _context61.next = 11;\n                                break;\n                              }\n\n                              done({\n                                success: true\n                              });\n                              this.emit('login', {});\n                              this._cachedIsAuthenticated = true;\n\n                              if (!event.data.encryptedSigningKey) {\n                                _context61.next = 9;\n                                break;\n                              }\n\n                              _context61.next = 9;\n                              return this._loadSigningKey(event.data.encryptedSigningKey);\n\n                            case 9:\n                              this._logAnalyticsEvent({\n                                eventType: 'logged_in_dapp',\n                                properties: {\n                                  dapp_url: window.location.href\n                                }\n                              });\n\n                              if (this._redirectUri !== window.location.href) {\n                                window.location.href = this._redirectUri;\n                              }\n\n                            case 11:\n                              if (event.data.result) {\n                                done(event.data.result);\n\n                                if (this._redirectUri !== window.location.href) {\n                                  window.location.href = this._redirectUri;\n                                }\n                              }\n\n                              if (event.data.error) {\n                                doneWithError(new Error(event.data.error));\n\n                                if (this._redirectUri !== window.location.href) {\n                                  window.location.href = this._redirectUri;\n                                }\n                              }\n\n                            case 13:\n                            case \"end\":\n                              return _context61.stop();\n                          }\n                        }\n                      }, _callee61, this);\n                    }));\n                  };\n\n                  _this7.addEventListener('message', handleParentMessageEvent, false);\n                }));\n\n              case 28:\n              case \"end\":\n                return _context62.stop();\n            }\n          }\n        }, _callee62, this);\n      }));\n    };\n\n    _this.addEventListener = function (type, listener) {\n      var useCapture = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      window.addEventListener(type, listener, useCapture);\n\n      _this._eventListeners.push({\n        type: type,\n        listener: listener,\n        useCapture: useCapture\n      });\n    };\n\n    _this._showConfirmPopupOrRedirectModal = function () {\n      return _this._handleError(_this._postMessageToChild({\n        method: 'showConfirmPopupOrRedirectModal'\n      }));\n    };\n\n    _this._signLoginKeyRequest = function (publicAddress) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee63() {\n        var url;\n        return _regeneratorRuntime.wrap(function _callee63$(_context63) {\n          while (1) {\n            switch (_context63.prev = _context63.next) {\n              case 0:\n                url = this._getAuthenticateUri(publicAddress);\n                return _context63.abrupt(\"return\", this._openPopupOrRedirect(url));\n\n              case 2:\n              case \"end\":\n                return _context63.stop();\n            }\n          }\n        }, _callee63, this);\n      }));\n    };\n\n    _this._tilDomReady = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee64() {\n        return _regeneratorRuntime.wrap(function _callee64$(_context64) {\n          while (1) {\n            switch (_context64.prev = _context64.next) {\n              case 0:\n                return _context64.abrupt(\"return\", onDomReady());\n\n              case 1:\n              case \"end\":\n                return _context64.stop();\n            }\n          }\n        }, _callee64);\n      }));\n    }; // keep both static and normal version methods\n\n\n    _this.version = function () {\n      return version_1.default;\n    };\n\n    _this.isAuthenticatedSync = function () {\n      return _this._cachedIsAuthenticated;\n    };\n\n    _this.getTransactionReceipt = function (txHash) {\n      return _this._handleError(_this._postMessageToChild({\n        method: 'getTransactionReceipt',\n        params: txHash\n      }));\n    };\n\n    _this.waitForTransactionReceipt = function (txHash) {\n      return _this._handleError(_this._postMessageToChild({\n        method: 'waitForTransactionReceipt',\n        params: txHash\n      }));\n    };\n\n    _this.hasRecoveryEnabled = function () {\n      return _this._handleError(_this._postMessageToChild({\n        method: 'hasRecoveryEnabled'\n      }));\n    };\n\n    _this.getEncryptionPublicKey = function () {\n      return _this._handleError(_this._postMessageToChild({\n        method: 'getEncryptionPublicKey'\n      }));\n    };\n\n    _this.encryptMessage = function (message) {\n      return _this._handleError(_this._postMessageToChild({\n        method: 'encryptMessage',\n        params: message\n      }));\n    };\n\n    _this.decryptMessage = function (encryptedMessage) {\n      return _this._handleError(_this._postMessageToChild({\n        method: 'decryptMessage',\n        params: encryptedMessage\n      }));\n    };\n\n    _this.isContractDeployed = function (accountAddress) {\n      return _this._handleError(_this._postMessageToChild({\n        method: 'isContractDeployed',\n        params: accountAddress\n      }));\n    };\n\n    _this._loadSigningKey = function (signingKey) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee65() {\n        return _regeneratorRuntime.wrap(function _callee65$(_context65) {\n          while (1) {\n            switch (_context65.prev = _context65.next) {\n              case 0:\n                if (!this._destroyed) {\n                  _context65.next = 3;\n                  break;\n                }\n\n                console.warn('Authereum instance destroyed. Message not posted to child.');\n                return _context65.abrupt(\"return\");\n\n              case 3:\n                return _context65.abrupt(\"return\", this._postMessageToChild({\n                  method: 'loadSigningKey',\n                  params: signingKey\n                }));\n\n              case 4:\n              case \"end\":\n                return _context65.stop();\n            }\n          }\n        }, _callee65, this);\n      }));\n    };\n\n    _this._logAnalyticsEvent = function (input) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee66() {\n        return _regeneratorRuntime.wrap(function _callee66$(_context66) {\n          while (1) {\n            switch (_context66.prev = _context66.next) {\n              case 0:\n                if (!this._destroyed) {\n                  _context66.next = 3;\n                  break;\n                }\n\n                console.warn('Authereum instance destroyed. Message not posted to child.');\n                return _context66.abrupt(\"return\");\n\n              case 3:\n                return _context66.abrupt(\"return\", this._postMessageToChild({\n                  method: 'logAnalyticsEvent',\n                  params: input\n                }));\n\n              case 4:\n              case \"end\":\n                return _context66.stop();\n            }\n          }\n        }, _callee66, this);\n      }));\n    };\n\n    _this._setupSigningKey = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee67() {\n        var encryptedSigningKey, success;\n        return _regeneratorRuntime.wrap(function _callee67$(_context67) {\n          while (1) {\n            switch (_context67.prev = _context67.next) {\n              case 0:\n                _context67.next = 2;\n                return this._tilReady();\n\n              case 2:\n                encryptedSigningKey = this._authereumQueryParams['encryptedSigningKey'];\n\n                if (!encryptedSigningKey) {\n                  _context67.next = 8;\n                  break;\n                }\n\n                _context67.next = 6;\n                return this._loadSigningKey(encryptedSigningKey);\n\n              case 6:\n                success = _context67.sent;\n\n                if (success) {\n                  try {\n                    localStorage.removeItem('_authereum');\n                  } catch (err) {// noop\n                  }\n                }\n\n              case 8:\n              case \"end\":\n                return _context67.stop();\n            }\n          }\n        }, _callee67, this);\n      }));\n    };\n\n    _this._cacheAuthereumQueryParams = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee68() {\n        var param, newUrl, cached;\n        return _regeneratorRuntime.wrap(function _callee68$(_context68) {\n          while (1) {\n            switch (_context68.prev = _context68.next) {\n              case 0:\n                try {\n                  param = utils_1.getQueryParamValue('_authereum');\n\n                  if (param) {\n                    this._authereumQueryParams = JSON.parse(param);\n\n                    try {\n                      localStorage.setItem('_authereum', btoa(JSON.stringify(this._authereumQueryParams)));\n                    } catch (err) {// noop\n                    }\n\n                    newUrl = utils_1.removeQueryParam('_authereum');\n                    utils_1.replaceWindowUrl(newUrl);\n                  } else {\n                    try {\n                      // load from local storage cache if exists.\n                      // this local storage is cleared after connection.\n                      cached = localStorage.getItem('_authereum');\n\n                      if (cached) {\n                        this._authereumQueryParams = JSON.parse(atob(cached));\n                      }\n                    } catch (err) {// noop\n                    }\n                  }\n                } catch (err) {// noop\n                }\n\n              case 1:\n              case \"end\":\n                return _context68.stop();\n            }\n          }\n        }, _callee68, this);\n      }));\n    };\n\n    _this.destroy = function () {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee69() {\n        var i, element;\n        return _regeneratorRuntime.wrap(function _callee69$(_context69) {\n          while (1) {\n            switch (_context69.prev = _context69.next) {\n              case 0:\n                if (!this._destroyed) {\n                  _context69.next = 3;\n                  break;\n                }\n\n                console.warn('Authereum instance already destroyed.');\n                return _context69.abrupt(\"return\", true);\n\n              case 3:\n                _context69.prev = 3;\n\n                if (!(this._iframeReady && this._bodyContainsIframe())) {\n                  _context69.next = 7;\n                  break;\n                }\n\n                _context69.next = 7;\n                return this._postMessageToChild({\n                  method: 'destroy'\n                });\n\n              case 7:\n                _context69.next = 12;\n                break;\n\n              case 9:\n                _context69.prev = 9;\n                _context69.t0 = _context69[\"catch\"](3);\n                console.warn(_context69.t0);\n\n              case 12:\n                for (i = 0; i < this._injectedElements.length; i++) {\n                  element = this._injectedElements[i];\n\n                  try {\n                    element.remove();\n                  } catch (err) {\n                    console.error(err);\n                  }\n                }\n                /*\n                const elements = document.querySelectorAll('[id*=\"authereum\"]')\n                for (let i = 0; i < elements.length; i++) {\n                  const element = elements[i]\n                  try {\n                    element.remove()\n                  } catch (err) {\n                    console.error(err)\n                  }\n                }\n                */\n\n\n                this._iframeReady = false;\n                this._destroyed = true;\n                console.warn('Authereum instance destroyed.');\n\n                this._teardownEventListeners();\n\n                this.emit('destroy', {});\n                return _context69.abrupt(\"return\", true);\n\n              case 19:\n              case \"end\":\n                return _context69.stop();\n            }\n          }\n        }, _callee69, this, [[3, 9]]);\n      }));\n    };\n\n    _this.isDestroyed = function () {\n      return _this._destroyed;\n    };\n\n    _this.getAddressQrCodeDataUri = function (address) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee70() {\n        return _regeneratorRuntime.wrap(function _callee70$(_context70) {\n          while (1) {\n            switch (_context70.prev = _context70.next) {\n              case 0:\n                return _context70.abrupt(\"return\", this._postMessageToChild({\n                  method: 'getAddressQrCodeDataUri',\n                  params: {\n                    address: address\n                  }\n                }));\n\n              case 1:\n              case \"end\":\n                return _context70.stop();\n            }\n          }\n        }, _callee70, this);\n      }));\n    };\n\n    _this._loadNotificationsIframe = function (url) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee71() {\n        var id, el;\n        return _regeneratorRuntime.wrap(function _callee71$(_context71) {\n          while (1) {\n            switch (_context71.prev = _context71.next) {\n              case 0:\n                id = 'authereum__x-notification-iframe';\n                el = document.getElementById(id);\n\n                if (!(el && el.src === url)) {\n                  _context71.next = 6;\n                  break;\n                }\n\n                this._notificationIframe = el;\n                _context71.next = 15;\n                break;\n\n              case 6:\n                if (el) {\n                  el.remove();\n                }\n\n                this._notificationIframe = this._constructIframe({\n                  id: id,\n                  url: url\n                });\n                this._notificationIframe.style.top = '0';\n                this._notificationIframe.style.right = '0';\n                _context71.next = 12;\n                return this._tilDomReady();\n\n              case 12:\n                el = document.getElementById(id);\n\n                if (el) {\n                  el.remove();\n                }\n\n                document.body.appendChild(this._notificationIframe);\n\n              case 15:\n              case \"end\":\n                return _context71.stop();\n            }\n          }\n        }, _callee71, this);\n      }));\n    };\n\n    _this._setDebug = function (enabled) {\n      return __awaiter(_assertThisInitialized(_this), void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee72() {\n        return _regeneratorRuntime.wrap(function _callee72$(_context72) {\n          while (1) {\n            switch (_context72.prev = _context72.next) {\n              case 0:\n                this._debug = enabled;\n\n                if (this._debug) {\n                  this._iframe.style.outline = '1px solid red';\n                  this._notificationIframe.style.outline = '1px solid red';\n                } else {\n                  this._iframe.style.outline = '0';\n                  this._notificationIframe.style.outline = '0';\n                }\n\n              case 2:\n              case \"end\":\n                return _context72.stop();\n            }\n          }\n        }, _callee72, this);\n      }));\n    };\n\n    _this._userConfig = config;\n\n    if (config instanceof Object) {\n      _this._isPreload = !!config.isPreload;\n      _this._disableGoogleAnalytics = !!config.disableGoogleAnalytics;\n    }\n\n    var merged = _this._checkCachedInstance(config);\n\n    if (merged) {\n      return _possibleConstructorReturn(_this, merged);\n    }\n\n    _this._init(config);\n\n    if (window._authereumInstances) {\n      window._authereumInstances.push(_assertThisInitialized(_this));\n    }\n\n    return _this;\n  }\n\n  _createClass(Authereum, [{\n    key: \"_checkCachedInstance\",\n    value: function _checkCachedInstance(config) {\n      var cachedInstance = null;\n\n      if (Array.isArray(window._authereumInstances)) {\n        if (window._authereumInstances.length) {\n          cachedInstance = window._authereumInstances.pop();\n        }\n      } // checks if preloaded cached iframe matches the same network as user created\n      // instance, and if so then merge the state to use preloaded iframe.\n\n\n      if (cachedInstance) {\n        if (cachedInstance.isReady()) {\n          if (typeof config === 'string') {\n            if (cachedInstance.getCachedNetworkName() === config) {\n              return this._merge(cachedInstance);\n            } else {\n              cachedInstance.destroy();\n              cachedInstance = null;\n            }\n          } else if (config instanceof Object) {\n            if (cachedInstance.getCachedNetworkName() === config.networkName && !config.xsUri) {\n              return this._merge(cachedInstance);\n            } else {\n              cachedInstance.destroy();\n              cachedInstance = null;\n            }\n          }\n        } else {\n          cachedInstance.destroy();\n          cachedInstance = null;\n        }\n      }\n    } // this merges an authereum instance with this one\n    // by copying all properties and connected iframes.\n\n  }, {\n    key: \"_merge\",\n    value: function _merge(instance) {\n      var _this8 = this;\n\n      this._debug = instance._debug;\n      this._apiKey = instance._apiKey;\n      this._apiUri = instance._apiUri;\n      this._rpcUri = instance._rpcUri;\n      this._webUri = instance._webUri;\n      this._xsUri = instance._xsUri;\n      this._notifierUri = instance._notifierUri;\n      this._networkName = instance._networkName;\n      this._networkId = instance._networkId;\n      this._redirectUri = instance._redirectUri;\n      this._iframeConnection = instance._iframeConnection;\n      this._childIframeConnection = instance._childIframeConnection;\n      this._iframe = instance._iframe;\n      this._notificationIframe = instance._notificationIframe;\n      this._cacheReady = instance._cacheReady;\n      this._cachedLoginKeyAddress = instance._cachedLoginKeyAddress;\n      this._cachedAccountAddress = instance._cachedAccountAddress;\n      this._cachedIsAuthenticated = instance._cachedIsAuthenticated;\n      this._iframeReady = instance._iframeReady;\n      this._configReady = instance._configReady;\n      this._iframeStyle = instance._iframeStyle;\n      this._notificationIframeStyle = instance._notificationIframeStyle;\n      this._heartbeatStarted = instance._heartbeatStarted;\n      this._backoffTimeout = instance._backoffTimeout;\n      this._asymmetricEncryptionKey = instance._asymmetricEncryptionKey;\n      this._authereumQueryParams = instance._authereumQueryParams;\n      this._injectedElements = instance._injectedElements;\n      this._notificationsMap = instance._notificationsMap;\n      instance._handlePostMessage = this._handlePostMessage.bind(instance);\n\n      this._initConfig(this._userConfig);\n\n      this._cacheLoginKeyAddress();\n\n      this._getConfigFromChild().then(function (config) {\n        _this8._setConfig(config);\n\n        _this8._postConfigToChild().catch(noop);\n\n        _this8.emit('iframeReady', {});\n      }).catch(noop);\n\n      this._emitReadyEvent();\n\n      this._provider = new AuthereumProvider_1.default(this);\n\n      this._refreshWidget();\n\n      return this;\n    }\n  }, {\n    key: \"_setupFocusListener\",\n    value: function _setupFocusListener() {\n      this.addEventListener('focus', this._handleWindowFocus, false);\n    }\n  }, {\n    key: \"_setupActionKeyListener\",\n    value: function _setupActionKeyListener() {\n      this.addEventListener('keydown', this._handleActionKeyPress, false);\n    }\n  }, {\n    key: \"_teardownEventListeners\",\n    value: function _teardownEventListeners() {\n      for (var i = 0; i < this._eventListeners.length; i++) {\n        var _this$_eventListeners = this._eventListeners[i],\n            type = _this$_eventListeners.type,\n            listener = _this$_eventListeners.listener,\n            useCapture = _this$_eventListeners.useCapture;\n        window.removeEventListener(type, listener, useCapture);\n      }\n    }\n  }, {\n    key: \"_getOrCreateMainIframe\",\n    value: function _getOrCreateMainIframe() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee74() {\n        var _this9 = this;\n\n        return _regeneratorRuntime.wrap(function _callee74$(_context74) {\n          while (1) {\n            switch (_context74.prev = _context74.next) {\n              case 0:\n                if (this._iframe) {\n                  if (this._iframeConnection) {\n                    this._iframeConnection.destroy();\n                  }\n\n                  this._iframe.remove();\n                }\n\n                return _context74.abrupt(\"return\", new Promise(function (resolve) {\n                  return __awaiter(_this9, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee73() {\n                    var _this10 = this;\n\n                    var id, el, notificationIframeUrl;\n                    return _regeneratorRuntime.wrap(function _callee73$(_context73) {\n                      while (1) {\n                        switch (_context73.prev = _context73.next) {\n                          case 0:\n                            id = 'authereum__x-iframe';\n                            el = document.getElementById(id);\n\n                            if (!(el && el.src === this._xsUri)) {\n                              _context73.next = 6;\n                              break;\n                            }\n\n                            this._iframe = el;\n                            _context73.next = 16;\n                            break;\n\n                          case 6:\n                            this._iframe = this._constructIframe({\n                              id: id,\n                              url: this._xsUri\n                            });\n                            notificationIframeUrl = \"\".concat(this._xsUri.replace(/\\/$/, ''), \"/notifications\");\n\n                            this._loadNotificationsIframe(notificationIframeUrl).catch(noop);\n\n                            resolve(this._iframe);\n                            _context73.next = 12;\n                            return this._tilDomReady();\n\n                          case 12:\n                            el = document.getElementById(id);\n\n                            if (el) {\n                              el.remove();\n                            }\n\n                            document.body.appendChild(this._iframe);\n\n                            this._iframe.onload = function () {\n                              _this10._postVersionToChild().catch(noop);\n\n                              _this10._loadAsymmetricEncryptionKeyFromChild().catch(noop);\n\n                              _this10._getConfigFromChild().then(function (config) {\n                                if (notificationIframeUrl !== config.notifierIframeUri) {\n                                  _this10._loadNotificationsIframe(config.notifierIframeUri);\n                                }\n\n                                _this10._setConfig(config);\n\n                                _this10._postConfigToChild().catch(noop);\n\n                                _this10._configReady = true;\n\n                                _this10.emit('iframeReady', {});\n                              }).catch(noop);\n                            };\n\n                          case 16:\n                          case \"end\":\n                            return _context73.stop();\n                        }\n                      }\n                    }, _callee73, this);\n                  }));\n                }));\n\n              case 2:\n              case \"end\":\n                return _context74.stop();\n            }\n          }\n        }, _callee74, this);\n      }));\n    }\n  }, {\n    key: \"_bodyContainsIframe\",\n    value: function _bodyContainsIframe() {\n      return document.body.contains(this._iframe);\n    }\n  }, {\n    key: \"_getAuthereumPopupWindow\",\n    value: function _getAuthereumPopupWindow(url) {\n      return window.open(url, 'Authereum', \"toolbar=no,\\n      location=no,\\n      status=no,\\n      menubar=no,\\n      scrollbars=no,\\n      resizable=no,\\n      width=470,\\n      height=640\");\n    }\n  }, {\n    key: \"_isAuthereumPopupBlocked\",\n    value: function _isAuthereumPopupBlocked(child) {\n      return child === null || child === undefined;\n    }\n  }, {\n    key: \"isPreload\",\n    value: function isPreload() {\n      return this._isPreload;\n    }\n  }]);\n\n  return Authereum;\n}(eventemitter3_1.default);\n\nexports.default = Authereum; // keep both static and normal version methods\n\nAuthereum.version = function () {\n  return version_1.default;\n};\n\nif (typeof window !== 'undefined') {\n  window.Authereum = Authereum;\n  window._authereumInstances = []; // disable preloading if param set for debugging\n  // if (!getQueryParamValue('debug_disable_preload')) {\n\n  if (utils_1.getQueryParamValue('authereum_debug')) {\n    // preload instance in order to avoid async calls between\n    // user action and login call.\n    var cachedNetwork = 'mainnet';\n    var networks = ['kovan', 'goerli', 'rinkeby', 'ropsten'];\n\n    for (var i = 0; i < networks.length; i++) {\n      // assuming which network to preload\n      if (window.location.href.includes(networks[i])) {\n        cachedNetwork = networks[i];\n        break;\n      }\n    }\n\n    var cachedInstance = new Authereum({\n      networkName: cachedNetwork,\n      isPreload: true\n    });\n\n    window._authereumInstances.push(cachedInstance);\n  }\n}","map":{"version":3,"sources":["/Users/sam/Desktop/kiwik/node_modules/authereum/dist/AuthereumSDK.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__importDefault","mod","__esModule","Object","defineProperty","exports","penpal_1","require","eventemitter3_1","is_buffer_1","version_1","AuthereumProvider_1","StarkWareProvider_1","ZkSyncProvider_1","config_1","utils_1","serializeMessageObj","obj","tx","k","v","toString","defaultIframeStyle","width","height","top","left","zIndex","noop","defaultNotifier","notify","type","message","console","debug","dismiss","constructIframe","input","id","url","isPreload","disableGoogleAnalytics","parentUrl","window","location","href","parent","document","URL","err","srcUrl","updateQueryParams","iframe","createElement","name","replace","title","src","includes","browserInfo","browser","setAttribute","style","position","bottom","right","border","background","onDomReady","readyState","addEventListener","Authereum","config","_debug","getQueryParamValue","_notifier","_cacheReady","_iframeReady","_configReady","_iframeConnecting","_readyEmitted","_widgetEnabled","_iframeStyle","_notificationIframeStyle","_blockedPopupRedirect","_forceRedirect","_heartbeatStarted","_backoffTimeout","_userConfig","_asymmetricEncryptionKey","_authereumQueryParams","_injectedElements","_notificationsMap","_destroyed","_starkProvider","_zkSyncProvider","_isPreload","_disableGoogleAnalytics","_eventListeners","_init","_initConfig","_provider","default","_connectToChildIframe","catch","_startHeartbeat","warn","_setupCache","_cacheAuthereumQueryParams","_setupSigningKey","_setupResizeListener","_setupFocusListener","_setupActionKeyListener","_emitReadyEvent","network","_networkName","trim","toLowerCase","_xsUri","defaultConfig","xsUri","Error","networkName","_apiKey","apiKey","redirectUri","_redirectUri","_setConfig","apiUri","rpcUri","webUri","notifierUri","networkId","disableNotifications","blockedPopupRedirect","forceRedirect","_apiUri","_rpcUri","_webUri","_notifierUri","_networkId","_disableNotifications","all","_cacheLoginKeyAddress","_cacheIsAuthenticated","_cacheAccountAddress","_handleWindowFocus","_bodyContainsIframe","_postMessageToChild","method","_resetCache","_injectScript","sourceUrl","_tilDomReady","getElementById","script","async","onload","onerror","push","getElementsByTagName","appendChild","_handleResizeThrottled","_handleResizeDebounced","_handleActionKeyPress","event","keyName","key","keyCode","params","_handleResize","_getWindowSize","size","throttle","debounce","loginKey","_cachedLoginKeyAddress","publicAddress","accountAddress","_cachedAccountAddress","isAuthenticated","_cachedIsAuthenticated","login","isIframeReady","isConfigReady","_tilConfigReady","_tilReady","_signLoginKeyRequest","getAuthenticatedAccount","timeout","setTimeout","account","authenticate","_handleError","logout","res","emit","getDappKey","getLoginKey","signMessage","options","signPersonalMessage","personal","signWithDappKey","signWithLoginKey","signTypedMessage","signTypedMessageWithDappKey","signMessageWithAdminKey","signMessageWithSigningKey","getSigningKeyAddress","getLoginKeyAuthSignature","getLoginKeyRestrictionsData","getSigningKeyAuthSignature","getAccountAddress","getBalance","getRpcUri","getNetworkId","getNetworkName","getCachedNetworkName","getProvider","getStarkProvider","getZkSyncProvider","promise","signTransaction","signTransactionWithLoginKey","sendTransaction","userTransaction","sendTransactionBatch","userTransactions","map","estimateGas","estimateGasBatch","isReady","updateConfig","getConfig","showWidget","enabled","hideWidget","widgetEnabled","addFunds","opts","_openUrl","newWindow","open","_tilIframeReady","wait","_getOrCreateMainIframe","_iframeConnection","connectToChild","methods","postMessage","data","_handlePostMessage","timedout","timer","child","clearTimeout","_childIframeConnection","reconnect","_heartbeat","_ping","test","pong","_constructIframe","assign","outline","_getConfigFromChild","_postVersionToChild","version","_postConfigToChild","_loadAsymmetricEncryptionKeyFromChild","payload","_teardownEventListeners","_handleChildLogoutEvent","_handleChildDappKeyExpired","loginKeyAddress","_refreshWidget","_refreshNotificationWidget","_handlePostMessageLog","_getWindowWidth","_getWindowHeight","innerWidth","documentElement","clientWidth","body","innerHeight","clientHeight","_setIframePositionLeft","x","_iframe","_setIframeWidth","_setIframeHeight","_notificationIframe","_loginKeyExists","_accountAddressExists","_getAccountAdminKeyNonce","_getAccountAuthKeyNonce","_executeLoginKeyMetaTx","_loadLoginKey","_getAuthenticateUri","encryptionKey","date","Date","setDate","getDate","expiresAt","getTime","encodeURIComponent","JSON","stringify","_getSignWithAdminKeyUri","_openPopupOrRedirect","_getAuthereumPopupWindow","isBlocked","_isAuthereumPopupBlocked","_showConfirmPopupOrRedirectModal","shouldShowPopupOrRedirect","errMessage","focus","interval","setInterval","closed","cleanUp","close","doneWithError","clearInterval","handleParentMessageEvent","origin","success","encryptedSigningKey","_loadSigningKey","_logAnalyticsEvent","eventType","properties","dapp_url","error","listener","useCapture","isAuthenticatedSync","getTransactionReceipt","txHash","waitForTransactionReceipt","hasRecoveryEnabled","getEncryptionPublicKey","encryptMessage","decryptMessage","encryptedMessage","isContractDeployed","signingKey","localStorage","removeItem","param","parse","setItem","btoa","newUrl","removeQueryParam","replaceWindowUrl","cached","getItem","atob","destroy","i","length","element","remove","isDestroyed","getAddressQrCodeDataUri","address","_loadNotificationsIframe","el","_setDebug","merged","_checkCachedInstance","_authereumInstances","cachedInstance","Array","isArray","pop","_merge","instance","bind","removeEventListener","notificationIframeUrl","notifierIframeUri","contains","undefined","cachedNetwork","networks"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst penpal_1 = __importDefault(require(\"penpal\"));\nconst eventemitter3_1 = __importDefault(require(\"eventemitter3\"));\nconst is_buffer_1 = __importDefault(require(\"is-buffer\"));\nconst version_1 = __importDefault(require(\"./version\"));\nconst AuthereumProvider_1 = __importDefault(require(\"./AuthereumProvider\"));\nconst StarkWareProvider_1 = __importDefault(require(\"./StarkWareProvider\"));\nconst ZkSyncProvider_1 = __importDefault(require(\"./ZkSyncProvider\"));\nconst config_1 = require(\"./config\");\nconst utils_1 = require(\"./utils\");\n// Serialize object for postMessage to iframe.\n// Converts references to values.\nconst serializeMessageObj = (obj) => {\n    const tx = {};\n    for (let k in obj) {\n        let v = obj[k];\n        if (typeof v === 'object' && v.toString === 'function') {\n            v = v.toString('hex');\n        }\n        tx[k] = v;\n    }\n    return tx;\n};\nconst defaultIframeStyle = {\n    width: 0,\n    height: 0,\n    top: 0,\n    left: 0,\n    zIndex: 1\n};\nconst noop = () => {\n    // noop\n};\n// This is a placeholder notify object stub until notifier script url is\n// injected into page after iframe is loaded.\nconst defaultNotifier = {\n    notify: (type, message) => {\n        console.debug(type, message);\n        return {\n            dismiss: noop\n        };\n    }\n};\nconst constructIframe = (input) => {\n    const { id, url, isPreload, disableGoogleAnalytics } = input;\n    let parentUrl = window.location.href;\n    try {\n        parentUrl = parent.document.URL;\n    }\n    catch (err) {\n        // noop\n    }\n    const srcUrl = utils_1.updateQueryParams({\n        url: parentUrl,\n        isPreload,\n        disableGoogleAnalytics\n    }, url);\n    const iframe = document.createElement('iframe');\n    iframe.id = id;\n    iframe.name = id.replace(/--.*/, '');\n    iframe.title = id;\n    iframe.src = srcUrl;\n    if (['Safari', 'Firefox'].includes(utils_1.browserInfo().browser)) {\n        iframe.setAttribute('sandbox', 'allow-storage-access-by-user-activation allow-scripts allow-same-origin');\n    }\n    iframe.style.position = 'fixed';\n    iframe.style.bottom = '0';\n    iframe.style.right = '0';\n    iframe.style.width = '0';\n    iframe.style.height = '0';\n    iframe.style.border = '0';\n    iframe.style.background = 'transparent';\n    iframe.style.zIndex = `${defaultIframeStyle.zIndex}`;\n    iframe.setAttribute('frameborder', '0');\n    iframe.setAttribute('scrolling', 'no');\n    return iframe;\n};\nconst onDomReady = () => {\n    return new Promise((resolve) => {\n        if (typeof window !== 'undefined') {\n            if (document.readyState !== 'loading') {\n                resolve();\n            }\n            else {\n                document.addEventListener('DOMContentLoaded', () => resolve());\n            }\n        }\n    });\n};\nclass Authereum extends eventemitter3_1.default {\n    constructor(config) {\n        super();\n        this._debug = !!utils_1.getQueryParamValue('debug');\n        this._notifier = defaultNotifier;\n        this._cacheReady = false;\n        this._iframeReady = false;\n        this._configReady = false;\n        this._iframeConnecting = null;\n        this._readyEmitted = false;\n        this._widgetEnabled = false;\n        this._iframeStyle = defaultIframeStyle;\n        this._notificationIframeStyle = defaultIframeStyle;\n        this._blockedPopupRedirect = true;\n        this._forceRedirect = false;\n        this._heartbeatStarted = false;\n        this._backoffTimeout = 1;\n        this._userConfig = null;\n        this._asymmetricEncryptionKey = null;\n        this._authereumQueryParams = {};\n        this._injectedElements = [];\n        this._notificationsMap = {};\n        this._destroyed = false;\n        this._starkProvider = null;\n        this._zkSyncProvider = null;\n        this._isPreload = false;\n        this._disableGoogleAnalytics = false;\n        this._eventListeners = [];\n        // NOTE: keep this sync\n        this._init = (config) => {\n            this._initConfig(config);\n            this._iframeStyle = {\n                width: 0,\n                height: 0,\n                top: 0,\n                left: 0,\n                zIndex: 0\n            };\n            this._provider = new AuthereumProvider_1.default(this);\n            this._connectToChildIframe()\n                .catch(() => {\n                this._startHeartbeat(true);\n            })\n                .catch((err) => {\n                console.warn('ping error:', err.message);\n            });\n            this._setupCache().catch(noop);\n            this._cacheAuthereumQueryParams();\n            this._setupSigningKey().catch(noop);\n            this._setupResizeListener();\n            this._setupFocusListener();\n            this._setupActionKeyListener();\n            this._emitReadyEvent();\n        };\n        // NOTE: keep this sync\n        this._initConfig = (config) => {\n            if (typeof config === 'string') {\n                let network = config;\n                this._networkName = (network || '').trim().toLowerCase();\n                if (['mainnet', 'ropsten', 'rinkeby', 'kovan', 'goerli'].includes(this._networkName)) {\n                    this._xsUri = config_1.defaultConfig.xsUri(this._networkName);\n                }\n                else if (config === 'localhost') {\n                    this._xsUri = 'http://localhost:3002';\n                    this._networkName = 'kovan';\n                }\n                else {\n                    throw new Error('Unsupported network');\n                }\n            }\n            else {\n                config = config || {};\n                this._networkName = config.networkName || 'mainnet';\n                this._xsUri = config.xsUri || config_1.defaultConfig.xsUri(this._networkName);\n                this._apiKey = config.apiKey;\n            }\n            if (config.redirectUri) {\n                this._redirectUri = config.redirectUri;\n            }\n            else {\n                this._redirectUri = window.location.href;\n            }\n            this._redirectUri = this._redirectUri || window.location.href;\n        };\n        // NOTE: keep this sync\n        this._setConfig = (config) => {\n            if (typeof this._userConfig === 'string') {\n                let network = this._userConfig;\n                this._networkName = (network || '').trim().toLowerCase();\n                this._userConfig = {\n                    networkName: this._networkName,\n                    xsUri: config_1.defaultConfig.xsUri(this._networkName)\n                };\n            }\n            const { apiKey, apiUri, rpcUri, webUri, notifierUri, networkName, networkId, disableNotifications, blockedPopupRedirect, forceRedirect } = this._userConfig || {};\n            if (apiKey) {\n                this._apiKey = apiKey;\n            }\n            // userConfig overrides regular config\n            if (apiUri) {\n                this._apiUri = apiUri;\n            }\n            else if (config.apiUri) {\n                this._apiUri = config.apiUri;\n            }\n            // userConfig overrides regular config\n            if (rpcUri) {\n                this._rpcUri = rpcUri;\n            }\n            else if (config.rpcUri) {\n                this._rpcUri = config.rpcUri;\n            }\n            // userConfig overrides regular config\n            if (webUri) {\n                this._webUri = webUri;\n            }\n            else if (config.webUri) {\n                this._webUri = config.webUri;\n            }\n            // userConfig overrides regular config\n            if (notifierUri) {\n                this._notifierUri = notifierUri;\n            }\n            else if (config.notifierUri) {\n                this._notifierUri = config.notifierUri;\n            }\n            // userConfig overrides regular config\n            if (networkName) {\n                this._networkName = networkName;\n            }\n            else if (config.networkName) {\n                this._networkName = config.networkName;\n            }\n            // userConfig overrides regular config\n            if (networkId) {\n                this._networkId = networkId;\n            }\n            else if (config.networkId) {\n                this._networkId = config.networkId;\n            }\n            // userConfig overrides regular config\n            if (typeof disableNotifications === 'boolean') {\n                this._disableNotifications = disableNotifications;\n            }\n            else if (typeof config.disableNotifications === 'boolean') {\n                this._disableNotifications = config.disableNotifications;\n            }\n            // userConfig overrides regular config\n            if (typeof blockedPopupRedirect === 'boolean') {\n                this._blockedPopupRedirect = blockedPopupRedirect;\n            }\n            else if (typeof config.blockedPopupRedirect === 'boolean') {\n                this._blockedPopupRedirect = config.blockedPopupRedirect;\n            }\n            // userConfig overrides regular config\n            if (typeof forceRedirect === 'boolean') {\n                this._forceRedirect = forceRedirect;\n            }\n            else if (typeof config.forceRedirect === 'boolean') {\n                this._forceRedirect = config.forceRedirect;\n            }\n        };\n        this._setupCache = () => __awaiter(this, void 0, void 0, function* () {\n            yield Promise.all([\n                this._cacheLoginKeyAddress(),\n                this._cacheIsAuthenticated(),\n                this._cacheAccountAddress()\n            ]);\n            this._cacheReady = true;\n        });\n        this._handleWindowFocus = () => {\n            if (this._destroyed) {\n                return;\n            }\n            if (!this._bodyContainsIframe()) {\n                return;\n            }\n            return this._postMessageToChild({\n                method: 'onWindowFocus'\n            });\n        };\n        this._resetCache = () => __awaiter(this, void 0, void 0, function* () {\n            return this._setupCache();\n        });\n        this._injectScript = (sourceUrl, id = '') => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilDomReady();\n            return new Promise((resolve, reject) => {\n                if (!sourceUrl) {\n                    throw new Error('sourceUrl is required');\n                }\n                if (document.getElementById(id)) {\n                    resolve();\n                    return;\n                }\n                const script = document.createElement('script');\n                script.id = id;\n                script.type = 'text/javascript';\n                script.async = true;\n                script.onload = () => {\n                    resolve();\n                };\n                script.onerror = (err) => {\n                    reject(err);\n                };\n                script.src = sourceUrl;\n                this._injectedElements.push(script);\n                document.getElementsByTagName('head')[0].appendChild(script);\n            });\n        });\n        this._setupResizeListener = () => __awaiter(this, void 0, void 0, function* () {\n            this.addEventListener('resize', this._handleResizeThrottled, false);\n            this.addEventListener('resize', this._handleResizeDebounced, false);\n        });\n        this._handleActionKeyPress = (event) => {\n            if (this._destroyed) {\n                return;\n            }\n            if (!this._bodyContainsIframe()) {\n                return;\n            }\n            let keyName = '';\n            if (event.key === 'Escape' || event.key === 'Esc' || event.keyCode === 27) {\n                keyName = 'escape';\n            }\n            else if (event.key === 'Enter' || event.keyCode === 13) {\n                keyName = 'enter';\n            }\n            else if (event.key === 'ArrowLeft' || event.keyCode === 37) {\n                keyName = 'left';\n            }\n            else if (event.key === 'ArrowUp' || event.keyCode === 38) {\n                keyName = 'up';\n            }\n            else if (event.key === 'ArrowRight' || event.keyCode === 39) {\n                keyName = 'right';\n            }\n            else if (event.key === 'ArrowDown' || event.keyCode === 40) {\n                keyName = 'down';\n            }\n            if (keyName) {\n                return this._postMessageToChild({\n                    method: 'actionKeyPress',\n                    params: keyName\n                });\n            }\n        };\n        this._handleResize = (event) => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                return;\n            }\n            if (!this._bodyContainsIframe()) {\n                return;\n            }\n            const size = yield this._getWindowSize();\n            return this._postMessageToChild({\n                method: 'onResize',\n                params: size\n            });\n        });\n        this._handleResizeThrottled = utils_1.throttle((event) => {\n            return this._handleResize(event);\n        }, 10);\n        this._handleResizeDebounced = utils_1.debounce((event) => {\n            return this._handleResize(event);\n        }, 10);\n        this._cacheLoginKeyAddress = () => __awaiter(this, void 0, void 0, function* () {\n            const loginKey = yield this._postMessageToChild({\n                method: 'getOrCreateLoginKey'\n            });\n            this._cachedLoginKeyAddress = loginKey.publicAddress;\n        });\n        this._cacheAccountAddress = () => __awaiter(this, void 0, void 0, function* () {\n            const accountAddress = yield this._postMessageToChild({\n                method: 'getAccountAddress'\n            });\n            this._cachedAccountAddress = accountAddress;\n        });\n        this._cacheIsAuthenticated = () => __awaiter(this, void 0, void 0, function* () {\n            const isAuthenticated = yield this._postMessageToChild({\n                method: 'isAuthenticated'\n            });\n            this._cachedIsAuthenticated = isAuthenticated;\n        });\n        // NOTE: to prevent pop-ups from being blocked, there must be no awaits from\n        // click to window.open, meaning value lookups must be cached before the\n        // login method is called.\n        this.login = utils_1.throttle(() => __awaiter(this, void 0, void 0, function* () {\n            const isIframeReady = this._iframeReady && this._cacheReady;\n            const isConfigReady = this._configReady;\n            // these are false when dapp calls login immediately on page load\n            // so we're forced to wait here.\n            if (!(isIframeReady && isConfigReady)) {\n                yield this._tilConfigReady();\n                yield this._tilReady();\n            }\n            if (!this._cachedIsAuthenticated) {\n                // NOTE: if not logged in to dapp, then proceed to login\n                yield this._signLoginKeyRequest(this._cachedLoginKeyAddress);\n                return this.getAuthenticatedAccount();\n            }\n            else {\n                // only show one already logged in notification at a time\n                if (!this._notificationsMap['loggedIn']) {\n                    this._postMessageToChild({\n                        method: 'notification',\n                        params: {\n                            type: 'success',\n                            message: 'You are logged into Authereum',\n                            timeout: 5e3\n                        }\n                    })\n                        .catch(noop);\n                    this._notificationsMap['loggedIn'] = true;\n                    setTimeout(() => {\n                        this._notificationsMap['loggedIn'] = null;\n                    }, 5e3);\n                }\n            }\n            // await first\n            const account = yield this.getAuthenticatedAccount();\n            return account;\n        }), 250);\n        this.authenticate = () => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.authenticate()` is deprecated. Use `authereum.login()` instead.');\n            return this.login();\n        });\n        this.isAuthenticated = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'isAuthenticated'\n            }));\n        });\n        this.logout = () => __awaiter(this, void 0, void 0, function* () {\n            const res = yield this._postMessageToChild({\n                method: 'logout'\n            });\n            yield this._resetCache();\n            this.emit('logout', {});\n            return res;\n        });\n        this.getAuthenticatedAccount = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getAuthenticatedAccount'\n            }));\n        });\n        this.getDappKey = () => {\n            return this._handleError(this._postMessageToChild({\n                method: 'getLoginKey'\n            }));\n        };\n        this.getLoginKey = () => {\n            console.warn('Deprecation notice: `authereum.getLoginKey()` is deprecated. Use `authereum.getDappKey()` instead.');\n            return this.getDappKey();\n        };\n        this.signMessage = utils_1.throttle((message, options = {}) => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'signMessage',\n                params: [message, options]\n            }));\n        }), 250);\n        this.signPersonalMessage = utils_1.throttle((message) => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'signMessage',\n                params: [message, { personal: true }]\n            }));\n        }), 250);\n        this.signWithDappKey = utils_1.throttle((message) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signWithDappKey()` is deprecated. Use `authereum.signMess()` instead.');\n            return this.signMessage(message);\n        }), 250);\n        this.signWithLoginKey = utils_1.throttle((message) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signWithLoginKey()` is deprecated. Use `authereum.signWithDappKey()` instead.');\n            return this.signWithDappKey(message);\n        }), 250);\n        this.signTypedMessage = utils_1.throttle((message, options = {}) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signTypedMessage()` is deprecated. Use `authereum.signMessage()` instead.');\n            return this.signMessage(message, options);\n        }), 250);\n        this.signTypedMessageWithDappKey = utils_1.throttle((message) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signTypedMessageWithDappKey()` is deprecated. Use `authereum.signMessage()` instead.');\n            return this.signTypedMessage(message);\n        }), 250);\n        this.signMessageWithAdminKey = utils_1.throttle((message) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signMessageWithAdminKey()` is deprecated. Use `authereum.signMessageWithSigningKey()` instead.');\n            return null;\n        }), 250);\n        this.signMessageWithSigningKey = utils_1.throttle((message, options = {}) => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'signMessageWithSigningKey',\n                params: [message, options]\n            }));\n        }), 250);\n        this.getSigningKeyAddress = (message) => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getSigningKeyAddress'\n            }));\n        });\n        this.getLoginKeyAuthSignature = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getLoginKeyAuthSignature'\n            }));\n        });\n        this.getLoginKeyRestrictionsData = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getLoginKeyRestrictionsData'\n            }));\n        });\n        this.getSigningKeyAuthSignature = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getSigningKeyAuthSignature'\n            }));\n        });\n        this.getAccountAddress = () => __awaiter(this, void 0, void 0, function* () {\n            // required so it waits for login key to be set\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'getAccountAddress'\n            }));\n        });\n        this.getBalance = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getBalance'\n            }));\n        });\n        this.getRpcUri = () => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilConfigReady();\n            return this._rpcUri;\n        });\n        this.getNetworkId = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getNetworkId'\n            }));\n        });\n        this.getNetworkName = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getNetworkName'\n            }));\n        });\n        this.getCachedNetworkName = () => {\n            return this._networkName;\n        };\n        this.getProvider = () => {\n            return this._provider;\n        };\n        this.getStarkProvider = () => {\n            if (!this._starkProvider) {\n                this._starkProvider = new StarkWareProvider_1.default(this);\n            }\n            return this._starkProvider;\n        };\n        this.getZkSyncProvider = () => {\n            if (!this._zkSyncProvider) {\n                this._zkSyncProvider = new ZkSyncProvider_1.default(this);\n            }\n            return this._zkSyncProvider;\n        };\n        this._handleError = (promise) => __awaiter(this, void 0, void 0, function* () {\n            return promise\n                .catch((err) => {\n                // NOTE: emit errors but don't throw notification here.\n                this.emit('error', err);\n                // NOTE: rethrow error to let dapps handle error\n                throw err;\n            });\n        });\n        this.signTransaction = utils_1.throttle((tx) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'signTransaction',\n                params: serializeMessageObj(tx)\n            }));\n        }), 250);\n        this.signTransactionWithLoginKey = utils_1.throttle((tx) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signTransactionWithLoginKey()` is deprecated. Use `authereum.signTransaction()` instead.');\n            return this.signTransaction(tx);\n        }), 250);\n        this.sendTransaction = utils_1.throttle((userTransaction) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'sendTransaction',\n                params: serializeMessageObj(userTransaction)\n            }));\n        }), 250);\n        this.sendTransactionBatch = utils_1.throttle((userTransactions) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'sendTransactionBatch',\n                params: userTransactions.map(serializeMessageObj)\n            }));\n        }), 250);\n        this.estimateGas = (userTransaction) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'estimateGasBatch',\n                params: serializeMessageObj(userTransaction)\n            }));\n        });\n        this.estimateGasBatch = (userTransactions) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'estimateGasBatch',\n                params: userTransactions.map(serializeMessageObj)\n            }));\n        });\n        this.isReady = () => {\n            return this._iframeReady && this._cacheReady;\n        };\n        this.updateConfig = (config) => {\n            this._userConfig = config;\n            this._setConfig(config);\n        };\n        this.getConfig = () => {\n            return {\n                apiUri: this._apiUri,\n                rpcUri: this._rpcUri,\n                webUri: this._webUri,\n                xsUri: this._xsUri,\n                networkName: this._networkName,\n                networkId: this._networkId,\n                disableNotifications: this._disableNotifications\n            };\n        };\n        this.showWidget = (enabled = true) => __awaiter(this, void 0, void 0, function* () {\n            if (!enabled) {\n                this._widgetEnabled = false;\n                return this._postMessageToChild({\n                    method: 'hideWidget'\n                });\n            }\n            this._widgetEnabled = true;\n            return this._postMessageToChild({\n                method: 'showWidget'\n            });\n        });\n        this.hideWidget = () => __awaiter(this, void 0, void 0, function* () {\n            this._widgetEnabled = false;\n            return this._postMessageToChild({\n                method: 'hideWidget'\n            });\n        });\n        this.widgetEnabled = () => {\n            return this._widgetEnabled;\n        };\n        this.addFunds = (opts) => {\n            return this._postMessageToChild({\n                method: 'addFunds',\n                params: opts\n            });\n        };\n        this._openUrl = (opts = {}) => {\n            const { url, newWindow } = opts;\n            if (newWindow) {\n                window.open(url, '_blank');\n            }\n            else {\n                window.location.href = url;\n            }\n        };\n        this._tilIframeReady = () => __awaiter(this, void 0, void 0, function* () {\n            if (!this._iframeReady) {\n                yield utils_1.wait(100);\n                return this._tilIframeReady();\n            }\n            yield utils_1.wait(100);\n            return true;\n        });\n        this._tilConfigReady = () => __awaiter(this, void 0, void 0, function* () {\n            if (!this._configReady) {\n                yield utils_1.wait(100);\n                return this._tilConfigReady();\n            }\n            yield utils_1.wait(100);\n            return true;\n        });\n        this._tilReady = () => __awaiter(this, void 0, void 0, function* () {\n            if (!this.isReady()) {\n                yield utils_1.wait(100);\n                return this._tilReady();\n            }\n            yield utils_1.wait(100);\n            return true;\n        });\n        this._emitReadyEvent = () => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            if (this._readyEmitted)\n                return;\n            this._readyEmitted = true;\n            this.emit('ready', {});\n        });\n        this._connectToChildIframe = () => __awaiter(this, void 0, void 0, function* () {\n            if (this._iframeConnecting) {\n                return this._iframeConnecting;\n            }\n            this._iframeReady = false;\n            this._iframeConnecting = true;\n            const iframe = yield this._getOrCreateMainIframe();\n            this._iframeConnection = penpal_1.default.connectToChild({\n                iframe,\n                timeout: 60e3,\n                methods: {\n                    // NOTE: the postMessage penpal method should be the only method that\n                    // exists.\n                    postMessage: (data) => {\n                        return this._handlePostMessage(data);\n                    }\n                }\n            });\n            this._iframeConnecting = new Promise((resolve, reject) => {\n                let timedout = false;\n                const timer = setTimeout(() => {\n                    if (!this._iframeReady) {\n                        timedout = true;\n                        this._iframeConnecting = null;\n                        reject(new Error('timedout'));\n                    }\n                }, 6e3); // needs to be long enough for x-site to be fully loaded\n                this._iframeConnection.promise.then((child) => {\n                    clearTimeout(timer);\n                    if (timedout) {\n                        return;\n                    }\n                    this._iframeReady = true;\n                    this._childIframeConnection = child;\n                    this._startHeartbeat();\n                    this._iframeConnecting = null;\n                    resolve();\n                })\n                    .catch((err) => {\n                    clearTimeout(timer);\n                    if (timedout) {\n                        return;\n                    }\n                    reject(err);\n                });\n            });\n            return this._iframeConnecting;\n        });\n        this._startHeartbeat = (reconnect = false) => {\n            if (!this._heartbeatStarted) {\n                this._heartbeat(reconnect);\n                this._heartbeatStarted = true;\n            }\n        };\n        this._heartbeat = (reconnect = false) => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                return;\n            }\n            yield utils_1.wait(2e3);\n            try {\n                if (reconnect) {\n                    yield this._connectToChildIframe();\n                    this._backoffTimeout = 1;\n                    return this._heartbeat();\n                }\n                yield this._ping();\n            }\n            catch (err) {\n                // reconnect on destroyed connection error or ping timeout error\n                if (/destroy|timedout/gi.test(err.message)) {\n                    yield utils_1.wait(this._backoffTimeout * 1e3);\n                    // exponential backoff\n                    this._backoffTimeout = this._backoffTimeout << 1;\n                    return this._heartbeat(true);\n                }\n            }\n            return this._heartbeat();\n        });\n        this._ping = () => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                console.warn('Authereum instance destroyed. Message not posted to child.');\n                return;\n            }\n            return new Promise((resolve, reject) => {\n                let timedout = false;\n                const timer = setTimeout(() => {\n                    timedout = true;\n                }, 5e3);\n                this._postMessageToChild({\n                    method: 'ping'\n                }).then((pong) => {\n                    clearTimeout(timer);\n                    if (timedout) {\n                        reject(new Error('timedout'));\n                        return;\n                    }\n                    if (pong !== 'pong') {\n                        reject(new Error('Invalid response'));\n                        return;\n                    }\n                    resolve(pong);\n                })\n                    .catch(err => {\n                    reject(err);\n                });\n            });\n        });\n        this._constructIframe = (input) => {\n            const iframe = constructIframe(Object.assign(Object.assign({}, input), { isPreload: this._isPreload, disableGoogleAnalytics: this._disableGoogleAnalytics }));\n            if (this._debug) {\n                iframe.style.outline = '1px solid red';\n            }\n            this._injectedElements.push(iframe);\n            return iframe;\n        };\n        this._getConfigFromChild = () => __awaiter(this, void 0, void 0, function* () {\n            return this._postMessageToChild({\n                method: 'getConfig'\n            });\n        });\n        this._postVersionToChild = () => __awaiter(this, void 0, void 0, function* () {\n            return this._postMessageToChild({\n                method: 'version',\n                params: this.version()\n            });\n        });\n        this._postConfigToChild = () => __awaiter(this, void 0, void 0, function* () {\n            return this._postMessageToChild({\n                method: 'config',\n                params: {\n                    apiKey: this._apiKey,\n                    disableNotifications: this._disableNotifications\n                }\n            });\n        });\n        this._loadAsymmetricEncryptionKeyFromChild = () => __awaiter(this, void 0, void 0, function* () {\n            this._asymmetricEncryptionKey = yield this._postMessageToChild({\n                method: 'getAsymmetricEncryptionKey'\n            });\n        });\n        this._postMessageToChild = (payload) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilIframeReady();\n            if (this._destroyed) {\n                throw new Error('Authereum instance destroyed.');\n            }\n            if (!this._bodyContainsIframe()) {\n                this._destroyed = true;\n                this._teardownEventListeners();\n                // ignore destroy call to already destroyed iframe\n                if (payload.method === 'destroy') {\n                    return;\n                }\n                throw new Error('Authereum instance or iframe destroyed.');\n            }\n            return this._handleError(this._childIframeConnection.postMessage(payload));\n        });\n        this._handleChildLogoutEvent = () => __awaiter(this, void 0, void 0, function* () {\n            yield this._resetCache();\n            this.emit('logout', {});\n        });\n        this._handleChildDappKeyExpired = (loginKeyAddress) => __awaiter(this, void 0, void 0, function* () {\n            if (loginKeyAddress === this._cachedLoginKeyAddress) {\n                yield this._resetCache();\n                this.emit('dappKeyExpired', loginKeyAddress);\n                this.emit('logout');\n            }\n        });\n        this._handlePostMessage = (data) => {\n            try {\n                const { method, params } = data;\n                switch (method) {\n                    case 'onError':\n                        const err = params;\n                        this.emit('error', err);\n                        this._notifier.notify({\n                            type: 'error',\n                            message: err.message\n                        });\n                        return;\n                    case 'onLogout':\n                        return this._handleChildLogoutEvent();\n                    case 'onDappKeyExpired':\n                        return this._handleChildDappKeyExpired(params);\n                    case 'login':\n                        return this.login();\n                    case 'setWidgetPosition':\n                        // const position = params\n                        // const { x, y } = position\n                        // this.iframeStyle.left = x\n                        // this.iframeStyle.top = y\n                        // this._refreshWidget()\n                        return;\n                    case 'setWidgetSize': {\n                        const size = params;\n                        const { width, height } = size;\n                        this._iframeStyle.width = width;\n                        this._iframeStyle.height = height;\n                        return this._refreshWidget();\n                    }\n                    case 'setWidgetStyle': {\n                        const style = params;\n                        for (let key in style) {\n                            this._iframeStyle[key] = style[key];\n                        }\n                        return this._refreshWidget();\n                    }\n                    case 'setNotificationWidgetSize': {\n                        const size = params;\n                        const { width, height } = size;\n                        this._notificationIframeStyle.width = width;\n                        this._notificationIframeStyle.height = height;\n                        return this._refreshNotificationWidget();\n                    }\n                    case 'setNotificationWidgetStyle': {\n                        const style = params;\n                        for (let key in style) {\n                            this._notificationIframeStyle[key] = style[key];\n                        }\n                        return this._refreshNotificationWidget();\n                    }\n                    case 'getWindowSize':\n                        return this._getWindowSize();\n                    case 'hideWidget':\n                        return this.hideWidget();\n                    case 'log':\n                        return this._handlePostMessageLog(params);\n                    case 'openUrl':\n                        return this._openUrl(params);\n                    default:\n                        break;\n                }\n            }\n            catch (err) {\n                // noop\n            }\n        };\n        this._handlePostMessageLog = (data) => {\n            if (this._isPreload) {\n                return;\n            }\n            let { type, message } = data;\n            if (!type) {\n                type = 'log';\n            }\n            console[type](message);\n        };\n        this._getWindowSize = () => {\n            return {\n                width: this._getWindowWidth(),\n                height: this._getWindowHeight()\n            };\n        };\n        this._getWindowWidth = () => {\n            return window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\n        };\n        this._getWindowHeight = () => {\n            return window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\n        };\n        // public _setIframePositionTop = (y: number) => {\n        // if (!this._iframe) return\n        // this._iframe.style.top = `${y}px`\n        // }\n        this._setIframePositionLeft = (x) => {\n            if (!this._iframe)\n                return;\n            this._iframe.style.left = `${x}px`;\n        };\n        this._setIframeWidth = (width) => {\n            if (!this._iframe)\n                return;\n            this._iframe.style.width = `${width}px`;\n        };\n        this._setIframeHeight = (height) => {\n            if (!this._iframe)\n                return;\n            this._iframe.style.height = `${height}px`;\n        };\n        this._refreshWidget = () => {\n            const { top, left, width, height, zIndex } = this._iframeStyle;\n            if (this._isPreload)\n                return;\n            if (!this._iframe)\n                return;\n            // this._setIframePositionTop(top)\n            // this._setIframePositionLeft(left)\n            this._setIframeWidth(width);\n            this._setIframeHeight(height);\n            this._iframe.style.zIndex = `${zIndex || 0}`;\n        };\n        this._refreshNotificationWidget = () => {\n            const { top, left, width, height, zIndex } = this._notificationIframeStyle;\n            if (this._isPreload)\n                return;\n            this._notificationIframe.style.width = `${width}px`;\n            this._notificationIframe.style.height = `${height}px`;\n            this._notificationIframe.style.zIndex = `${zIndex || 0}`;\n        };\n        this._loginKeyExists = () => __awaiter(this, void 0, void 0, function* () {\n            return !!(yield this.getLoginKey());\n        });\n        this._accountAddressExists = () => __awaiter(this, void 0, void 0, function* () {\n            return !!(yield this.getAccountAddress());\n        });\n        this._getAccountAdminKeyNonce = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getAccountAuthKeyNonce'\n            }));\n        });\n        this._getAccountAuthKeyNonce = () => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum._getAccountAuthKeyNonce()` is deprecated. Use `authereum._getAccountAdminKeyNonce()` instead.');\n            return this._getAccountAdminKeyNonce();\n        });\n        this._executeLoginKeyMetaTx = (tx) => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'executeLoginKeyMetaTx',\n                params: serializeMessageObj(tx)\n            }));\n        });\n        this._loadLoginKey = (loginKey) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'loadLoginKey',\n                params: loginKey\n            }));\n        });\n        this._getAuthenticateUri = (loginKeyAddress) => {\n            const encryptionKey = this._asymmetricEncryptionKey;\n            const date = new Date();\n            date.setDate(date.getDate() + 30); // expire in 30 days\n            const expiresAt = (date.getTime() / 1e3) | 0;\n            // NOTE: slk = sign login key\n            return this._webUri + '/?slk=' + encodeURIComponent(JSON.stringify({\n                loginKey: {\n                    publicAddress: loginKeyAddress,\n                    expiresAt\n                },\n                encryptionKey\n            })) + '&redirect_uri=' + this._redirectUri;\n        };\n        this._getSignWithAdminKeyUri = (message) => {\n            if (is_buffer_1.default(message)) {\n                message = `0x${message.toString('hex')}`;\n            }\n            // NOTE: sm = sign message\n            return this._webUri + '/?sm=' + encodeURIComponent(JSON.stringify({\n                message\n            })) + '&redirect_uri=' + this._redirectUri;\n        };\n        this._openPopupOrRedirect = (url) => __awaiter(this, void 0, void 0, function* () {\n            this.emit('openPopup', {});\n            if (this._forceRedirect) {\n                window.location.href = url;\n                return;\n            }\n            let child = this._getAuthereumPopupWindow(url);\n            let isBlocked = this._isAuthereumPopupBlocked(child);\n            if (isBlocked && !this._blockedPopupRedirect) {\n                const err = new Error('Disable popup blocker and try again');\n                this._notifier.notify({\n                    type: 'error',\n                    message: err.message,\n                    timeout: 5000\n                });\n                throw err;\n            }\n            else if (isBlocked) {\n                this.emit('popupBlocked');\n                const shouldShowPopupOrRedirect = yield this._showConfirmPopupOrRedirectModal();\n                if (!shouldShowPopupOrRedirect) {\n                    const errMessage = 'Popup or redirect rejected';\n                    this.emit('error', errMessage);\n                    throw new Error(errMessage);\n                }\n                // Try to bring up a user-initiated popup. If this fails\n                // fallback to a redirect\n                child = this._getAuthereumPopupWindow(url);\n                isBlocked = this._isAuthereumPopupBlocked(child);\n                if (isBlocked) {\n                    window.location.href = url;\n                    return;\n                }\n            }\n            child.focus();\n            return new Promise((resolve, reject) => {\n                const interval = setInterval(() => __awaiter(this, void 0, void 0, function* () {\n                    if (child.closed) {\n                        cleanUp();\n                        const err = new Error('Window closed');\n                        this.emit('error', err);\n                        this.emit('closePopup', {});\n                        reject(err);\n                    }\n                }), 250);\n                const timeout = setTimeout(() => {\n                    cleanUp();\n                    child.close();\n                    doneWithError(new Error('Timedout'));\n                }, 10 * 60 * 1000);\n                const cleanUp = () => {\n                    clearInterval(interval);\n                    clearTimeout(timeout);\n                    this.emit('closePopup', {});\n                };\n                const doneWithError = (err) => {\n                    cleanUp();\n                    this.emit('error', err);\n                    reject(err);\n                };\n                const done = (result = {}) => {\n                    cleanUp();\n                    resolve(result);\n                };\n                const handleParentMessageEvent = (event) => __awaiter(this, void 0, void 0, function* () {\n                    if (event.origin.includes(this._webUri)) {\n                        // this event tells parent to close child popup\n                        if (event.data.close) {\n                            child.close();\n                            done();\n                        }\n                        if (event.data.login) {\n                            done({ success: true });\n                            this.emit('login', {});\n                            this._cachedIsAuthenticated = true;\n                            if (event.data.encryptedSigningKey) {\n                                yield this._loadSigningKey(event.data.encryptedSigningKey);\n                            }\n                            this._logAnalyticsEvent({\n                                eventType: 'logged_in_dapp',\n                                properties: {\n                                    dapp_url: window.location.href\n                                }\n                            });\n                            if (this._redirectUri !== window.location.href) {\n                                window.location.href = this._redirectUri;\n                            }\n                        }\n                        if (event.data.result) {\n                            done(event.data.result);\n                            if (this._redirectUri !== window.location.href) {\n                                window.location.href = this._redirectUri;\n                            }\n                        }\n                        if (event.data.error) {\n                            doneWithError(new Error(event.data.error));\n                            if (this._redirectUri !== window.location.href) {\n                                window.location.href = this._redirectUri;\n                            }\n                        }\n                    }\n                });\n                this.addEventListener('message', handleParentMessageEvent, false);\n            });\n        });\n        this.addEventListener = (type, listener, useCapture = false) => {\n            window.addEventListener(type, listener, useCapture);\n            this._eventListeners.push({ type, listener, useCapture });\n        };\n        this._showConfirmPopupOrRedirectModal = () => {\n            return this._handleError(this._postMessageToChild({\n                method: 'showConfirmPopupOrRedirectModal'\n            }));\n        };\n        this._signLoginKeyRequest = (publicAddress) => __awaiter(this, void 0, void 0, function* () {\n            const url = this._getAuthenticateUri(publicAddress);\n            return this._openPopupOrRedirect(url);\n        });\n        this._tilDomReady = () => __awaiter(this, void 0, void 0, function* () {\n            return onDomReady();\n        });\n        // keep both static and normal version methods\n        this.version = () => {\n            return version_1.default;\n        };\n        this.isAuthenticatedSync = () => {\n            return this._cachedIsAuthenticated;\n        };\n        this.getTransactionReceipt = (txHash) => {\n            return this._handleError(this._postMessageToChild({\n                method: 'getTransactionReceipt',\n                params: txHash\n            }));\n        };\n        this.waitForTransactionReceipt = (txHash) => {\n            return this._handleError(this._postMessageToChild({\n                method: 'waitForTransactionReceipt',\n                params: txHash\n            }));\n        };\n        this.hasRecoveryEnabled = () => {\n            return this._handleError(this._postMessageToChild({\n                method: 'hasRecoveryEnabled'\n            }));\n        };\n        this.getEncryptionPublicKey = () => {\n            return this._handleError(this._postMessageToChild({\n                method: 'getEncryptionPublicKey'\n            }));\n        };\n        this.encryptMessage = (message) => {\n            return this._handleError(this._postMessageToChild({\n                method: 'encryptMessage',\n                params: message\n            }));\n        };\n        this.decryptMessage = (encryptedMessage) => {\n            return this._handleError(this._postMessageToChild({\n                method: 'decryptMessage',\n                params: encryptedMessage\n            }));\n        };\n        this.isContractDeployed = (accountAddress) => {\n            return this._handleError(this._postMessageToChild({\n                method: 'isContractDeployed',\n                params: accountAddress\n            }));\n        };\n        this._loadSigningKey = (signingKey) => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                console.warn('Authereum instance destroyed. Message not posted to child.');\n                return;\n            }\n            return this._postMessageToChild({\n                method: 'loadSigningKey',\n                params: signingKey\n            });\n        });\n        this._logAnalyticsEvent = (input) => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                console.warn('Authereum instance destroyed. Message not posted to child.');\n                return;\n            }\n            return this._postMessageToChild({\n                method: 'logAnalyticsEvent',\n                params: input\n            });\n        });\n        this._setupSigningKey = () => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            const encryptedSigningKey = this._authereumQueryParams['encryptedSigningKey'];\n            if (encryptedSigningKey) {\n                const success = yield this._loadSigningKey(encryptedSigningKey);\n                if (success) {\n                    try {\n                        localStorage.removeItem('_authereum');\n                    }\n                    catch (err) {\n                        // noop\n                    }\n                }\n            }\n        });\n        this._cacheAuthereumQueryParams = () => __awaiter(this, void 0, void 0, function* () {\n            try {\n                const param = utils_1.getQueryParamValue('_authereum');\n                if (param) {\n                    this._authereumQueryParams = JSON.parse(param);\n                    try {\n                        localStorage.setItem('_authereum', btoa(JSON.stringify(this._authereumQueryParams)));\n                    }\n                    catch (err) {\n                        // noop\n                    }\n                    const newUrl = utils_1.removeQueryParam('_authereum');\n                    utils_1.replaceWindowUrl(newUrl);\n                }\n                else {\n                    try {\n                        // load from local storage cache if exists.\n                        // this local storage is cleared after connection.\n                        let cached = localStorage.getItem('_authereum');\n                        if (cached) {\n                            this._authereumQueryParams = JSON.parse(atob(cached));\n                        }\n                    }\n                    catch (err) {\n                        // noop\n                    }\n                }\n            }\n            catch (err) {\n                // noop\n            }\n        });\n        this.destroy = () => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                console.warn('Authereum instance already destroyed.');\n                return true;\n            }\n            try {\n                if (this._iframeReady && this._bodyContainsIframe()) {\n                    yield this._postMessageToChild({\n                        method: 'destroy'\n                    });\n                }\n            }\n            catch (err) {\n                console.warn(err);\n            }\n            for (let i = 0; i < this._injectedElements.length; i++) {\n                const element = this._injectedElements[i];\n                try {\n                    element.remove();\n                }\n                catch (err) {\n                    console.error(err);\n                }\n            }\n            /*\n            const elements = document.querySelectorAll('[id*=\"authereum\"]')\n            for (let i = 0; i < elements.length; i++) {\n              const element = elements[i]\n              try {\n                element.remove()\n              } catch (err) {\n                console.error(err)\n              }\n            }\n            */\n            this._iframeReady = false;\n            this._destroyed = true;\n            console.warn('Authereum instance destroyed.');\n            this._teardownEventListeners();\n            this.emit('destroy', {});\n            return true;\n        });\n        this.isDestroyed = () => {\n            return this._destroyed;\n        };\n        this.getAddressQrCodeDataUri = (address) => __awaiter(this, void 0, void 0, function* () {\n            return this._postMessageToChild({\n                method: 'getAddressQrCodeDataUri',\n                params: {\n                    address\n                }\n            });\n        });\n        this._loadNotificationsIframe = (url) => __awaiter(this, void 0, void 0, function* () {\n            const id = 'authereum__x-notification-iframe';\n            let el = document.getElementById(id);\n            if (el && el.src === url) {\n                this._notificationIframe = el;\n            }\n            else {\n                if (el) {\n                    el.remove();\n                }\n                this._notificationIframe = this._constructIframe({ id, url });\n                this._notificationIframe.style.top = '0';\n                this._notificationIframe.style.right = '0';\n                yield this._tilDomReady();\n                el = document.getElementById(id);\n                if (el) {\n                    el.remove();\n                }\n                document.body.appendChild(this._notificationIframe);\n            }\n        });\n        this._setDebug = (enabled) => __awaiter(this, void 0, void 0, function* () {\n            this._debug = enabled;\n            if (this._debug) {\n                this._iframe.style.outline = '1px solid red';\n                this._notificationIframe.style.outline = '1px solid red';\n            }\n            else {\n                this._iframe.style.outline = '0';\n                this._notificationIframe.style.outline = '0';\n            }\n        });\n        this._userConfig = config;\n        if (config instanceof Object) {\n            this._isPreload = !!config.isPreload;\n            this._disableGoogleAnalytics = !!config.disableGoogleAnalytics;\n        }\n        const merged = this._checkCachedInstance(config);\n        if (merged) {\n            return merged;\n        }\n        this._init(config);\n        if (window._authereumInstances) {\n            window._authereumInstances.push(this);\n        }\n    }\n    _checkCachedInstance(config) {\n        let cachedInstance = null;\n        if (Array.isArray(window._authereumInstances)) {\n            if (window._authereumInstances.length) {\n                cachedInstance = window._authereumInstances.pop();\n            }\n        }\n        // checks if preloaded cached iframe matches the same network as user created\n        // instance, and if so then merge the state to use preloaded iframe.\n        if (cachedInstance) {\n            if (cachedInstance.isReady()) {\n                if (typeof config === 'string') {\n                    if (cachedInstance.getCachedNetworkName() === config) {\n                        return this._merge(cachedInstance);\n                    }\n                    else {\n                        cachedInstance.destroy();\n                        cachedInstance = null;\n                    }\n                }\n                else if (config instanceof Object) {\n                    if (cachedInstance.getCachedNetworkName() === config.networkName &&\n                        !config.xsUri) {\n                        return this._merge(cachedInstance);\n                    }\n                    else {\n                        cachedInstance.destroy();\n                        cachedInstance = null;\n                    }\n                }\n            }\n            else {\n                cachedInstance.destroy();\n                cachedInstance = null;\n            }\n        }\n    }\n    // this merges an authereum instance with this one\n    // by copying all properties and connected iframes.\n    _merge(instance) {\n        this._debug = instance._debug;\n        this._apiKey = instance._apiKey;\n        this._apiUri = instance._apiUri;\n        this._rpcUri = instance._rpcUri;\n        this._webUri = instance._webUri;\n        this._xsUri = instance._xsUri;\n        this._notifierUri = instance._notifierUri;\n        this._networkName = instance._networkName;\n        this._networkId = instance._networkId;\n        this._redirectUri = instance._redirectUri;\n        this._iframeConnection = instance._iframeConnection;\n        this._childIframeConnection = instance._childIframeConnection;\n        this._iframe = instance._iframe;\n        this._notificationIframe = instance._notificationIframe;\n        this._cacheReady = instance._cacheReady;\n        this._cachedLoginKeyAddress = instance._cachedLoginKeyAddress;\n        this._cachedAccountAddress = instance._cachedAccountAddress;\n        this._cachedIsAuthenticated = instance._cachedIsAuthenticated;\n        this._iframeReady = instance._iframeReady;\n        this._configReady = instance._configReady;\n        this._iframeStyle = instance._iframeStyle;\n        this._notificationIframeStyle = instance._notificationIframeStyle;\n        this._heartbeatStarted = instance._heartbeatStarted;\n        this._backoffTimeout = instance._backoffTimeout;\n        this._asymmetricEncryptionKey = instance._asymmetricEncryptionKey;\n        this._authereumQueryParams = instance._authereumQueryParams;\n        this._injectedElements = instance._injectedElements;\n        this._notificationsMap = instance._notificationsMap;\n        instance._handlePostMessage = this._handlePostMessage.bind(instance);\n        this._initConfig(this._userConfig);\n        this._cacheLoginKeyAddress();\n        this._getConfigFromChild()\n            .then((config) => {\n            this._setConfig(config);\n            this._postConfigToChild().catch(noop);\n            this.emit('iframeReady', {});\n        })\n            .catch(noop);\n        this._emitReadyEvent();\n        this._provider = new AuthereumProvider_1.default(this);\n        this._refreshWidget();\n        return this;\n    }\n    _setupFocusListener() {\n        this.addEventListener('focus', this._handleWindowFocus, false);\n    }\n    _setupActionKeyListener() {\n        this.addEventListener('keydown', this._handleActionKeyPress, false);\n    }\n    _teardownEventListeners() {\n        for (let i = 0; i < this._eventListeners.length; i++) {\n            const { type, listener, useCapture } = this._eventListeners[i];\n            window.removeEventListener(type, listener, useCapture);\n        }\n    }\n    _getOrCreateMainIframe() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._iframe) {\n                if (this._iframeConnection) {\n                    this._iframeConnection.destroy();\n                }\n                this._iframe.remove();\n            }\n            return new Promise((resolve) => __awaiter(this, void 0, void 0, function* () {\n                const id = 'authereum__x-iframe';\n                let el = document.getElementById(id);\n                if (el && el.src === this._xsUri) {\n                    this._iframe = el;\n                }\n                else {\n                    this._iframe = this._constructIframe({ id, url: this._xsUri });\n                    let notificationIframeUrl = `${this._xsUri.replace(/\\/$/, '')}/notifications`;\n                    this._loadNotificationsIframe(notificationIframeUrl).catch(noop);\n                    resolve(this._iframe);\n                    yield this._tilDomReady();\n                    el = document.getElementById(id);\n                    if (el) {\n                        el.remove();\n                    }\n                    document.body.appendChild(this._iframe);\n                    this._iframe.onload = () => {\n                        this._postVersionToChild().catch(noop);\n                        this._loadAsymmetricEncryptionKeyFromChild().catch(noop);\n                        this._getConfigFromChild()\n                            .then((config) => {\n                            if (notificationIframeUrl !== config.notifierIframeUri) {\n                                this._loadNotificationsIframe(config.notifierIframeUri);\n                            }\n                            this._setConfig(config);\n                            this._postConfigToChild().catch(noop);\n                            this._configReady = true;\n                            this.emit('iframeReady', {});\n                        })\n                            .catch(noop);\n                    };\n                }\n            }));\n        });\n    }\n    _bodyContainsIframe() {\n        return document.body.contains(this._iframe);\n    }\n    _getAuthereumPopupWindow(url) {\n        return window.open(url, 'Authereum', `toolbar=no,\n      location=no,\n      status=no,\n      menubar=no,\n      scrollbars=no,\n      resizable=no,\n      width=470,\n      height=640`);\n    }\n    _isAuthereumPopupBlocked(child) {\n        return (child === null || child === undefined);\n    }\n    isPreload() {\n        return this._isPreload;\n    }\n}\nexports.default = Authereum;\n// keep both static and normal version methods\nAuthereum.version = () => {\n    return version_1.default;\n};\nif (typeof window !== 'undefined') {\n    window.Authereum = Authereum;\n    window._authereumInstances = [];\n    // disable preloading if param set for debugging\n    // if (!getQueryParamValue('debug_disable_preload')) {\n    if (utils_1.getQueryParamValue('authereum_debug')) {\n        // preload instance in order to avoid async calls between\n        // user action and login call.\n        let cachedNetwork = 'mainnet';\n        const networks = ['kovan', 'goerli', 'rinkeby', 'ropsten'];\n        for (let i = 0; i < networks.length; i++) {\n            // assuming which network to preload\n            if (window.location.href.includes(networks[i])) {\n                cachedNetwork = networks[i];\n                break;\n            }\n        }\n        const cachedInstance = new Authereum({\n            networkName: cachedNetwork,\n            isPreload: true\n        });\n        window._authereumInstances.push(cachedInstance);\n    }\n}\n"]},"metadata":{},"sourceType":"script"}