{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar token = require('./token.js');\n\nvar common = require('./common.js');\n\nvar _0uint = require('./0uint.js');\n\nvar MINOR_FALSE = 20;\nvar MINOR_TRUE = 21;\nvar MINOR_NULL = 22;\nvar MINOR_UNDEFINED = 23;\n\nfunction decodeUndefined(_data, _pos, _minor, options) {\n  if (options.allowUndefined === false) {\n    throw new Error(\"\".concat(common.decodeErrPrefix, \" undefined values are not supported\"));\n  } else if (options.coerceUndefinedToNull === true) {\n    return new token.Token(token.Type.null, null, 1);\n  }\n\n  return new token.Token(token.Type.undefined, undefined, 1);\n}\n\nfunction decodeBreak(_data, _pos, _minor, options) {\n  if (options.allowIndefinite === false) {\n    throw new Error(\"\".concat(common.decodeErrPrefix, \" indefinite length items not allowed\"));\n  }\n\n  return new token.Token(token.Type.break, undefined, 1);\n}\n\nfunction createToken(value, bytes, options) {\n  if (options) {\n    if (options.allowNaN === false && Number.isNaN(value)) {\n      throw new Error(\"\".concat(common.decodeErrPrefix, \" NaN values are not supported\"));\n    }\n\n    if (options.allowInfinity === false && (value === Infinity || value === -Infinity)) {\n      throw new Error(\"\".concat(common.decodeErrPrefix, \" Infinity values are not supported\"));\n    }\n  }\n\n  return new token.Token(token.Type.float, value, bytes);\n}\n\nfunction decodeFloat16(data, pos, _minor, options) {\n  return createToken(readFloat16(data, pos + 1), 3, options);\n}\n\nfunction decodeFloat32(data, pos, _minor, options) {\n  return createToken(readFloat32(data, pos + 1), 5, options);\n}\n\nfunction decodeFloat64(data, pos, _minor, options) {\n  return createToken(readFloat64(data, pos + 1), 9, options);\n}\n\nfunction encodeFloat(buf, token$1, options) {\n  var float = token$1.value;\n\n  if (float === false) {\n    buf.push([token.Type.float.majorEncoded | MINOR_FALSE]);\n  } else if (float === true) {\n    buf.push([token.Type.float.majorEncoded | MINOR_TRUE]);\n  } else if (float === null) {\n    buf.push([token.Type.float.majorEncoded | MINOR_NULL]);\n  } else if (float === undefined) {\n    buf.push([token.Type.float.majorEncoded | MINOR_UNDEFINED]);\n  } else {\n    var decoded;\n    var success = false;\n\n    if (!options || options.float64 !== true) {\n      encodeFloat16(float);\n      decoded = readFloat16(ui8a, 1);\n\n      if (float === decoded || Number.isNaN(float)) {\n        ui8a[0] = 249;\n        buf.push(ui8a.slice(0, 3));\n        success = true;\n      } else {\n        encodeFloat32(float);\n        decoded = readFloat32(ui8a, 1);\n\n        if (float === decoded) {\n          ui8a[0] = 250;\n          buf.push(ui8a.slice(0, 5));\n          success = true;\n        }\n      }\n    }\n\n    if (!success) {\n      encodeFloat64(float);\n      decoded = readFloat64(ui8a, 1);\n      ui8a[0] = 251;\n      buf.push(ui8a.slice(0, 9));\n    }\n  }\n}\n\nencodeFloat.encodedSize = function encodedSize(token, options) {\n  var float = token.value;\n\n  if (float === false || float === true || float === null || float === undefined) {\n    return 1;\n  }\n\n  var decoded;\n\n  if (!options || options.float64 !== true) {\n    encodeFloat16(float);\n    decoded = readFloat16(ui8a, 1);\n\n    if (float === decoded || Number.isNaN(float)) {\n      return 3;\n    }\n\n    encodeFloat32(float);\n    decoded = readFloat32(ui8a, 1);\n\n    if (float === decoded) {\n      return 5;\n    }\n  }\n\n  return 9;\n};\n\nvar buffer = new ArrayBuffer(9);\nvar dataView = new DataView(buffer, 1);\nvar ui8a = new Uint8Array(buffer, 0);\n\nfunction encodeFloat16(inp) {\n  if (inp === Infinity) {\n    dataView.setUint16(0, 31744, false);\n  } else if (inp === -Infinity) {\n    dataView.setUint16(0, 64512, false);\n  } else if (Number.isNaN(inp)) {\n    dataView.setUint16(0, 32256, false);\n  } else {\n    dataView.setFloat32(0, inp);\n    var valu32 = dataView.getUint32(0);\n    var exponent = (valu32 & 2139095040) >> 23;\n    var mantissa = valu32 & 8388607;\n\n    if (exponent === 255) {\n      dataView.setUint16(0, 31744, false);\n    } else if (exponent === 0) {\n      dataView.setUint16(0, (inp & 2147483648) >> 16 | mantissa >> 13, false);\n    } else {\n      var logicalExponent = exponent - 127;\n\n      if (logicalExponent < -24) {\n        dataView.setUint16(0, 0);\n      } else if (logicalExponent < -14) {\n        dataView.setUint16(0, (valu32 & 2147483648) >> 16 | 1 << 24 + logicalExponent, false);\n      } else {\n        dataView.setUint16(0, (valu32 & 2147483648) >> 16 | logicalExponent + 15 << 10 | mantissa >> 13, false);\n      }\n    }\n  }\n}\n\nfunction readFloat16(ui8a, pos) {\n  if (ui8a.length - pos < 2) {\n    throw new Error(\"\".concat(common.decodeErrPrefix, \" not enough data for float16\"));\n  }\n\n  var half = (ui8a[pos] << 8) + ui8a[pos + 1];\n\n  if (half === 31744) {\n    return Infinity;\n  }\n\n  if (half === 64512) {\n    return -Infinity;\n  }\n\n  if (half === 32256) {\n    return NaN;\n  }\n\n  var exp = half >> 10 & 31;\n  var mant = half & 1023;\n  var val;\n\n  if (exp === 0) {\n    val = mant * Math.pow(2, -24);\n  } else if (exp !== 31) {\n    val = (mant + 1024) * Math.pow(2, exp - 25);\n  } else {\n    val = mant === 0 ? Infinity : NaN;\n  }\n\n  return half & 32768 ? -val : val;\n}\n\nfunction encodeFloat32(inp) {\n  dataView.setFloat32(0, inp, false);\n}\n\nfunction readFloat32(ui8a, pos) {\n  if (ui8a.length - pos < 4) {\n    throw new Error(\"\".concat(common.decodeErrPrefix, \" not enough data for float32\"));\n  }\n\n  var offset = (ui8a.byteOffset || 0) + pos;\n  return new DataView(ui8a.buffer, offset, 4).getFloat32(0, false);\n}\n\nfunction encodeFloat64(inp) {\n  dataView.setFloat64(0, inp, false);\n}\n\nfunction readFloat64(ui8a, pos) {\n  if (ui8a.length - pos < 8) {\n    throw new Error(\"\".concat(common.decodeErrPrefix, \" not enough data for float64\"));\n  }\n\n  var offset = (ui8a.byteOffset || 0) + pos;\n  return new DataView(ui8a.buffer, offset, 8).getFloat64(0, false);\n}\n\nencodeFloat.compareTokens = _0uint.encodeUint.compareTokens;\nexports.decodeBreak = decodeBreak;\nexports.decodeFloat16 = decodeFloat16;\nexports.decodeFloat32 = decodeFloat32;\nexports.decodeFloat64 = decodeFloat64;\nexports.decodeUndefined = decodeUndefined;\nexports.encodeFloat = encodeFloat;","map":{"version":3,"sources":["/Users/sam/Desktop/kiwik/node_modules/cborg/cjs/lib/7float.js"],"names":["Object","defineProperty","exports","value","token","require","common","_0uint","MINOR_FALSE","MINOR_TRUE","MINOR_NULL","MINOR_UNDEFINED","decodeUndefined","_data","_pos","_minor","options","allowUndefined","Error","decodeErrPrefix","coerceUndefinedToNull","Token","Type","null","undefined","decodeBreak","allowIndefinite","break","createToken","bytes","allowNaN","Number","isNaN","allowInfinity","Infinity","float","decodeFloat16","data","pos","readFloat16","decodeFloat32","readFloat32","decodeFloat64","readFloat64","encodeFloat","buf","token$1","push","majorEncoded","decoded","success","float64","encodeFloat16","ui8a","slice","encodeFloat32","encodeFloat64","encodedSize","buffer","ArrayBuffer","dataView","DataView","Uint8Array","inp","setUint16","setFloat32","valu32","getUint32","exponent","mantissa","logicalExponent","length","half","NaN","exp","mant","val","offset","byteOffset","getFloat32","setFloat64","getFloat64","compareTokens","encodeUint"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar token = require('./token.js');\nvar common = require('./common.js');\nvar _0uint = require('./0uint.js');\n\nconst MINOR_FALSE = 20;\nconst MINOR_TRUE = 21;\nconst MINOR_NULL = 22;\nconst MINOR_UNDEFINED = 23;\nfunction decodeUndefined(_data, _pos, _minor, options) {\n  if (options.allowUndefined === false) {\n    throw new Error(`${ common.decodeErrPrefix } undefined values are not supported`);\n  } else if (options.coerceUndefinedToNull === true) {\n    return new token.Token(token.Type.null, null, 1);\n  }\n  return new token.Token(token.Type.undefined, undefined, 1);\n}\nfunction decodeBreak(_data, _pos, _minor, options) {\n  if (options.allowIndefinite === false) {\n    throw new Error(`${ common.decodeErrPrefix } indefinite length items not allowed`);\n  }\n  return new token.Token(token.Type.break, undefined, 1);\n}\nfunction createToken(value, bytes, options) {\n  if (options) {\n    if (options.allowNaN === false && Number.isNaN(value)) {\n      throw new Error(`${ common.decodeErrPrefix } NaN values are not supported`);\n    }\n    if (options.allowInfinity === false && (value === Infinity || value === -Infinity)) {\n      throw new Error(`${ common.decodeErrPrefix } Infinity values are not supported`);\n    }\n  }\n  return new token.Token(token.Type.float, value, bytes);\n}\nfunction decodeFloat16(data, pos, _minor, options) {\n  return createToken(readFloat16(data, pos + 1), 3, options);\n}\nfunction decodeFloat32(data, pos, _minor, options) {\n  return createToken(readFloat32(data, pos + 1), 5, options);\n}\nfunction decodeFloat64(data, pos, _minor, options) {\n  return createToken(readFloat64(data, pos + 1), 9, options);\n}\nfunction encodeFloat(buf, token$1, options) {\n  const float = token$1.value;\n  if (float === false) {\n    buf.push([token.Type.float.majorEncoded | MINOR_FALSE]);\n  } else if (float === true) {\n    buf.push([token.Type.float.majorEncoded | MINOR_TRUE]);\n  } else if (float === null) {\n    buf.push([token.Type.float.majorEncoded | MINOR_NULL]);\n  } else if (float === undefined) {\n    buf.push([token.Type.float.majorEncoded | MINOR_UNDEFINED]);\n  } else {\n    let decoded;\n    let success = false;\n    if (!options || options.float64 !== true) {\n      encodeFloat16(float);\n      decoded = readFloat16(ui8a, 1);\n      if (float === decoded || Number.isNaN(float)) {\n        ui8a[0] = 249;\n        buf.push(ui8a.slice(0, 3));\n        success = true;\n      } else {\n        encodeFloat32(float);\n        decoded = readFloat32(ui8a, 1);\n        if (float === decoded) {\n          ui8a[0] = 250;\n          buf.push(ui8a.slice(0, 5));\n          success = true;\n        }\n      }\n    }\n    if (!success) {\n      encodeFloat64(float);\n      decoded = readFloat64(ui8a, 1);\n      ui8a[0] = 251;\n      buf.push(ui8a.slice(0, 9));\n    }\n  }\n}\nencodeFloat.encodedSize = function encodedSize(token, options) {\n  const float = token.value;\n  if (float === false || float === true || float === null || float === undefined) {\n    return 1;\n  }\n  let decoded;\n  if (!options || options.float64 !== true) {\n    encodeFloat16(float);\n    decoded = readFloat16(ui8a, 1);\n    if (float === decoded || Number.isNaN(float)) {\n      return 3;\n    }\n    encodeFloat32(float);\n    decoded = readFloat32(ui8a, 1);\n    if (float === decoded) {\n      return 5;\n    }\n  }\n  return 9;\n};\nconst buffer = new ArrayBuffer(9);\nconst dataView = new DataView(buffer, 1);\nconst ui8a = new Uint8Array(buffer, 0);\nfunction encodeFloat16(inp) {\n  if (inp === Infinity) {\n    dataView.setUint16(0, 31744, false);\n  } else if (inp === -Infinity) {\n    dataView.setUint16(0, 64512, false);\n  } else if (Number.isNaN(inp)) {\n    dataView.setUint16(0, 32256, false);\n  } else {\n    dataView.setFloat32(0, inp);\n    const valu32 = dataView.getUint32(0);\n    const exponent = (valu32 & 2139095040) >> 23;\n    const mantissa = valu32 & 8388607;\n    if (exponent === 255) {\n      dataView.setUint16(0, 31744, false);\n    } else if (exponent === 0) {\n      dataView.setUint16(0, (inp & 2147483648) >> 16 | mantissa >> 13, false);\n    } else {\n      const logicalExponent = exponent - 127;\n      if (logicalExponent < -24) {\n        dataView.setUint16(0, 0);\n      } else if (logicalExponent < -14) {\n        dataView.setUint16(0, (valu32 & 2147483648) >> 16 | 1 << 24 + logicalExponent, false);\n      } else {\n        dataView.setUint16(0, (valu32 & 2147483648) >> 16 | logicalExponent + 15 << 10 | mantissa >> 13, false);\n      }\n    }\n  }\n}\nfunction readFloat16(ui8a, pos) {\n  if (ui8a.length - pos < 2) {\n    throw new Error(`${ common.decodeErrPrefix } not enough data for float16`);\n  }\n  const half = (ui8a[pos] << 8) + ui8a[pos + 1];\n  if (half === 31744) {\n    return Infinity;\n  }\n  if (half === 64512) {\n    return -Infinity;\n  }\n  if (half === 32256) {\n    return NaN;\n  }\n  const exp = half >> 10 & 31;\n  const mant = half & 1023;\n  let val;\n  if (exp === 0) {\n    val = mant * 2 ** -24;\n  } else if (exp !== 31) {\n    val = (mant + 1024) * 2 ** (exp - 25);\n  } else {\n    val = mant === 0 ? Infinity : NaN;\n  }\n  return half & 32768 ? -val : val;\n}\nfunction encodeFloat32(inp) {\n  dataView.setFloat32(0, inp, false);\n}\nfunction readFloat32(ui8a, pos) {\n  if (ui8a.length - pos < 4) {\n    throw new Error(`${ common.decodeErrPrefix } not enough data for float32`);\n  }\n  const offset = (ui8a.byteOffset || 0) + pos;\n  return new DataView(ui8a.buffer, offset, 4).getFloat32(0, false);\n}\nfunction encodeFloat64(inp) {\n  dataView.setFloat64(0, inp, false);\n}\nfunction readFloat64(ui8a, pos) {\n  if (ui8a.length - pos < 8) {\n    throw new Error(`${ common.decodeErrPrefix } not enough data for float64`);\n  }\n  const offset = (ui8a.byteOffset || 0) + pos;\n  return new DataView(ui8a.buffer, offset, 8).getFloat64(0, false);\n}\nencodeFloat.compareTokens = _0uint.encodeUint.compareTokens;\n\nexports.decodeBreak = decodeBreak;\nexports.decodeFloat16 = decodeFloat16;\nexports.decodeFloat32 = decodeFloat32;\nexports.decodeFloat64 = decodeFloat64;\nexports.decodeUndefined = decodeUndefined;\nexports.encodeFloat = encodeFloat;\n"]},"metadata":{},"sourceType":"script"}