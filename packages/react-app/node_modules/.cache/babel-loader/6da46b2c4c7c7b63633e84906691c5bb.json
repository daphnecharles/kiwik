{"ast":null,"code":"import { useEffect, useState } from 'react';\nexport function useReactiveVar(rv) {\n  var value = rv();\n  var setValue = useState(value)[1];\n  useEffect(function () {\n    var probablySameValue = rv();\n\n    if (value !== probablySameValue) {\n      setValue(probablySameValue);\n    } else {\n      return rv.onNextChange(setValue);\n    }\n  }, [value]);\n  return value;\n}","map":{"version":3,"sources":["../../../src/react/hooks/useReactiveVar.ts"],"names":[],"mappings":"AAAA,SAAS,SAAT,EAAoB,QAApB,QAAoC,OAApC;AAGA,OAAM,SAAU,cAAV,CAA4B,EAA5B,EAA8C;AAClD,MAAM,KAAK,GAAG,EAAE,EAAhB;AAIA,MAAM,QAAQ,GAAG,QAAQ,CAAC,KAAD,CAAR,CAAgB,CAAhB,CAAjB;AAKA,EAAA,SAAS,CAAC,YAAA;AACR,QAAM,iBAAiB,GAAG,EAAE,EAA5B;;AACA,QAAI,KAAK,KAAK,iBAAd,EAAiC;AAG/B,MAAA,QAAQ,CAAC,iBAAD,CAAR;AACD,KAJD,MAIO;AACL,aAAO,EAAE,CAAC,YAAH,CAAgB,QAAhB,CAAP;AACD;AACF,GATQ,EASN,CAAC,KAAD,CATM,CAAT;AAWA,SAAO,KAAP;AACD","sourcesContent":["import { useEffect, useState } from 'react';\nimport { ReactiveVar } from '../../core';\n\nexport function useReactiveVar<T>(rv: ReactiveVar<T>): T {\n  const value = rv();\n\n  // We don't actually care what useState thinks the value of the variable\n  // is, so we take only the update function from the returned array.\n  const setValue = useState(value)[1];\n\n  // We subscribe to variable updates on initial mount and when the value has\n  // changed. This avoids a subtle bug in React.StrictMode where multiple\n  // listeners are added, leading to inconsistent updates.\n  useEffect(() => {\n    const probablySameValue = rv();\n    if (value !== probablySameValue) {\n      // If the value of rv has already changed, we don't need to listen for the\n      // next change, because we can report this change immediately.\n      setValue(probablySameValue);\n    } else {\n      return rv.onNextChange(setValue);\n    }\n  }, [value]);\n\n  return value;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}