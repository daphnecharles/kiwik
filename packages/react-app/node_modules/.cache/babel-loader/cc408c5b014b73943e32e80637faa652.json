{"ast":null,"code":"// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n// Define search commands. Depends on dialog.js or another\n// implementation of the openDialog method.\n// Replace works a little oddly -- it will do the replace on the next\n// Ctrl-G (or whatever is bound to findNext) press. You prevent a\n// replace by making sure the match is no longer selected when hitting\n// Ctrl-G.\n(function (mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"), require(\"./searchcursor\"), require(\"../dialog/dialog\"));else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\", \"./searchcursor\", \"../dialog/dialog\"], mod);else // Plain browser env\n    mod(CodeMirror);\n})(function (CodeMirror) {\n  \"use strict\"; // default search panel location\n\n  CodeMirror.defineOption(\"search\", {\n    bottom: false\n  });\n\n  function searchOverlay(query, caseInsensitive) {\n    if (typeof query == \"string\") query = new RegExp(query.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\"), caseInsensitive ? \"gi\" : \"g\");else if (!query.global) query = new RegExp(query.source, query.ignoreCase ? \"gi\" : \"g\");\n    return {\n      token: function token(stream) {\n        query.lastIndex = stream.pos;\n        var match = query.exec(stream.string);\n\n        if (match && match.index == stream.pos) {\n          stream.pos += match[0].length || 1;\n          return \"searching\";\n        } else if (match) {\n          stream.pos = match.index;\n        } else {\n          stream.skipToEnd();\n        }\n      }\n    };\n  }\n\n  function SearchState() {\n    this.posFrom = this.posTo = this.lastQuery = this.query = null;\n    this.overlay = null;\n  }\n\n  function getSearchState(cm) {\n    return cm.state.search || (cm.state.search = new SearchState());\n  }\n\n  function queryCaseInsensitive(query) {\n    return typeof query == \"string\" && query == query.toLowerCase();\n  }\n\n  function getSearchCursor(cm, query, pos) {\n    // Heuristic: if the query string is all lowercase, do a case insensitive search.\n    return cm.getSearchCursor(query, pos, {\n      caseFold: queryCaseInsensitive(query),\n      multiline: true\n    });\n  }\n\n  function persistentDialog(cm, text, deflt, onEnter, onKeyDown) {\n    cm.openDialog(text, onEnter, {\n      value: deflt,\n      selectValueOnOpen: true,\n      closeOnEnter: false,\n      onClose: function onClose() {\n        clearSearch(cm);\n      },\n      onKeyDown: onKeyDown,\n      bottom: cm.options.search.bottom\n    });\n  }\n\n  function dialog(cm, text, shortText, deflt, f) {\n    if (cm.openDialog) cm.openDialog(text, f, {\n      value: deflt,\n      selectValueOnOpen: true,\n      bottom: cm.options.search.bottom\n    });else f(prompt(shortText, deflt));\n  }\n\n  function confirmDialog(cm, text, shortText, fs) {\n    if (cm.openConfirm) cm.openConfirm(text, fs);else if (confirm(shortText)) fs[0]();\n  }\n\n  function parseString(string) {\n    return string.replace(/\\\\([nrt\\\\])/g, function (match, ch) {\n      if (ch == \"n\") return \"\\n\";\n      if (ch == \"r\") return \"\\r\";\n      if (ch == \"t\") return \"\\t\";\n      if (ch == \"\\\\\") return \"\\\\\";\n      return match;\n    });\n  }\n\n  function parseQuery(query) {\n    var isRE = query.match(/^\\/(.*)\\/([a-z]*)$/);\n\n    if (isRE) {\n      try {\n        query = new RegExp(isRE[1], isRE[2].indexOf(\"i\") == -1 ? \"\" : \"i\");\n      } catch (e) {} // Not a regular expression after all, do a string search\n\n    } else {\n      query = parseString(query);\n    }\n\n    if (typeof query == \"string\" ? query == \"\" : query.test(\"\")) query = /x^/;\n    return query;\n  }\n\n  function startSearch(cm, state, query) {\n    state.queryText = query;\n    state.query = parseQuery(query);\n    cm.removeOverlay(state.overlay, queryCaseInsensitive(state.query));\n    state.overlay = searchOverlay(state.query, queryCaseInsensitive(state.query));\n    cm.addOverlay(state.overlay);\n\n    if (cm.showMatchesOnScrollbar) {\n      if (state.annotate) {\n        state.annotate.clear();\n        state.annotate = null;\n      }\n\n      state.annotate = cm.showMatchesOnScrollbar(state.query, queryCaseInsensitive(state.query));\n    }\n  }\n\n  function doSearch(cm, rev, persistent, immediate) {\n    var state = getSearchState(cm);\n    if (state.query) return findNext(cm, rev);\n    var q = cm.getSelection() || state.lastQuery;\n    if (q instanceof RegExp && q.source == \"x^\") q = null;\n\n    if (persistent && cm.openDialog) {\n      var hiding = null;\n\n      var searchNext = function searchNext(query, event) {\n        CodeMirror.e_stop(event);\n        if (!query) return;\n\n        if (query != state.queryText) {\n          startSearch(cm, state, query);\n          state.posFrom = state.posTo = cm.getCursor();\n        }\n\n        if (hiding) hiding.style.opacity = 1;\n        findNext(cm, event.shiftKey, function (_, to) {\n          var dialog;\n          if (to.line < 3 && document.querySelector && (dialog = cm.display.wrapper.querySelector(\".CodeMirror-dialog\")) && dialog.getBoundingClientRect().bottom - 4 > cm.cursorCoords(to, \"window\").top) (hiding = dialog).style.opacity = .4;\n        });\n      };\n\n      persistentDialog(cm, getQueryDialog(cm), q, searchNext, function (event, query) {\n        var keyName = CodeMirror.keyName(event);\n        var extra = cm.getOption('extraKeys'),\n            cmd = extra && extra[keyName] || CodeMirror.keyMap[cm.getOption(\"keyMap\")][keyName];\n\n        if (cmd == \"findNext\" || cmd == \"findPrev\" || cmd == \"findPersistentNext\" || cmd == \"findPersistentPrev\") {\n          CodeMirror.e_stop(event);\n          startSearch(cm, getSearchState(cm), query);\n          cm.execCommand(cmd);\n        } else if (cmd == \"find\" || cmd == \"findPersistent\") {\n          CodeMirror.e_stop(event);\n          searchNext(query, event);\n        }\n      });\n\n      if (immediate && q) {\n        startSearch(cm, state, q);\n        findNext(cm, rev);\n      }\n    } else {\n      dialog(cm, getQueryDialog(cm), \"Search for:\", q, function (query) {\n        if (query && !state.query) cm.operation(function () {\n          startSearch(cm, state, query);\n          state.posFrom = state.posTo = cm.getCursor();\n          findNext(cm, rev);\n        });\n      });\n    }\n  }\n\n  function findNext(cm, rev, callback) {\n    cm.operation(function () {\n      var state = getSearchState(cm);\n      var cursor = getSearchCursor(cm, state.query, rev ? state.posFrom : state.posTo);\n\n      if (!cursor.find(rev)) {\n        cursor = getSearchCursor(cm, state.query, rev ? CodeMirror.Pos(cm.lastLine()) : CodeMirror.Pos(cm.firstLine(), 0));\n        if (!cursor.find(rev)) return;\n      }\n\n      cm.setSelection(cursor.from(), cursor.to());\n      cm.scrollIntoView({\n        from: cursor.from(),\n        to: cursor.to()\n      }, 20);\n      state.posFrom = cursor.from();\n      state.posTo = cursor.to();\n      if (callback) callback(cursor.from(), cursor.to());\n    });\n  }\n\n  function clearSearch(cm) {\n    cm.operation(function () {\n      var state = getSearchState(cm);\n      state.lastQuery = state.query;\n      if (!state.query) return;\n      state.query = state.queryText = null;\n      cm.removeOverlay(state.overlay);\n\n      if (state.annotate) {\n        state.annotate.clear();\n        state.annotate = null;\n      }\n    });\n  }\n\n  function el(tag, attrs) {\n    var element = tag ? document.createElement(tag) : document.createDocumentFragment();\n\n    for (var key in attrs) {\n      element[key] = attrs[key];\n    }\n\n    for (var i = 2; i < arguments.length; i++) {\n      var child = arguments[i];\n      element.appendChild(typeof child == \"string\" ? document.createTextNode(child) : child);\n    }\n\n    return element;\n  }\n\n  function getQueryDialog(cm) {\n    return el(\"\", null, el(\"span\", {\n      className: \"CodeMirror-search-label\"\n    }, cm.phrase(\"Search:\")), \" \", el(\"input\", {\n      type: \"text\",\n      \"style\": \"width: 10em\",\n      className: \"CodeMirror-search-field\"\n    }), \" \", el(\"span\", {\n      style: \"color: #888\",\n      className: \"CodeMirror-search-hint\"\n    }, cm.phrase(\"(Use /re/ syntax for regexp search)\")));\n  }\n\n  function getReplaceQueryDialog(cm) {\n    return el(\"\", null, \" \", el(\"input\", {\n      type: \"text\",\n      \"style\": \"width: 10em\",\n      className: \"CodeMirror-search-field\"\n    }), \" \", el(\"span\", {\n      style: \"color: #888\",\n      className: \"CodeMirror-search-hint\"\n    }, cm.phrase(\"(Use /re/ syntax for regexp search)\")));\n  }\n\n  function getReplacementQueryDialog(cm) {\n    return el(\"\", null, el(\"span\", {\n      className: \"CodeMirror-search-label\"\n    }, cm.phrase(\"With:\")), \" \", el(\"input\", {\n      type: \"text\",\n      \"style\": \"width: 10em\",\n      className: \"CodeMirror-search-field\"\n    }));\n  }\n\n  function getDoReplaceConfirm(cm) {\n    return el(\"\", null, el(\"span\", {\n      className: \"CodeMirror-search-label\"\n    }, cm.phrase(\"Replace?\")), \" \", el(\"button\", {}, cm.phrase(\"Yes\")), \" \", el(\"button\", {}, cm.phrase(\"No\")), \" \", el(\"button\", {}, cm.phrase(\"All\")), \" \", el(\"button\", {}, cm.phrase(\"Stop\")));\n  }\n\n  function replaceAll(cm, query, text) {\n    cm.operation(function () {\n      for (var cursor = getSearchCursor(cm, query); cursor.findNext();) {\n        if (typeof query != \"string\") {\n          var match = cm.getRange(cursor.from(), cursor.to()).match(query);\n          cursor.replace(text.replace(/\\$(\\d)/g, function (_, i) {\n            return match[i];\n          }));\n        } else cursor.replace(text);\n      }\n    });\n  }\n\n  function replace(cm, all) {\n    if (cm.getOption(\"readOnly\")) return;\n    var query = cm.getSelection() || getSearchState(cm).lastQuery;\n    var dialogText = all ? cm.phrase(\"Replace all:\") : cm.phrase(\"Replace:\");\n    var fragment = el(\"\", null, el(\"span\", {\n      className: \"CodeMirror-search-label\"\n    }, dialogText), getReplaceQueryDialog(cm));\n    dialog(cm, fragment, dialogText, query, function (query) {\n      if (!query) return;\n      query = parseQuery(query);\n      dialog(cm, getReplacementQueryDialog(cm), cm.phrase(\"Replace with:\"), \"\", function (text) {\n        text = parseString(text);\n\n        if (all) {\n          replaceAll(cm, query, text);\n        } else {\n          clearSearch(cm);\n          var cursor = getSearchCursor(cm, query, cm.getCursor(\"from\"));\n\n          var advance = function advance() {\n            var start = cursor.from(),\n                match;\n\n            if (!(match = cursor.findNext())) {\n              cursor = getSearchCursor(cm, query);\n              if (!(match = cursor.findNext()) || start && cursor.from().line == start.line && cursor.from().ch == start.ch) return;\n            }\n\n            cm.setSelection(cursor.from(), cursor.to());\n            cm.scrollIntoView({\n              from: cursor.from(),\n              to: cursor.to()\n            });\n            confirmDialog(cm, getDoReplaceConfirm(cm), cm.phrase(\"Replace?\"), [function () {\n              doReplace(match);\n            }, advance, function () {\n              replaceAll(cm, query, text);\n            }]);\n          };\n\n          var doReplace = function doReplace(match) {\n            cursor.replace(typeof query == \"string\" ? text : text.replace(/\\$(\\d)/g, function (_, i) {\n              return match[i];\n            }));\n            advance();\n          };\n\n          advance();\n        }\n      });\n    });\n  }\n\n  CodeMirror.commands.find = function (cm) {\n    clearSearch(cm);\n    doSearch(cm);\n  };\n\n  CodeMirror.commands.findPersistent = function (cm) {\n    clearSearch(cm);\n    doSearch(cm, false, true);\n  };\n\n  CodeMirror.commands.findPersistentNext = function (cm) {\n    doSearch(cm, false, true, true);\n  };\n\n  CodeMirror.commands.findPersistentPrev = function (cm) {\n    doSearch(cm, true, true, true);\n  };\n\n  CodeMirror.commands.findNext = doSearch;\n\n  CodeMirror.commands.findPrev = function (cm) {\n    doSearch(cm, true);\n  };\n\n  CodeMirror.commands.clearSearch = clearSearch;\n  CodeMirror.commands.replace = replace;\n\n  CodeMirror.commands.replaceAll = function (cm) {\n    replace(cm, true);\n  };\n});","map":{"version":3,"sources":["/Users/sam/Desktop/kiwik/node_modules/codemirror/addon/search/search.js"],"names":["mod","exports","module","require","define","amd","CodeMirror","defineOption","bottom","searchOverlay","query","caseInsensitive","RegExp","replace","global","source","ignoreCase","token","stream","lastIndex","pos","match","exec","string","index","length","skipToEnd","SearchState","posFrom","posTo","lastQuery","overlay","getSearchState","cm","state","search","queryCaseInsensitive","toLowerCase","getSearchCursor","caseFold","multiline","persistentDialog","text","deflt","onEnter","onKeyDown","openDialog","value","selectValueOnOpen","closeOnEnter","onClose","clearSearch","options","dialog","shortText","f","prompt","confirmDialog","fs","openConfirm","confirm","parseString","ch","parseQuery","isRE","indexOf","e","test","startSearch","queryText","removeOverlay","addOverlay","showMatchesOnScrollbar","annotate","clear","doSearch","rev","persistent","immediate","findNext","q","getSelection","hiding","searchNext","event","e_stop","getCursor","style","opacity","shiftKey","_","to","line","document","querySelector","display","wrapper","getBoundingClientRect","cursorCoords","top","getQueryDialog","keyName","extra","getOption","cmd","keyMap","execCommand","operation","callback","cursor","find","Pos","lastLine","firstLine","setSelection","from","scrollIntoView","el","tag","attrs","element","createElement","createDocumentFragment","key","i","arguments","child","appendChild","createTextNode","className","phrase","type","getReplaceQueryDialog","getReplacementQueryDialog","getDoReplaceConfirm","replaceAll","getRange","all","dialogText","fragment","advance","start","doReplace","commands","findPersistent","findPersistentNext","findPersistentPrev","findPrev"],"mappings":"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","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/LICENSE\n\n// Define search commands. Depends on dialog.js or another\n// implementation of the openDialog method.\n\n// Replace works a little oddly -- it will do the replace on the next\n// Ctrl-G (or whatever is bound to findNext) press. You prevent a\n// replace by making sure the match is no longer selected when hitting\n// Ctrl-G.\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"), require(\"./searchcursor\"), require(\"../dialog/dialog\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\", \"./searchcursor\", \"../dialog/dialog\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  \"use strict\";\n\n  // default search panel location\n  CodeMirror.defineOption(\"search\", {bottom: false});\n\n  function searchOverlay(query, caseInsensitive) {\n    if (typeof query == \"string\")\n      query = new RegExp(query.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\"), caseInsensitive ? \"gi\" : \"g\");\n    else if (!query.global)\n      query = new RegExp(query.source, query.ignoreCase ? \"gi\" : \"g\");\n\n    return {token: function(stream) {\n      query.lastIndex = stream.pos;\n      var match = query.exec(stream.string);\n      if (match && match.index == stream.pos) {\n        stream.pos += match[0].length || 1;\n        return \"searching\";\n      } else if (match) {\n        stream.pos = match.index;\n      } else {\n        stream.skipToEnd();\n      }\n    }};\n  }\n\n  function SearchState() {\n    this.posFrom = this.posTo = this.lastQuery = this.query = null;\n    this.overlay = null;\n  }\n\n  function getSearchState(cm) {\n    return cm.state.search || (cm.state.search = new SearchState());\n  }\n\n  function queryCaseInsensitive(query) {\n    return typeof query == \"string\" && query == query.toLowerCase();\n  }\n\n  function getSearchCursor(cm, query, pos) {\n    // Heuristic: if the query string is all lowercase, do a case insensitive search.\n    return cm.getSearchCursor(query, pos, {caseFold: queryCaseInsensitive(query), multiline: true});\n  }\n\n  function persistentDialog(cm, text, deflt, onEnter, onKeyDown) {\n    cm.openDialog(text, onEnter, {\n      value: deflt,\n      selectValueOnOpen: true,\n      closeOnEnter: false,\n      onClose: function() { clearSearch(cm); },\n      onKeyDown: onKeyDown,\n      bottom: cm.options.search.bottom\n    });\n  }\n\n  function dialog(cm, text, shortText, deflt, f) {\n    if (cm.openDialog) cm.openDialog(text, f, {value: deflt, selectValueOnOpen: true, bottom: cm.options.search.bottom});\n    else f(prompt(shortText, deflt));\n  }\n\n  function confirmDialog(cm, text, shortText, fs) {\n    if (cm.openConfirm) cm.openConfirm(text, fs);\n    else if (confirm(shortText)) fs[0]();\n  }\n\n  function parseString(string) {\n    return string.replace(/\\\\([nrt\\\\])/g, function(match, ch) {\n      if (ch == \"n\") return \"\\n\"\n      if (ch == \"r\") return \"\\r\"\n      if (ch == \"t\") return \"\\t\"\n      if (ch == \"\\\\\") return \"\\\\\"\n      return match\n    })\n  }\n\n  function parseQuery(query) {\n    var isRE = query.match(/^\\/(.*)\\/([a-z]*)$/);\n    if (isRE) {\n      try { query = new RegExp(isRE[1], isRE[2].indexOf(\"i\") == -1 ? \"\" : \"i\"); }\n      catch(e) {} // Not a regular expression after all, do a string search\n    } else {\n      query = parseString(query)\n    }\n    if (typeof query == \"string\" ? query == \"\" : query.test(\"\"))\n      query = /x^/;\n    return query;\n  }\n\n  function startSearch(cm, state, query) {\n    state.queryText = query;\n    state.query = parseQuery(query);\n    cm.removeOverlay(state.overlay, queryCaseInsensitive(state.query));\n    state.overlay = searchOverlay(state.query, queryCaseInsensitive(state.query));\n    cm.addOverlay(state.overlay);\n    if (cm.showMatchesOnScrollbar) {\n      if (state.annotate) { state.annotate.clear(); state.annotate = null; }\n      state.annotate = cm.showMatchesOnScrollbar(state.query, queryCaseInsensitive(state.query));\n    }\n  }\n\n  function doSearch(cm, rev, persistent, immediate) {\n    var state = getSearchState(cm);\n    if (state.query) return findNext(cm, rev);\n    var q = cm.getSelection() || state.lastQuery;\n    if (q instanceof RegExp && q.source == \"x^\") q = null\n    if (persistent && cm.openDialog) {\n      var hiding = null\n      var searchNext = function(query, event) {\n        CodeMirror.e_stop(event);\n        if (!query) return;\n        if (query != state.queryText) {\n          startSearch(cm, state, query);\n          state.posFrom = state.posTo = cm.getCursor();\n        }\n        if (hiding) hiding.style.opacity = 1\n        findNext(cm, event.shiftKey, function(_, to) {\n          var dialog\n          if (to.line < 3 && document.querySelector &&\n              (dialog = cm.display.wrapper.querySelector(\".CodeMirror-dialog\")) &&\n              dialog.getBoundingClientRect().bottom - 4 > cm.cursorCoords(to, \"window\").top)\n            (hiding = dialog).style.opacity = .4\n        })\n      };\n      persistentDialog(cm, getQueryDialog(cm), q, searchNext, function(event, query) {\n        var keyName = CodeMirror.keyName(event)\n        var extra = cm.getOption('extraKeys'), cmd = (extra && extra[keyName]) || CodeMirror.keyMap[cm.getOption(\"keyMap\")][keyName]\n        if (cmd == \"findNext\" || cmd == \"findPrev\" ||\n          cmd == \"findPersistentNext\" || cmd == \"findPersistentPrev\") {\n          CodeMirror.e_stop(event);\n          startSearch(cm, getSearchState(cm), query);\n          cm.execCommand(cmd);\n        } else if (cmd == \"find\" || cmd == \"findPersistent\") {\n          CodeMirror.e_stop(event);\n          searchNext(query, event);\n        }\n      });\n      if (immediate && q) {\n        startSearch(cm, state, q);\n        findNext(cm, rev);\n      }\n    } else {\n      dialog(cm, getQueryDialog(cm), \"Search for:\", q, function(query) {\n        if (query && !state.query) cm.operation(function() {\n          startSearch(cm, state, query);\n          state.posFrom = state.posTo = cm.getCursor();\n          findNext(cm, rev);\n        });\n      });\n    }\n  }\n\n  function findNext(cm, rev, callback) {cm.operation(function() {\n    var state = getSearchState(cm);\n    var cursor = getSearchCursor(cm, state.query, rev ? state.posFrom : state.posTo);\n    if (!cursor.find(rev)) {\n      cursor = getSearchCursor(cm, state.query, rev ? CodeMirror.Pos(cm.lastLine()) : CodeMirror.Pos(cm.firstLine(), 0));\n      if (!cursor.find(rev)) return;\n    }\n    cm.setSelection(cursor.from(), cursor.to());\n    cm.scrollIntoView({from: cursor.from(), to: cursor.to()}, 20);\n    state.posFrom = cursor.from(); state.posTo = cursor.to();\n    if (callback) callback(cursor.from(), cursor.to())\n  });}\n\n  function clearSearch(cm) {cm.operation(function() {\n    var state = getSearchState(cm);\n    state.lastQuery = state.query;\n    if (!state.query) return;\n    state.query = state.queryText = null;\n    cm.removeOverlay(state.overlay);\n    if (state.annotate) { state.annotate.clear(); state.annotate = null; }\n  });}\n\n  function el(tag, attrs) {\n    var element = tag ? document.createElement(tag) : document.createDocumentFragment();\n    for (var key in attrs) {\n      element[key] = attrs[key];\n    }\n    for (var i = 2; i < arguments.length; i++) {\n      var child = arguments[i]\n      element.appendChild(typeof child == \"string\" ? document.createTextNode(child) : child);\n    }\n    return element;\n  }\n\n  function getQueryDialog(cm)  {\n    return el(\"\", null,\n              el(\"span\", {className: \"CodeMirror-search-label\"}, cm.phrase(\"Search:\")), \" \",\n              el(\"input\", {type: \"text\", \"style\": \"width: 10em\", className: \"CodeMirror-search-field\"}), \" \",\n              el(\"span\", {style: \"color: #888\", className: \"CodeMirror-search-hint\"},\n                 cm.phrase(\"(Use /re/ syntax for regexp search)\")));\n  }\n  function getReplaceQueryDialog(cm) {\n    return el(\"\", null, \" \",\n              el(\"input\", {type: \"text\", \"style\": \"width: 10em\", className: \"CodeMirror-search-field\"}), \" \",\n              el(\"span\", {style: \"color: #888\", className: \"CodeMirror-search-hint\"},\n                 cm.phrase(\"(Use /re/ syntax for regexp search)\")));\n  }\n  function getReplacementQueryDialog(cm) {\n    return el(\"\", null,\n              el(\"span\", {className: \"CodeMirror-search-label\"}, cm.phrase(\"With:\")), \" \",\n              el(\"input\", {type: \"text\", \"style\": \"width: 10em\", className: \"CodeMirror-search-field\"}));\n  }\n  function getDoReplaceConfirm(cm) {\n    return el(\"\", null,\n              el(\"span\", {className: \"CodeMirror-search-label\"}, cm.phrase(\"Replace?\")), \" \",\n              el(\"button\", {}, cm.phrase(\"Yes\")), \" \",\n              el(\"button\", {}, cm.phrase(\"No\")), \" \",\n              el(\"button\", {}, cm.phrase(\"All\")), \" \",\n              el(\"button\", {}, cm.phrase(\"Stop\")));\n  }\n\n  function replaceAll(cm, query, text) {\n    cm.operation(function() {\n      for (var cursor = getSearchCursor(cm, query); cursor.findNext();) {\n        if (typeof query != \"string\") {\n          var match = cm.getRange(cursor.from(), cursor.to()).match(query);\n          cursor.replace(text.replace(/\\$(\\d)/g, function(_, i) {return match[i];}));\n        } else cursor.replace(text);\n      }\n    });\n  }\n\n  function replace(cm, all) {\n    if (cm.getOption(\"readOnly\")) return;\n    var query = cm.getSelection() || getSearchState(cm).lastQuery;\n    var dialogText = all ? cm.phrase(\"Replace all:\") : cm.phrase(\"Replace:\")\n    var fragment = el(\"\", null,\n                      el(\"span\", {className: \"CodeMirror-search-label\"}, dialogText),\n                      getReplaceQueryDialog(cm))\n    dialog(cm, fragment, dialogText, query, function(query) {\n      if (!query) return;\n      query = parseQuery(query);\n      dialog(cm, getReplacementQueryDialog(cm), cm.phrase(\"Replace with:\"), \"\", function(text) {\n        text = parseString(text)\n        if (all) {\n          replaceAll(cm, query, text)\n        } else {\n          clearSearch(cm);\n          var cursor = getSearchCursor(cm, query, cm.getCursor(\"from\"));\n          var advance = function() {\n            var start = cursor.from(), match;\n            if (!(match = cursor.findNext())) {\n              cursor = getSearchCursor(cm, query);\n              if (!(match = cursor.findNext()) ||\n                  (start && cursor.from().line == start.line && cursor.from().ch == start.ch)) return;\n            }\n            cm.setSelection(cursor.from(), cursor.to());\n            cm.scrollIntoView({from: cursor.from(), to: cursor.to()});\n            confirmDialog(cm, getDoReplaceConfirm(cm), cm.phrase(\"Replace?\"),\n                          [function() {doReplace(match);}, advance,\n                           function() {replaceAll(cm, query, text)}]);\n          };\n          var doReplace = function(match) {\n            cursor.replace(typeof query == \"string\" ? text :\n                           text.replace(/\\$(\\d)/g, function(_, i) {return match[i];}));\n            advance();\n          };\n          advance();\n        }\n      });\n    });\n  }\n\n  CodeMirror.commands.find = function(cm) {clearSearch(cm); doSearch(cm);};\n  CodeMirror.commands.findPersistent = function(cm) {clearSearch(cm); doSearch(cm, false, true);};\n  CodeMirror.commands.findPersistentNext = function(cm) {doSearch(cm, false, true, true);};\n  CodeMirror.commands.findPersistentPrev = function(cm) {doSearch(cm, true, true, true);};\n  CodeMirror.commands.findNext = doSearch;\n  CodeMirror.commands.findPrev = function(cm) {doSearch(cm, true);};\n  CodeMirror.commands.clearSearch = clearSearch;\n  CodeMirror.commands.replace = replace;\n  CodeMirror.commands.replaceAll = function(cm) {replace(cm, true);};\n});\n"]},"metadata":{},"sourceType":"script"}