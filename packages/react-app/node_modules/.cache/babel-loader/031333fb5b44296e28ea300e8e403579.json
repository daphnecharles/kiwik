{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _constants = require(\"./constants\");\n\nvar _errorCodes = require(\"./errorCodes\");\n\nvar _createDestructor2 = _interopRequireDefault(require(\"./createDestructor\"));\n\nvar _connectCallReceiver = _interopRequireDefault(require(\"./connectCallReceiver\"));\n\nvar _connectCallSender = _interopRequireDefault(require(\"./connectCallSender\"));\n\nvar _createLogger = _interopRequireDefault(require(\"./createLogger\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/**\n * @typedef {Object} Parent\n * @property {Promise} promise A promise which will be resolved once a connection has\n * been established.\n * @property {Function} destroy A method that, when called, will disconnect any\n * messaging channels. You may call this even before a connection has been established.\n */\n\n/**\n * Attempts to establish communication with the parent window.\n * @param {Object} options\n * @param {string} [options.parentOrigin=*] Valid parent origin used to restrict communication.\n * @param {Object} [options.methods={}] Methods that may be called by the parent window.\n * @param {Number} [options.timeout] The amount of time, in milliseconds, Penpal should wait\n * for the parent to respond before rejecting the connection promise.\n * @return {Parent}\n */\n\n\nvar _default = function _default() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      _ref$parentOrigin = _ref.parentOrigin,\n      parentOrigin = _ref$parentOrigin === void 0 ? '*' : _ref$parentOrigin,\n      _ref$methods = _ref.methods,\n      methods = _ref$methods === void 0 ? {} : _ref$methods,\n      timeout = _ref.timeout,\n      debug = _ref.debug;\n\n  var log = (0, _createLogger.default)(debug);\n\n  if (window === window.top) {\n    var error = new Error('connectToParent() must be called within an iframe');\n    error.code = _errorCodes.ERR_NOT_IN_IFRAME;\n    throw error;\n  }\n\n  var _createDestructor = (0, _createDestructor2.default)(),\n      destroy = _createDestructor.destroy,\n      onDestroy = _createDestructor.onDestroy;\n\n  var child = window;\n  var parent = child.parent;\n  var promise = new Promise(function (resolveConnectionPromise, reject) {\n    var connectionTimeoutId;\n\n    if (timeout !== undefined) {\n      connectionTimeoutId = setTimeout(function () {\n        var error = new Error(\"Connection to parent timed out after \".concat(timeout, \"ms\"));\n        error.code = _errorCodes.ERR_CONNECTION_TIMEOUT;\n        reject(error);\n        destroy();\n      }, timeout);\n    }\n\n    var handleMessageEvent = function handleMessageEvent(event) {\n      // Under niche scenarios, we get into this function after\n      // the iframe has been removed from the DOM. In Edge, this\n      // results in \"Object expected\" errors being thrown when we\n      // try to access properties on window (global properties).\n      // For this reason, we try to access a global up front (clearTimeout)\n      // and if it fails we can assume the iframe has been removed\n      // and we ignore the message event.\n      try {\n        clearTimeout();\n      } catch (e) {\n        return;\n      }\n\n      if (event.source !== parent || event.data.penpal !== _constants.HANDSHAKE_REPLY) {\n        return;\n      }\n\n      if (parentOrigin !== '*' && parentOrigin !== event.origin) {\n        log(\"Child received handshake reply from origin \".concat(event.origin, \" which did not match expected origin \").concat(parentOrigin));\n        return;\n      }\n\n      log('Child: Received handshake reply');\n      child.removeEventListener(_constants.MESSAGE, handleMessageEvent);\n      var info = {\n        localName: 'Child',\n        local: child,\n        remote: parent,\n        originForSending: event.origin === 'null' ? '*' : event.origin,\n        originForReceiving: event.origin\n      };\n      var callSender = {};\n      var destroyCallReceiver = (0, _connectCallReceiver.default)(info, methods, log);\n      onDestroy(destroyCallReceiver);\n      var destroyCallSender = (0, _connectCallSender.default)(callSender, info, event.data.methodNames, destroy, log);\n      onDestroy(destroyCallSender);\n      clearTimeout(connectionTimeoutId);\n      resolveConnectionPromise(callSender);\n    };\n\n    child.addEventListener(_constants.MESSAGE, handleMessageEvent);\n    onDestroy(function () {\n      child.removeEventListener(_constants.MESSAGE, handleMessageEvent);\n      var error = new Error('Connection destroyed');\n      error.code = _errorCodes.ERR_CONNECTION_DESTROYED;\n      reject(error);\n    });\n    log('Child: Sending handshake');\n    parent.postMessage({\n      penpal: _constants.HANDSHAKE,\n      methodNames: Object.keys(methods)\n    }, parentOrigin);\n  });\n  return {\n    promise: promise,\n    destroy: destroy\n  };\n};\n\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["/Users/sam/Desktop/kiwik/node_modules/authereum/node_modules/penpal/lib/connectToParent.js"],"names":["Object","defineProperty","exports","value","default","_constants","require","_errorCodes","_createDestructor2","_interopRequireDefault","_connectCallReceiver","_connectCallSender","_createLogger","obj","__esModule","_default","_ref","arguments","length","undefined","_ref$parentOrigin","parentOrigin","_ref$methods","methods","timeout","debug","log","window","top","error","Error","code","ERR_NOT_IN_IFRAME","_createDestructor","destroy","onDestroy","child","parent","promise","Promise","resolveConnectionPromise","reject","connectionTimeoutId","setTimeout","ERR_CONNECTION_TIMEOUT","handleMessageEvent","event","clearTimeout","e","source","data","penpal","HANDSHAKE_REPLY","origin","removeEventListener","MESSAGE","info","localName","local","remote","originForSending","originForReceiving","callSender","destroyCallReceiver","destroyCallSender","methodNames","addEventListener","ERR_CONNECTION_DESTROYED","postMessage","HANDSHAKE","keys","module"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _constants = require(\"./constants\");\n\nvar _errorCodes = require(\"./errorCodes\");\n\nvar _createDestructor2 = _interopRequireDefault(require(\"./createDestructor\"));\n\nvar _connectCallReceiver = _interopRequireDefault(require(\"./connectCallReceiver\"));\n\nvar _connectCallSender = _interopRequireDefault(require(\"./connectCallSender\"));\n\nvar _createLogger = _interopRequireDefault(require(\"./createLogger\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * @typedef {Object} Parent\n * @property {Promise} promise A promise which will be resolved once a connection has\n * been established.\n * @property {Function} destroy A method that, when called, will disconnect any\n * messaging channels. You may call this even before a connection has been established.\n */\n\n/**\n * Attempts to establish communication with the parent window.\n * @param {Object} options\n * @param {string} [options.parentOrigin=*] Valid parent origin used to restrict communication.\n * @param {Object} [options.methods={}] Methods that may be called by the parent window.\n * @param {Number} [options.timeout] The amount of time, in milliseconds, Penpal should wait\n * for the parent to respond before rejecting the connection promise.\n * @return {Parent}\n */\nvar _default = function _default() {\n  let _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      _ref$parentOrigin = _ref.parentOrigin,\n      parentOrigin = _ref$parentOrigin === void 0 ? '*' : _ref$parentOrigin,\n      _ref$methods = _ref.methods,\n      methods = _ref$methods === void 0 ? {} : _ref$methods,\n      timeout = _ref.timeout,\n      debug = _ref.debug;\n\n  const log = (0, _createLogger.default)(debug);\n\n  if (window === window.top) {\n    const error = new Error('connectToParent() must be called within an iframe');\n    error.code = _errorCodes.ERR_NOT_IN_IFRAME;\n    throw error;\n  }\n\n  const _createDestructor = (0, _createDestructor2.default)(),\n        destroy = _createDestructor.destroy,\n        onDestroy = _createDestructor.onDestroy;\n\n  const child = window;\n  const parent = child.parent;\n  const promise = new Promise((resolveConnectionPromise, reject) => {\n    let connectionTimeoutId;\n\n    if (timeout !== undefined) {\n      connectionTimeoutId = setTimeout(() => {\n        const error = new Error(`Connection to parent timed out after ${timeout}ms`);\n        error.code = _errorCodes.ERR_CONNECTION_TIMEOUT;\n        reject(error);\n        destroy();\n      }, timeout);\n    }\n\n    const handleMessageEvent = event => {\n      // Under niche scenarios, we get into this function after\n      // the iframe has been removed from the DOM. In Edge, this\n      // results in \"Object expected\" errors being thrown when we\n      // try to access properties on window (global properties).\n      // For this reason, we try to access a global up front (clearTimeout)\n      // and if it fails we can assume the iframe has been removed\n      // and we ignore the message event.\n      try {\n        clearTimeout();\n      } catch (e) {\n        return;\n      }\n\n      if (event.source !== parent || event.data.penpal !== _constants.HANDSHAKE_REPLY) {\n        return;\n      }\n\n      if (parentOrigin !== '*' && parentOrigin !== event.origin) {\n        log(`Child received handshake reply from origin ${event.origin} which did not match expected origin ${parentOrigin}`);\n        return;\n      }\n\n      log('Child: Received handshake reply');\n      child.removeEventListener(_constants.MESSAGE, handleMessageEvent);\n      const info = {\n        localName: 'Child',\n        local: child,\n        remote: parent,\n        originForSending: event.origin === 'null' ? '*' : event.origin,\n        originForReceiving: event.origin\n      };\n      const callSender = {};\n      const destroyCallReceiver = (0, _connectCallReceiver.default)(info, methods, log);\n      onDestroy(destroyCallReceiver);\n      const destroyCallSender = (0, _connectCallSender.default)(callSender, info, event.data.methodNames, destroy, log);\n      onDestroy(destroyCallSender);\n      clearTimeout(connectionTimeoutId);\n      resolveConnectionPromise(callSender);\n    };\n\n    child.addEventListener(_constants.MESSAGE, handleMessageEvent);\n    onDestroy(() => {\n      child.removeEventListener(_constants.MESSAGE, handleMessageEvent);\n      const error = new Error('Connection destroyed');\n      error.code = _errorCodes.ERR_CONNECTION_DESTROYED;\n      reject(error);\n    });\n    log('Child: Sending handshake');\n    parent.postMessage({\n      penpal: _constants.HANDSHAKE,\n      methodNames: Object.keys(methods)\n    }, parentOrigin);\n  });\n  return {\n    promise,\n    destroy\n  };\n};\n\nexports.default = _default;\nmodule.exports = exports.default;"]},"metadata":{},"sourceType":"script"}